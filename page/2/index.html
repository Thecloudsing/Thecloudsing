<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-22 MySQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/22/22%20MySQL/" class="article-date">
  <time class="dt-published" datetime="2022-01-21T16:00:00.000Z" itemprop="datePublished">2022-01-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/22/22%20MySQL/">&lt;Java&gt;22 MySQL</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="22-MySQL"><a href="#22-MySQL" class="headerlink" title="22 MySQL"></a>22 MySQL</h1><h2 id="22-1-数据库"><a href="#22-1-数据库" class="headerlink" title="22.1 数据库"></a>22.1 数据库</h2><blockquote>
<p>安装数据库，就是在主机安装一个数据库管理系统。该系统可以管理多个数据库。</p>
<p>一个数据库中可以拥有多张表，以保存数据（信息）。这些表的本质仍是文件</p>
<p>表的一行称为一条记录。在 Java 中，一行记录往往用对象表示</p>
<p><a target="_blank" rel="noopener" href="http://dev.mysql.com/get/Downloads/MySQL-5.7.19-winx64.zip">下载地址</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fh411y7R8?p=732&t=0.5">安装方法</a></p>
</blockquote>
<p>可视化 MySQL 管理软件：**<a target="_blank" rel="noopener" href="http://www.navicat.com.cn/products">Navicat</a>**</p>
<p>连接到 MySQL 服务的指令：<code>mysql -h 主机名 -P 端口 -u 用户名 -p密码</code></p>
<ol>
<li>-p密码 不要有空格</li>
<li>-p 后面不写密码，回车会要求输入密码 </li>
<li>如果不写 -h 默认是本机</li>
<li>如果不写 -p 默认是 3306</li>
</ol>
<p>SQL 语句分类</p>
<ul>
<li>DDL（数据定义语句）：[create 表，库]</li>
<li>DML（数据操作语句）：[增加 insert]、[修改 update]、[删除 delete]</li>
<li>DQL（数据查询语句）：[select]</li>
<li>DCL（数据控制语句）：[管理数据库：如用户权限 revoke grant]</li>
</ul>
<p><em><strong>关于数据库的详细说明，见本章附录</strong></em></p>
<h3 id="22-1-1-创建数据库"><a href="#22-1-1-创建数据库" class="headerlink" title="22.1.1 创建数据库"></a>22.1.1 创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS `Melody` CHARACTER SET &#x27;utf8&#x27; COLLATE &#x27;utf8_bin&#x27;;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>CHARACTER SET</code>：指定数据库采用的字符集。</p>
<p>不指定的场合，默认 UTF-8</p>
</li>
<li><p><code>COLLATE</code>：指定数据库字符集校对规则</p>
<ul>
<li><code>utf8_bin</code> [区分大小写]（常用）</li>
<li><code>utf8_general_ci</code> [不区分大小写]（默认）</li>
</ul>
</li>
<li><p>在创建数据库 · 表时，为了规避关键字，可以使用反引号 &#96;&#96;&#96; &#96;</p>
</li>
<li><p>创建表时，不指定字符集 · 校对规则的场合，默认和数据库相同</p>
</li>
</ol>
<h3 id="22-1-2-查看-·-删除数据库"><a href="#22-1-2-查看-·-删除数据库" class="headerlink" title="22.1.2 查看 · 删除数据库"></a>22.1.2 查看 · 删除数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;										#1</span><br><span class="line">SHOW CREATE DATABASE `Melody`;						#2</span><br><span class="line">DROP DATABASE [IF EXISTS] `Melody`;					#3</span><br><span class="line">USE `sys`											#4</span><br></pre></td></tr></table></figure>

<ol>
<li>显示数据库语句</li>
<li>显示数据库创建语句（当初创建时的语句）</li>
<li>数据库删除语句（必须慎用）</li>
<li>切换数据库</li>
</ol>
<h3 id="22-1-3-备份-·-恢复数据库"><a href="#22-1-3-备份-·-恢复数据库" class="headerlink" title="22.1.3 备份 · 恢复数据库"></a>22.1.3 备份 · 恢复数据库</h3><p>备份（DOS）：<code>mysqldump -u 用户名 -p -B 数据库1 数据库2 &gt; 路径\文件名.sql</code></p>
<p>恢复（DOS，进入mysql）：<code>Source 文件名.sql;</code></p>
<p>备份库的表：<code>mysqldunp -u 用户名 -p 数据库 表1 表2 &gt; 路径\文件名.sql</code></p>
<h2 id="22-2-MySQL-常用数据类型（列类型）"><a href="#22-2-MySQL-常用数据类型（列类型）" class="headerlink" title="22.2 MySQL 常用数据类型（列类型）"></a>22.2 MySQL 常用数据类型（列类型）</h2><p><strong>数值类型</strong></p>
<ul>
<li>整形<ul>
<li>bit(M) [M 指定位数，默认1，范围 1 ~ 64]</li>
<li>tinyint [1 byte]</li>
<li>smallint [2 byte]</li>
<li>mediumint [3 byte]</li>
<li>int [4 byte]（常用）</li>
<li>bigint [8 byte]</li>
</ul>
</li>
<li>小数类型<ul>
<li>float [4 byte 单精度]</li>
<li>double [8 byte 双精度]（常用）</li>
<li>decimal(M,D) [大小不确定]（常用）</li>
</ul>
</li>
</ul>
<p><strong>文本类型（字符串）</strong></p>
<ul>
<li>char [0 ~ 255]（常用）</li>
<li>carchar [0 ~ 65535]（常用）</li>
<li>text [0 ~ 2^16^ - 1]（常用）</li>
<li>longtext [ 0 ~ 2^32^ - 1]</li>
</ul>
<p><strong>二进制数据类型</strong></p>
<ul>
<li>blob [0 ~ 2^16^ - 1]</li>
<li>longblob [0 ~ 2^32^ - 1]</li>
</ul>
<p><strong>时间日期类型</strong></p>
<ul>
<li>date [YYYY-MM-DD]</li>
<li>time [HH:mm:SS]</li>
<li>datetime [YYYY-MM-DD HH:mm:SS]（常用）</li>
<li>timestamp [时间戳]（常用）</li>
<li>year [年]</li>
</ul>
<h3 id="22-2-1-数组类型"><a href="#22-2-1-数组类型" class="headerlink" title="22.2.1 数组类型"></a>22.2.1 数组类型</h3><h4 id="22-2-1-1-整形"><a href="#22-2-1-1-整形" class="headerlink" title="22.2.1.1 整形"></a>22.2.1.1 整形</h4><ol>
<li><p>使用规范：在满足需求的情况下，尽量使用占用空间小的类型</p>
</li>
<li><p>如何定义一个无符号整数：在后面加入 <code>unsigned</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `T1` (`ID` INT UNSIGNED);</span><br></pre></td></tr></table></figure>

<p>无符号是咋呢？以 tinyint 为例，有符号的范围是 [-128, 127]，无符号范围是 [0, 255]</p>
</li>
</ol>
<h4 id="22-2-1-2-bit（位类型）"><a href="#22-2-1-2-bit（位类型）" class="headerlink" title="22.2.1.2 bit（位类型）"></a>22.2.1.2 bit（位类型）</h4><ol>
<li><code>bit(m)</code> 中 m 的范围在 [1, 64]</li>
<li>添加数据的范围按照给定的位数（m）来确定。m &#x3D; 8 的场合表示一个字节，范围是 255</li>
<li>显示时，按照 bit 格式（<code>bit(8)</code> 的场合 <code>7</code> 就显示为 <code>00000111</code>）</li>
<li>查询时，仍能按照十进制数查询</li>
</ol>
<h4 id="22-2-1-3-小数类型"><a href="#22-2-1-3-小数类型" class="headerlink" title="22.2.1.3 小数类型"></a>22.2.1.3 小数类型</h4><ol>
<li><p><code>float</code> 单精度，<code>double</code> 双精度</p>
</li>
<li><p><code>decimal(M,D)</code> 可以支持更加精确的小数位。其中 M 是小数位数的总数（精度），D 是小数点后的位数（标度）。</p>
<p>D &#x3D; 0 的场合，值没有小数部分。M 最大值是 65，D 最大值是 30</p>
<p>D 省略的场合，默认为 0；M 省略的场合，默认为 10</p>
<p>希望小数精度高的场合，推荐使用 <code>decimal(M,D)</code></p>
</li>
</ol>
<h3 id="22-2-2-文本类型"><a href="#22-2-2-文本类型" class="headerlink" title="22.2.2 文本类型"></a>22.2.2 文本类型</h3><ol>
<li><p><code>char(size)</code>：固定长度字符串，size 范围 [0, 255]，最大 255 <strong>字符</strong>。</p>
</li>
<li><p><code>varchar(size)</code>：可变长度字符串，（UTF-8）size 范围 [0, 21844]，最大 65532 <strong>字节</strong>（1 ~ 3 字节要用于记录大小；UTF8 最大为 (65535 - 3) &#x2F; 3 &#x3D; 21844 <strong>字符</strong>）</p>
</li>
<li><p>size 表示字符数，不是字节数。无论中文英文，都最多存放 size 个字符</p>
</li>
<li><p><code>char(4)</code> 是定长。这个场合，不管输入什么（如 ‘a’）都会占用 4 个字符的空间</p>
<p>相对的，<code>varchar(4)</code> 是变长。实际占用空间取决于输入的字符（实际数据大小 + 额外的 1 ~ 3 字节）</p>
</li>
<li><p>存放文本时，也可以使用 <code>text</code> 数据类型。可以把 <code>text</code> 列视为 <code>varchar</code> 列。<code>text</code> 不能有默认值，最大 2^16^ 字节</p>
<p>希望存放更多字符，还能选择 <code>mediumtext</code>（最大 2^24^ 字节）或 <code>longtext</code>（最大 2^32^ 字节）</p>
</li>
</ol>
<h3 id="22-2-3-时间日期类型"><a href="#22-2-3-时间日期类型" class="headerlink" title="22.2.3 时间日期类型"></a>22.2.3 时间日期类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `T2` </span><br><span class="line">		(T1 DATETIME, </span><br><span class="line">  	    T2 TIMESTAMP </span><br><span class="line">      		NOT NULL DEFAULT CURRENT_TIMESTAMP </span><br><span class="line">      		ON UPDATE CURRENT_TIMESTAMP);</span><br></pre></td></tr></table></figure>

<p>后面一坨意为：默认时间戳为当前时间戳</p>
<h2 id="22-3-表"><a href="#22-3-表" class="headerlink" title="22.3 表"></a>22.3 表</h2><h3 id="22-2-1-创建表"><a href="#22-2-1-创建表" class="headerlink" title="22.2.1 创建表"></a>22.2.1 创建表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `table_yuheng` (`name` VARCHAR(255), `id` INT, `age` INT) CHARACTER SET &#x27;utf8&#x27; COLLATE &#x27;utf8_bin&#x27; ENGINE INNODB;</span><br></pre></td></tr></table></figure>

<p>field：指定列名</p>
<p>datatype：指定列类型</p>
<p>character set：字符集</p>
<p>collate：校对规则</p>
<p>engine：引擎</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE genshin2 LIKE genshin;</span><br></pre></td></tr></table></figure>

<p>这个意思是：以 genshin 的结构创建一个表 genshin2</p>
<h3 id="22-2-2-删除-·-修改表"><a href="#22-2-2-删除-·-修改表" class="headerlink" title="22.2.2 删除 · 修改表"></a>22.2.2 删除 · 修改表</h3><ul>
<li><p><strong>添加列</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` ADD `列名` NOT NULL 列类型 DEFAULT 默认值 AFTER 某列名;</span><br></pre></td></tr></table></figure>

<p>在 <code>表名</code> 的 <code>某列名</code> 后面加入一个 <code>列名</code> 列，类型是 <code>列类型</code> 默认值为 <code>默认值</code></p>
</li>
<li><p><strong>修改列</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` MODIFY `列名` 列类型 NOT NULL DEFAULT 默认值;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>把 <code>表名</code> 的 <code>列名</code> 列修改为 <code>列类型</code> ，默认值改为 <code>默认值</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` CHANGE `列名` `新列名` 列类型 NOT NULL DEFAULT 默认值;</span><br></pre></td></tr></table></figure>

<p>把 <code>表名</code> 的 <code>列名</code> 列修改为 <code>新列名</code> ，类型是 <code>列类型</code> 默认值为 <code>默认值</code></p>
</li>
<li><p><strong>删除列</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` DROP `列名`;</span><br></pre></td></tr></table></figure>

<p>删除 <code>表名</code> 的 <code>列名</code> 列</p>
</li>
<li><p><strong>查看表的结构</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC `表名`;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE `表名` TO `新表名`;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改表字符集</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` CHARACTER SET &#x27;字符集&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改存储引擎</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `表名` ENGINE = 引擎;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="22-4-数据库的增删改查"><a href="#22-4-数据库的增删改查" class="headerlink" title="22.4 数据库的增删改查"></a>22.4 数据库的增删改查</h2><blockquote>
<p>C（create 创建）R（read 查找）U（update 修改）D（delete 删除）</p>
</blockquote>
<h3 id="22-4-1-INSERT-语句"><a href="#22-4-1-INSERT-语句" class="headerlink" title="22.4.1 INSERT 语句"></a>22.4.1 INSERT 语句</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `表名` (列名1, 列名2, 列名3)</span><br><span class="line">VALUES (值1, 值2, 值3), (值1a, 值2a, 值3a);</span><br></pre></td></tr></table></figure>

<ol>
<li><p>当不给某个字段值时，如有默认值会添加默认值，否则会报错。</p>
</li>
<li><p>另外，给表中 所有字段 添加数据的场合，也能不写列名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `表名` VALUES (值1, 值2, 值3);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="22-4-2-UPDATE-语句"><a href="#22-4-2-UPDATE-语句" class="headerlink" title="22.4.2 UPDATE 语句"></a>22.4.2 UPDATE 语句</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE `表名` SET `列名` = 值, `列名2` = 值2 WHERE `条件列` = 条件值;</span><br></pre></td></tr></table></figure>

<ol>
<li>对于所有 <code>条件列</code> &#x3D; <code>条件值</code> 的记录，将 <code>列名</code> 列改为 <code>值</code></li>
<li>SET 子句指示要修改哪些列和给予哪些值</li>
<li><strong>如果不带 where 条件，会修改所有记录</strong></li>
</ol>
<h3 id="22-4-3-DELETE-语句"><a href="#22-4-3-DELETE-语句" class="headerlink" title="22.4.3 DELETE 语句"></a>22.4.3 DELETE 语句</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM `表名` WHERE `条件列` = 条件值;</span><br></pre></td></tr></table></figure>

<ol>
<li>不能删除一列的值。若要如此做，可以使用 update 语句将一列置空</li>
<li>delete 语句仅能删除记录，不能删除表本身。要如此做，可以使用 [22.2.2] 中的 drop 语句</li>
<li><strong>如果不带 where 条件，会删除所有记录</strong></li>
</ol>
<h3 id="22-4-4-SELECT-语句（单表）"><a href="#22-4-4-SELECT-语句（单表）" class="headerlink" title="22.4.4 SELECT 语句（单表）"></a>22.4.4 SELECT 语句（单表）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT `列1`, `列2` FROM `表名` WHERE 条件;</span><br><span class="line">SELECT * FROM `表名2`;</span><br></pre></td></tr></table></figure>

<ol>
<li>DISTINCT 是可选的。表示显示结果时，是否去掉重复数据（查询记录的所有字段都相同才会去重）</li>
<li>SELECT 指定查询哪些列的数据。</li>
<li>SELECT * 的场合代表查询所有列</li>
<li>FROM 指定查询哪张表</li>
</ol>
<ul>
<li><p><strong>使用表达式对查询的列进行运算</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT `name`, (chinese + math + english) FROM `student`;</span><br></pre></td></tr></table></figure>

<p>这个场合，显示的时候是 <code>name</code> 和 <code>chinese + math + english</code> 两列</p>
</li>
<li><p><strong><code>AS</code> 语句</strong></p>
<p>可以用 AS 语句起个别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT `name`, (chinese + math + english) AS `all` FROM `student`;</span><br></pre></td></tr></table></figure>

<p>这个场合，显示的时候是 <code>name</code> 和 <code>all</code> 两列</p>
</li>
<li><p><strong>用 <code>ORDER BY</code> 语句排序查询结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `student` ORDER BY `math` DESC;</span><br></pre></td></tr></table></figure>

<p>以 <code>math</code> 降序排列</p>
<ul>
<li>降序：DESC</li>
<li>升序：ASC（不写也是默认升序）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `genshin` ORDER BY `age` ASC, `salary` DESC;</span><br></pre></td></tr></table></figure>

<p>以 <code>age</code> 升序并以 <code>salary</code> 降序排列</p>
</li>
<li><p><strong>统计函数 <code>COUNT</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM `student`;</span><br></pre></td></tr></table></figure>

<p>统计表中有多少记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM `student` WHERE `math` &gt; 60;</span><br></pre></td></tr></table></figure>

<p>统计表中 <code>math &gt; 60</code> 的数目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(`name`) FROM `student`;</span><br></pre></td></tr></table></figure>

<p>统计表中有多少记录，排除 <code>name</code> 为空的数目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(name), sum(`age`), sum(`salary`) / COUNT(*) </span><br><span class="line">		FROM `genshin`;</span><br></pre></td></tr></table></figure>

<p>这样也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(IF (`name` IS NULL, 1, NULL)) FROM `genshin`;</span><br><span class="line">SELECT COUNT(DISTINCT `name`) FROM `genshin`;</span><br></pre></td></tr></table></figure>

<p>还有很多方式</p>
</li>
<li><p><strong>分组语句 <code>GROUP BY</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(`salary`), `age` FROM `genshin` group by `age`;</span><br></pre></td></tr></table></figure>

<p>按 <code>age</code> 分组统计</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(`salary`) FROM `genshin` group by `age`, `name`;</span><br></pre></td></tr></table></figure>

<p>按 <code>age</code> 和 <code>name</code> 分组统计</p>
</li>
<li><p><strong>用 <code>HAVING</code> 语句过滤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(salary) FROM genshin GROUP BY country HAVING AVG(age) &gt; 18;</span><br></pre></td></tr></table></figure>

<p>按 <code>country</code> 分组统计，显示其中 <code>AVG(age) &gt; 18</code> 的组</p>
</li>
<li><p><strong><code>WHERE</code> 语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `genshin` WHERE `create_time` &gt; &#x27;2011-01-01&#x27;;</span><br></pre></td></tr></table></figure>

<p>日期可以直接比较</p>
<p>比起 <code>HAVING</code>，<code>WHERE</code> 是在分组前过滤</p>
</li>
<li><p><strong><code>LIKE</code> 字符</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `genshin` WHERE `name` LIKE &#x27;_E%&#x27;;</span><br></pre></td></tr></table></figure>

<p>下划线 <code>_</code> 代表一个任意字符</p>
<p>百分号 <code>%</code> 代表任意个任意字符</p>
</li>
<li><p><strong>分页查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `genshin` LIMIT num, rows;</span><br></pre></td></tr></table></figure>

<p>从 num + 1 行开始取，取出 rows 行。num 从 0 开始计数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `genshin` LIMIT 0, 3;</span><br><span class="line">SELECT * FROM `genshin` LIMIT 3, 3;</span><br><span class="line">SELECT * FROM `genshin` LIMIT 6, 3;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>总结：</strong></p>
<p><code>SELECT</code> 语句顺序是 <code>GROUP BY</code> &gt;&gt; <code>HAVING</code> &gt;&gt; <code>ORDER BY</code> &gt;&gt; <code>LIMIT</code></p>
<h3 id="22-4-5-常用的运算符"><a href="#22-4-5-常用的运算符" class="headerlink" title="22.4.5 常用的运算符"></a>22.4.5 常用的运算符</h3><table>
<thead>
<tr>
<th></th>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>比较运算符</td>
<td><code>&gt;</code> <code>&lt;</code> <code>&lt;=</code> <code>&gt;=</code> <code>=</code> <code>!=</code> <code>&lt;&gt;</code></td>
<td>大于、小于、大于等于、不等于</td>
</tr>
<tr>
<td></td>
<td><code>BETWWEEN ... AND ...</code></td>
<td>显示某一区间的值</td>
</tr>
<tr>
<td></td>
<td><code>IN(值1, 值2, 值3)</code></td>
<td>显示在 <code>IN</code> 列表中的值</td>
</tr>
<tr>
<td></td>
<td><code>LIKE &#39;值&#39;</code> <code>NOT LIKE &#39;值&#39;</code></td>
<td>模糊查询（<code>LIKE &#39;A%&#39;</code> 即 A 开头就行）</td>
</tr>
<tr>
<td></td>
<td><code>IS NULL</code></td>
<td>判断是否为空</td>
</tr>
<tr>
<td>逻辑运算符</td>
<td><code>AND</code></td>
<td>多个条件同时成立</td>
</tr>
<tr>
<td></td>
<td><code>OR</code></td>
<td>多个条件任一成立</td>
</tr>
<tr>
<td></td>
<td><code>NOT</code></td>
<td>不成立</td>
</tr>
</tbody></table>
<h2 id="22-5-函数"><a href="#22-5-函数" class="headerlink" title="22.5 函数"></a>22.5 函数</h2><h3 id="22-5-1-统计函数"><a href="#22-5-1-统计函数" class="headerlink" title="22.5.1 统计函数"></a>22.5.1 统计函数</h3><ul>
<li>计数：<code>COUNT(列)</code></li>
<li>平均值：<code>AVG(列)</code></li>
<li>合计值：<code>SUM(列)</code></li>
<li>最大 · 最小值：<code>MAX(列)</code> <code>MIN(列)</code></li>
</ul>
<h3 id="22-5-2-字符串函数"><a href="#22-5-2-字符串函数" class="headerlink" title="22.5.2 字符串函数"></a>22.5.2 字符串函数</h3><ul>
<li><p><code>CHARSET(str)</code>：返回字串字符集</p>
<p>举个栗子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select charset(name) from genshin;</span><br></pre></td></tr></table></figure>

<p>输出这个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+</span><br><span class="line">| charset(name) |</span><br><span class="line">+---------------+</span><br><span class="line">| utf8          |</span><br><span class="line">| utf8          |</span><br><span class="line">| utf8          |</span><br><span class="line">+---------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>CONCAT(str1, str2, ...)</code>：连接字串</p>
<p>举个花生：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat (&#x27;我是 &#x27;, name, &#x27; 我来自 &#x27;, country) from genshin;</span><br></pre></td></tr></table></figure>

<p>输出这个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------+</span><br><span class="line">| concat (&#x27;我是 &#x27;, name, &#x27; 我来自 &#x27;, country) |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| 我是 Amber 我来自 蒙德                      |</span><br><span class="line">| 我是 QiQi 我来自 保底                       |</span><br><span class="line">| 我是 KeQing 我来自 璃月                     |</span><br><span class="line">+-------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>UCASE(str)</code>：转成大写</p>
</li>
<li><p><code>LCASE(str)</code>：转成小写</p>
</li>
<li><p><code>LENGTH(str)</code>：字符串长度</p>
<p>返回时是按<strong>字节</strong>返回</p>
</li>
<li><p><code>REPLACE(str, str1, str2)</code>：在 str 中用 str2 替换 str1</p>
</li>
<li><p><code>SUBSTRING(str, po, len)</code>：从 str 的 po 位取 len 个字符</p>
<p>这里 po 是从 1 开始计数的</p>
</li>
<li><p><code>LEFT(str, len)</code>：从 str 左边取 len 个字符</p>
<p><code>RIGHT(str, len)</code>：从 str 右边取 len 个字符</p>
</li>
<li><p><code>INSTR(str, sub)</code>：返回 sub 在 str 出现的位置（没有就返回 0）</p>
</li>
<li><p><code>STRCMP(str1, str2)</code>：逐字符比较两字串大小</p>
</li>
<li><p><code>LTRIM(str)</code>：去除前端空格</p>
<p><code>RTRIM(str)</code>：去除后端空格</p>
<p><code>TRIM(str)</code>：去除左右空格</p>
</li>
</ul>
<h3 id="22-5-3-数学函数"><a href="#22-5-3-数学函数" class="headerlink" title="22.5.3 数学函数"></a>22.5.3 数学函数</h3><ul>
<li><p><code>ABS(num)</code>：绝对值</p>
</li>
<li><p><code>BIN(num)</code>：十进制转为二进制</p>
</li>
<li><p><code>CEILING(num)</code>：向上取整</p>
</li>
<li><p><code>CONV(num, from_base, to_base)</code>：进制转换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONV(5, 10, 2) FROM genshin;</span><br></pre></td></tr></table></figure>

<p>把 5 从（当作） 10 进制转换成 2 进制</p>
</li>
<li><p><code>FLOOR(num)</code>：向下取整</p>
</li>
<li><p><code>FORMAT(num, decimal_places)</code>：保留小数位数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT FORMAT(3.1415926535897932384626, 2) FROM genshin;</span><br></pre></td></tr></table></figure>

<p>这个数字四舍五入保留 2 位</p>
</li>
<li><p><code>HEX(num)</code>：转十六进制</p>
</li>
<li><p><code>LEAST(num1, num2, num3, ...)</code>：最小值</p>
</li>
<li><p><code>MOD(num, num2)</code>：求余</p>
</li>
<li><p><code>RAND([seed])</code>：返回随机数（范围 [0, 1]）。如果 seed 不变，返回的随机数也不变</p>
<p><code>RAND()</code>：每次返回不同随机数</p>
</li>
</ul>
<h3 id="22-5-4-时间和日期函数"><a href="#22-5-4-时间和日期函数" class="headerlink" title="22.5.4 时间和日期函数"></a>22.5.4 时间和日期函数</h3><ul>
<li><p><code>CURRENT_DATE()</code>：当前日期</p>
</li>
<li><p><code>CURRENT_TIME()</code>：当前时间</p>
</li>
<li><p><code>CURRENT_TIMESTAMP()</code>：当前时间戳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `T1` (&#x27;date&#x27; TIMESTAMP </span><br><span class="line">              NOT NULL DEFAULT CURRENT_TIMESTAMP </span><br><span class="line">              ON UPDATE CURRENT_TIMESTAMP);</span><br></pre></td></tr></table></figure>

<p>这一列内容是自动更新的时间戳</p>
</li>
<li><p><code>DATE(datetime)</code>：返回 datetime 的日期部分</p>
</li>
<li><p><code>DATE_ADD(date, INTERVAL D_VALUE D_TYPE)</code>：在 date 中加上日期或时间</p>
<p><code>D_VALUE</code>：时间的数值</p>
<p><code>D_TYPE</code>：时间类型。可以是 YEAR、MINUTE、HOUR、DAY、SECOND 等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin </span><br><span class="line">WHERE DATE_ADD(`date`, INTERVAL 10 MINUTE) &gt;= NOW();</span><br></pre></td></tr></table></figure>

<p>显示那些 date 列加上 10 分钟，比现在时间大的记录</p>
</li>
<li><p><code>DATE_SUB(date, INTERVAL D_VALUE D_TYPE)</code>：在 date 上减去一个时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin </span><br><span class="line">WHERE `date` &gt;= DATE_SUB(NOW(), interval 10 minute);</span><br></pre></td></tr></table></figure>

<p>显示那些现在时间减去 10 分钟，比 date 小的记录</p>
</li>
<li><p><code>DATEDIFF(date1, date2)</code>：两个日期差（天数）</p>
<p>是 date1 - date2 的结果，因此结果可能是负数</p>
</li>
<li><p><code>TIMEDIFF(date1, date2)</code>：两个时间差（多少小时、分钟、秒）</p>
</li>
<li><p><code>NOW()</code>：当前日期 + 时间</p>
</li>
<li><p><code>YEAR(datetime)</code>：返回日期的年份</p>
<p><code>MONTH(datetime)</code>：返回日期的月份</p>
<p><code>DAY(datetime)</code>：返回日期的日数</p>
</li>
<li><p><code>UNIX_TIMESTAMP()</code>：返回 1970-1-1 到现在的毫秒数</p>
</li>
<li><p><code>FROM_UNIXTIME(num)</code>：把一个 UNIX_TIMESTAMP 转换为时间</p>
<p><code>FROM_UNIXTIME(num, format)</code>：含有格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct from_unixtime(100, &#x27;%Y-%m-%d %H:%i:%s&#x27;) from genshin;</span><br></pre></td></tr></table></figure>

<p>这个会输出 1970-01-01 08:01:40</p>
<p>在实际开发中，经常使用 int 保留一个 UNIX_TMIESTAMP。使用时转换为时间</p>
</li>
<li><p><code>LAST_DAY(date)</code>：返回该日期所在月份的最后一天的日期</p>
</li>
</ul>
<h3 id="22-5-5-加密和系统函数"><a href="#22-5-5-加密和系统函数" class="headerlink" title="22.5.5 加密和系统函数"></a>22.5.5 加密和系统函数</h3><ul>
<li><p><code>USER()</code>：查看用户</p>
<p>可以查看登录到 MySQL 的右哪些用户，及其 IP</p>
</li>
<li><p><code>DATABASE()</code>：查询当前使用的数据库名称</p>
</li>
<li><p><code>MD5(str)</code>：为字符串计算出一个 MD5 32 的字符串</p>
</li>
<li><p><code>PASSWORD(str)</code>：（另一个）加密函数，常用于对 MySQL 数据库的用户密码加密</p>
</li>
</ul>
<h3 id="22-5-6-流程控制函数"><a href="#22-5-6-流程控制函数" class="headerlink" title="22.5.6 流程控制函数"></a>22.5.6 流程控制函数</h3><ul>
<li><p><code>IF(expr1, expr2, expr3)</code>：如果 expr1 为 true 则返回 expr2，否则返回 expr3</p>
</li>
<li><p><code>IFNULL(expr1, expr2)</code>：如果 expr1 为 NULL 则返回 expr2，否则返回 expr1</p>
</li>
<li><p>&#96;&#96;&#96;mysql<br>…<br>SELECT CASE<br>    WHEN expr1 THEN expr2<br>    WHEN expr3 THEN expr4<br>    ELSE expr5 END<br>…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">多重分支。若 expr1 则 expr2，否则若 expr3 则 expr4，否则 expr5</span><br><span class="line"></span><br><span class="line">举个蚕豆：</span><br><span class="line"></span><br><span class="line">```mysql</span><br><span class="line">SELECT `name`, (SELECT CASE</span><br><span class="line">             WHEN `age` &gt; 100 THEN &#x27;?&#x27;</span><br><span class="line">             WHEN `age` &lt; 18 THEN &#x27;!&#x27;</span><br><span class="line">             ELSE `age` END) AS &#x27;age&#x27;, `country`, `sex` </span><br><span class="line">		FROM `genshin`;</span><br></pre></td></tr></table></figure>

<p>输出这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+------+-----+---------+-----+</span><br><span class="line">| name | age | country | sex |</span><br><span class="line">+------+-----+---------+-----+</span><br><span class="line">| 刻晴 | 23  | 璃月    | 女  |</span><br><span class="line">| 凝光 | 28  | 璃月    | 女  |</span><br><span class="line">| 胡桃 | 20  | 璃月    | 女  |</span><br><span class="line">| 甘雨 | ?   | 璃月    | 否  |</span><br><span class="line">| 影   | ?   | 稻妻    | 女  |</span><br><span class="line">| 八重 | ?   | 稻妻    | 女  |</span><br><span class="line">| 温迪 | ?   | 蒙德    | 男  |</span><br><span class="line">| 莫娜 | 22  | 蒙德    | 女  |</span><br><span class="line">| 申鹤 | 25  | 璃月    | 女  |</span><br><span class="line">| 可莉 | !   | 蒙德    | 女  |</span><br><span class="line">+------+-----+---------+-----+</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="22-6-MySQL-多表查询"><a href="#22-6-MySQL-多表查询" class="headerlink" title="22.6 MySQL 多表查询"></a>22.6 MySQL 多表查询</h2><p>多表查询是基于两个和两个以上的表查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `honkai3`, `genshin`;</span><br></pre></td></tr></table></figure>

<p>这个场合，输出的是两个表相乘（即：取出第一张表的每一行，与第二张表的每一行进行组合）</p>
<p>……这样，就需要加入筛选条件，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `honkai3`, `genshin` </span><br><span class="line">		WHERE honkai3.group = genshin.country;</span><br></pre></td></tr></table></figure>

<p><strong>多表查询的条件不能少于 表的个数 - 1，否则会出现笛卡尔集</strong></p>
<h3 id="22-6-1-自连接"><a href="#22-6-1-自连接" class="headerlink" title="22.6.1 自连接"></a>22.6.1 自连接</h3><p>自连接：指在同一张表连接查询（将同一表视为两张表）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * </span><br><span class="line">		FROM genshin g1, genshin g2</span><br><span class="line">		WHERE g1.name = g2.name;</span><br></pre></td></tr></table></figure>

<p>这样，表 genshin 获得了 g1、g2 的别名，就能自连接了</p>
<p>这里取别名，也可以加上 <code>AS</code>。另外，列名不明确的场合，也也要特别指定</p>
<h3 id="22-6-2-子查询"><a href="#22-6-2-子查询" class="headerlink" title="22.6.2 子查询"></a>22.6.2 子查询</h3><p>子查询：指嵌入在其他 SQL 语句中的 select 语句。也叫嵌套查询</p>
<ul>
<li><p><strong>单行子查询</strong>：指只返回一行数据的子查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE age &gt; (</span><br><span class="line">	SELECT age FROM genshin WHERE name = &#x27;可莉&#x27;</span><br><span class="line">);										</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多行子查询</strong>：返回多行数据的子查询语句。使用关键字 <code>IN</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE country IN (</span><br><span class="line">	SELECT DISTINCT country FROM genshin WHERE age &lt; 30</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>子查询也可以当作临时表使用。</p>
</li>
<li><p><strong><code>ALL</code> 操作符</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE age &gt; ALL(</span><br><span class="line">	SELECT age FROM genshin WHERE country = &#x27;蒙德&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上面的代码相当于这个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE age &gt; (</span><br><span class="line">	SELECT MAX(age) FROM genshin WHERE country = &#x27;蒙德&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>ANY</code> 操作符</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE age &gt; ANY(</span><br><span class="line">	SELECT age FROM genshin WHERE country = &#x27;蒙德&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上面的代码相当于这个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin WHERE age &gt; (</span><br><span class="line">	SELECT MIN(age) FROM genshin WHERE country = &#x27;蒙德&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多列子查询</strong>：指返回多个列数据的子查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM honkai3 WHERE (age, sex) = (</span><br><span class="line">	SELECT age, sex </span><br><span class="line">	FROM genshin </span><br><span class="line">	WHERE name = &#x27;凝光&#x27;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>子查询列数要和条件列数相等，顺序对应</p>
</li>
<li><p><strong>表的复制</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO genshin_copy (name, age, sex, country)</span><br><span class="line">	SELECT name, age, sex, country FROM genshin;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>合并查询</strong>：把两个（结构相同的）查询结果合并。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT * FROM genshin2;</span><br></pre></td></tr></table></figure>

<p>这个方法（<code>UINON ALL</code>）不会去重</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM genshin</span><br><span class="line">UNION</span><br><span class="line">SELECT * FROM genshin2;</span><br></pre></td></tr></table></figure>

<p>这个方法（<code>UINON</code>）会去重</p>
</li>
</ul>
<h2 id="22-7-外连接"><a href="#22-7-外连接" class="headerlink" title="22.7 外连接"></a>22.7 外连接</h2><blockquote>
<p>左外连接：左侧的表完全显示（即使没有匹配的记录，也会把左侧表完全显示）</p>
<p>右外连接：右侧的表完全显示</p>
</blockquote>
<p><strong>原来的代码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT genshin.name, genshin.age, honkai3.name</span><br><span class="line">	FROM genshin, honkai3 </span><br><span class="line">	WHERE genshin.age = honkai3.age; </span><br></pre></td></tr></table></figure>

<p>无匹配记录的项不会显示。</p>
<p><strong>左外连接：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT genshin.name, genshin.age, honkai3.name</span><br><span class="line">	FROM genshin LEFT JOIN honkai3 </span><br><span class="line">	ON genshin.age = honkai3.age; </span><br></pre></td></tr></table></figure>

<p>这个场合，genshin 中无匹配记录的项也会显示</p>
<p><strong>右外连接：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT genshin.name, honkai3.age, honkai3.name</span><br><span class="line">	FROM genshin RIGHT JOIN honkai3 </span><br><span class="line">	ON genshin.age = honkai3.age; </span><br></pre></td></tr></table></figure>

<p>这个场合，honkai3 中无匹配记录的项也会显示</p>
<h2 id="22-8-约束"><a href="#22-8-约束" class="headerlink" title="22.8 约束"></a>22.8 约束</h2><blockquote>
<p>约束：用于确保数据库的数据满足特定的商业规则</p>
<p>约束包括：</p>
<ul>
<li>not null</li>
<li>unique</li>
<li>primary key</li>
<li>foreign key</li>
<li>check</li>
</ul>
</blockquote>
<h3 id="22-8-1-primary-key（主键）"><a href="#22-8-1-primary-key（主键）" class="headerlink" title="22.8.1 primary key（主键）"></a>22.8.1 primary key（主键）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">字段名 字段类型 primary key</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>主键</strong>：用于唯一的表示表行的数据。当定义主键约束后，<strong>该列不能重复</strong></p>
<h4 id="22-8-1-1-使用细节"><a href="#22-8-1-1-使用细节" class="headerlink" title="22.8.1.1 使用细节"></a>22.8.1.1 使用细节</h4><ol>
<li><p>主键不能重复，也不能为 NULL</p>
</li>
<li><p>一张表只能有一个主键。但，可以是复合主键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `temp1` </span><br><span class="line">	(`id` INT,</span><br><span class="line"> `name` CHAR(5),</span><br><span class="line"> `location` varchar(32),</span><br><span class="line"> PRIMARY KEY(`id`, `name`));</span><br></pre></td></tr></table></figure>

<p>这里，<code>(id, name)</code> 构成复合主键。id 和 name 都相同的，不能重复</p>
</li>
<li><p>主键的指定方式有两种：</p>
<ul>
<li><code>字段名 字段类型 primary key</code></li>
<li>（在表定义的最后写）<code>PRIMARY KEY(列名)</code></li>
</ul>
</li>
<li><p>在实际开发中，每个表往往都会设置一个主键</p>
</li>
</ol>
<h3 id="22-8-2-not-null（非空）"><a href="#22-8-2-not-null（非空）" class="headerlink" title="22.8.2 not null（非空）"></a>22.8.2 not null（非空）</h3><p><strong>非空</strong>：定义非空约束后，插入数据时，必须为该列提供数据。</p>
<h3 id="22-8-3-unique（唯一）"><a href="#22-8-3-unique（唯一）" class="headerlink" title="22.8.3 unique（唯一）"></a>22.8.3 unique（唯一）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">字段名 字段类型 unique</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>唯一</strong>：定义了唯一约束后，该列值是不能重复的。</p>
<p>……但是如果没有 not null 约束，则可以有多个 null 值</p>
<h3 id="22-8-4-foreign-key（外键）"><a href="#22-8-4-foreign-key（外键）" class="headerlink" title="22.8.4 foreign key（外键）"></a>22.8.4 foreign key（外键）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 从表</span><br><span class="line">...</span><br><span class="line">foreign key (从表列名) references 主表名(列名)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>外键</strong>：用于定义主表和从表间的关系。外键约束要定义在从表上，主表必须有主键或唯一约束。定义外键约束后，要求外键列数据必须在主表的主键列存在或为 null</p>
<h4 id="22-8-4-1-使用细节"><a href="#22-8-4-1-使用细节" class="headerlink" title="22.8.4.1 使用细节"></a>22.8.4.1 使用细节</h4><ol>
<li><p>外键指向的表的字段，要求是 primary key 或 unique</p>
</li>
<li><p>表的类型是 innodb，这样的表才支持外键</p>
</li>
<li><p>外键字段的类型要和主子段类型一致（可以长度不同）</p>
</li>
<li><p>外键字段的值，必须在主键字段中出现过，或（在外键字段允许的情况下）为 null</p>
</li>
<li><p>一旦确立主外键关系，数据就不能随意删除了（有任意记录指向主表某记录，该主表记录就不能删除）</p>
</li>
<li><p>如何删除外键：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TABLE 表名;							#1</span><br><span class="line">ALTER TABLE 表名 DROP FOREIGN KEY 外键名;		#2</span><br></pre></td></tr></table></figure>

<ol>
<li>查看该表创建语句，获取外键名称</li>
<li>删除外键</li>
</ol>
</li>
</ol>
<h3 id="22-8-5-check"><a href="#22-8-5-check" class="headerlink" title="22.8.5 check"></a>22.8.5 check</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">字段名 字段类型 check (条件)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>check</strong>：用于强制行数据必须满足的条件。（特别的，MySQL 5.7 中有 check 语法校验，但实际不生效）</p>
<h3 id="22-8-6-自增长"><a href="#22-8-6-自增长" class="headerlink" title="22.8.6 自增长"></a>22.8.6 自增长</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">字段名 字段类型 primary key auto_increment</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="22-8-6-1-使用细节"><a href="#22-8-6-1-使用细节" class="headerlink" title="22.8.6.1 使用细节"></a>22.8.6.1 使用细节</h4><ol>
<li><p>如果希望自增长，插入数据时该列插入 null</p>
</li>
<li><p>一般来说自增长是配合 primary key 使用的</p>
</li>
<li><p>自增长也能（配合 unique）单独使用</p>
</li>
<li><p>自增长修饰的字段是整数型的（小数类型也可以，但很少这样用）</p>
</li>
<li><p>自增长从 1 开始。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 auto_increment = 新的开始值;</span><br></pre></td></tr></table></figure>

<p>这样，能修改这个自增长的默认值</p>
</li>
<li><p>如果添加数据时，给自增长字段指定了具体的值，则以指定的值为准</p>
<p>一般来说，指定了自增长，就按自增长的规则添加顺序</p>
</li>
</ol>
<h2 id="22-9-索引"><a href="#22-9-索引" class="headerlink" title="22.9 索引"></a>22.9 索引</h2><p>索引：提高数据库性能，增加查询速度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX 索引名 ON 表名 (列名);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>没有索引时：</p>
<p>查询的场合总是会进行全表扫描</p>
</li>
<li><p>有索引时：</p>
<p>形成一个索引的数据结构（如二叉树），根据该结构进行查找</p>
<p>会造成磁盘的占用，且对 update delete insert 语句的效率产生影响</p>
</li>
</ul>
<p><strong>索引的类型</strong></p>
<ol>
<li><p>主键索引：primary key。主键自动为主索引</p>
</li>
<li><p>唯一索引：unique</p>
</li>
<li><p>普通索引：index</p>
</li>
<li><p>全文索引：fulltext</p>
<p>一般开发不用 MySQL 自带的全文索引，而是使用全文搜索（Solr）和ElasticSearch（ES）</p>
</li>
</ol>
<h3 id="22-9-1-索引的操作"><a href="#22-9-1-索引的操作" class="headerlink" title="22.9.1 索引的操作"></a>22.9.1 索引的操作</h3><ol>
<li><p>查询索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEXES FROM 表名;</span><br><span class="line">SHOW INDEX FROM 表名;</span><br><span class="line">SHOW KEYS FROM 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加唯一索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE UNIQUE INDEX 索引名 ON 表名(列名);</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加普通索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX 索引名 ON 表名(列名);</span><br><span class="line">ALTER TABLE 表名 ADD INDEX 索引名(列名);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果某列的值是不会重复的，则优先考虑唯一索引。否则用普通索引。</p>
</blockquote>
</li>
<li><p>添加主键索引（添加主键）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ADD PRIMARY KEY (列名);</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX 索引名 ON 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除主键索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为主键索引只有一个，所以不用指定列名</p>
</blockquote>
</li>
<li><p>修改索引：</p>
<p>先删除，再添加新的索引 <code>(●&#39;◡&#39;●)</code></p>
</li>
</ol>
<h3 id="22-9-2-创建规则"><a href="#22-9-2-创建规则" class="headerlink" title="22.9.2 创建规则"></a>22.9.2 创建规则</h3><ol>
<li>较频繁地作为查询条件字段 <strong>适合</strong> 作为索引</li>
<li>唯一性太差的字段（即使频繁作为查询条件）<strong>不适合</strong> 单独创建索引</li>
<li>更新非常频繁的字段 <strong>不适合</strong> 创建索引</li>
<li>不会出现在 WHERE 子句的字段 <strong>不应该</strong> 创建索引</li>
</ol>
<h2 id="22-10-事务"><a href="#22-10-事务" class="headerlink" title="22.10 事务"></a>22.10 事务</h2><blockquote>
<p>事务：用于保证数据的一致性，由一组相关的 dml 语句（update、insert、delete 语句）组成。该组 dml 语句要么全部成功，要么全部失败。比如转账就要用事务处理，以保证数据的一致性。</p>
<p>锁：执行事务操作时，MySQL 会在表上加锁，防止其他用户修改表的数据。这对用户来讲是非常重要的。</p>
</blockquote>
<h3 id="22-10-1-事务的操作"><a href="#22-10-1-事务的操作" class="headerlink" title="22.10.1 事务的操作"></a>22.10.1 事务的操作</h3><ul>
<li><p><code>start transaction</code>：开始一个事务</p>
</li>
<li><p><code>savepoint 保存点名</code>：设置保存点</p>
</li>
<li><p><code>rollback to 保存点名</code>：回退事务到特定保存点</p>
</li>
<li><p><code>rollback</code>：回退所有事务</p>
</li>
<li><p><code>commit</code>：提交事务，让所有操作生效。</p>
<p>执行该语句后，会确认事务的变化、删除保存点、释放锁，并让数据生效。</p>
<p>该语句不能回退。使用该语句后，其它会话（其他连接）将可以查看到事务变化后的新数据。</p>
</li>
</ul>
<h3 id="22-10-2-使用细节"><a href="#22-10-2-使用细节" class="headerlink" title="22.10.2 使用细节"></a>22.10.2 使用细节</h3><ol>
<li><p>如果不提交事务，默认情况下，dml 操作是自动提交的，不能回滚。</p>
</li>
<li><p>开始一个事务，没有创建保存点的场合，可以执行 rollback，默认回退到事务开始时的状态</p>
</li>
<li><p>可以在这个事务中创建多个保存点</p>
</li>
<li><p>可以在事务没有提交前选择回退到哪个保存点</p>
</li>
<li><p>MySQL 需要 innoDB 的存储引擎才可以使用。MyISAM 不行</p>
</li>
<li><p>开始事务：<code>start transaction</code></p>
<p>关闭默认自动提交事务：<code>set autocommit = off;</code></p>
</li>
</ol>
<h3 id="22-10-3-隔离级别"><a href="#22-10-3-隔离级别" class="headerlink" title="22.10.3 隔离级别"></a>22.10.3 隔离级别</h3><blockquote>
<p>隔离：多个连接开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个连接在获取数据时的准确性</p>
<p>隔离级别：定义了事务与事务之间的隔离程度。隔离级别是和事务相关的。</p>
<p>查看当前会话隔离级别：<code>select @@tx_isolation;</code></p>
</blockquote>
<p>如果不考虑隔离性，可能引发问题，如：</p>
<ul>
<li><p><strong>脏读（dirty read）</strong>：</p>
<p>当一个事务读取另一个事务尚未提交的修改时，产生脏读</p>
</li>
<li><p><strong>不可重复读（nonreapeatable read）</strong>：</p>
<p>同一查询在同一事务中多次进行，由于其他提交事务所做的修改或删除，每次返回不同的结果集，此时发生不可重复读</p>
</li>
<li><p><strong>幻读（phantom read）</strong>：</p>
<p>同一查询在同一事务中多次进行，由于其他提交事务所做的插入操作，每次返回不同的结果集，此时发生幻读</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>MySQL 隔离级别（4种）</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>加锁读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交（Read uncommitted）</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>不加锁</td>
</tr>
<tr>
<td>读已提交（Read committed）</td>
<td>×</td>
<td>√</td>
<td>√</td>
<td>不加锁</td>
</tr>
<tr>
<td>可重复读（Reapeatable read）</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>不加锁</td>
</tr>
<tr>
<td>可串行化（Serializable）</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>加锁</td>
</tr>
</tbody></table>
<p>MySQL 的默认隔离级别是 Reapeatable read，一般情况下不需要修改</p>
<h4 id="22-10-3-1-隔离级别的操作"><a href="#22-10-3-1-隔离级别的操作" class="headerlink" title="22.10.3.1 隔离级别的操作"></a>22.10.3.1 隔离级别的操作</h4><ol>
<li><p>查看当前会话隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@tx_isolation;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看系统隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@global.tx_isolation;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置当前会话隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set session transaction isolation level 隔离级别</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置系统隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transacion isolation level 隔离级别</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局修改：修改 mysql.ini 配置文件。</p>
<p>在 mysql.ini 文件的末尾加上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#设置默认隔离级别</span><br><span class="line">transaction-isolation = REPEATABLE-READ</span><br></pre></td></tr></table></figure>

<p>可选参数有：<code>READ-UNCOMMITTED</code>、<code>READ-COMMITTED</code>、<code>REPEATABLE-READ</code>、<code>SERIALIZABLE</code></p>
</li>
</ol>
<h3 id="22-10-4-事务的-ACID-特性"><a href="#22-10-4-事务的-ACID-特性" class="headerlink" title="22.10.4 事务的 ACID 特性"></a>22.10.4 事务的 ACID 特性</h3><ol>
<li><p><strong>原子性（Atomicity）</strong>：</p>
<p>事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生</p>
</li>
<li><p><strong>一致性（Consistency）</strong>：</p>
<p>事务必须使数据库从一个一致性状态变换到另外一个一致性状态</p>
</li>
<li><p><strong>隔离性（Isolation）</strong>：</p>
<p>多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰。多个并发事务之间相互隔离</p>
</li>
<li><p><strong>持久性（Durability）</strong>：</p>
<p>一个事务一旦被提交，它对数据库中数据的改变就是永久性的。接下来即使数据库发生故障也不应该对其有任何影响。</p>
</li>
</ol>
<h2 id="22-11-MySQL-表类型和存储引擎"><a href="#22-11-MySQL-表类型和存储引擎" class="headerlink" title="22.11 MySQL 表类型和存储引擎"></a>22.11 MySQL 表类型和存储引擎</h2><p>MySQL 的表类型由存储引擎（Storage Engines）决定，主要支持六种类型：CSV、Memory（常用）、ARCHIVE、MRG_MYISAM、MyISAM（常用）、InnoDB（常用）</p>
<p>这六类又分为两类：</p>
<ul>
<li>事务安全型（transaction-safe）：InnoDB</li>
<li>非事务安全型（non-transaction-safe）：其他类型都是非事务安全型</li>
</ul>
<table>
<thead>
<tr>
<th>特点</th>
<th>MyISAM</th>
<th>InnoDB</th>
<th>Memory</th>
<th>Archive</th>
</tr>
</thead>
<tbody><tr>
<td>批量插入速度</td>
<td>高</td>
<td>低</td>
<td>高</td>
<td>非常高</td>
</tr>
<tr>
<td>事务安全</td>
<td></td>
<td>支持</td>
<td></td>
<td></td>
</tr>
<tr>
<td>全文索引</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>锁机制</td>
<td>表锁</td>
<td>行锁</td>
<td>表锁</td>
<td>行锁</td>
</tr>
<tr>
<td>存储限制</td>
<td>无</td>
<td>64TB</td>
<td>有（内存）</td>
<td>无</td>
</tr>
<tr>
<td>B树索引</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>哈希索引</td>
<td></td>
<td>支持</td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>集群索引</td>
<td></td>
<td>支持</td>
<td></td>
<td></td>
</tr>
<tr>
<td>数据缓存</td>
<td></td>
<td>支持</td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>索引缓存</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>数据可压缩</td>
<td>支持</td>
<td></td>
<td></td>
<td>支持</td>
</tr>
<tr>
<td>空间使用</td>
<td>低</td>
<td>高</td>
<td>无</td>
<td>非常低</td>
</tr>
<tr>
<td>内存使用</td>
<td>低</td>
<td>高</td>
<td>中等</td>
<td>低</td>
</tr>
<tr>
<td>支持外键</td>
<td></td>
<td>支持</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ol>
<li>MyISAM 存储引擎不支持事务，也不支持外键。但其访问速度快，对事务完整性没有要求</li>
<li>InnoDB 存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但比起 MyISAM，InnoDB 写入的处理效率差一些，并且会占用更多磁盘空间以保留数据和索引。</li>
<li>Memory 存储引擎使用存在内存中的内容来创建表。每个 Memory 表只实际对应一个磁盘文件。Memory 类型的表访问得非常快，因为它的数据是放在内存中的，并且默认使用 HASH 索引。但是一旦 MySQL 服务关闭，表中的数据就会丢掉（表的结构还在）。</li>
</ol>
<h3 id="22-11-1-如何选择存储引擎"><a href="#22-11-1-如何选择存储引擎" class="headerlink" title="22.11.1 如何选择存储引擎"></a>22.11.1 如何选择存储引擎</h3><blockquote>
<ul>
<li>InnoDB：支持事务、支持外键、支持行级锁</li>
<li>MyISAM：添加速度快、不支持事务和外键、支持表级锁</li>
<li>Memory：数据存储在内存中、执行速度很快、默认支持索引（HASH 表）</li>
</ul>
</blockquote>
<ol>
<li>如果你的应用不需要事务，处理的只是基本的 CRUD 操作，那么 MyISAM 速度最快</li>
<li>如果需要支持事务，选择 InnoDB</li>
<li>Memory 数据存储在内存中，没有 I&#x2F;O 操作故而速度极快。但内存存储使得其任何修改都会在服务器重启后消失</li>
</ol>
<h2 id="22-12-视图"><a href="#22-12-视图" class="headerlink" title="22.12 视图"></a>22.12 视图</h2><blockquote>
<p>视图：一个虚拟表。其内容由查询定义。和其他表一样，视图含有列，其数据来源于真实的表（基表）</p>
</blockquote>
<ol>
<li>视图是根据基表来创建的。视图是虚拟的表</li>
<li>视图也有列，其中数据来自基表</li>
<li>通过视图可以改变基表的数据，基表的改变也会影响视图数据。</li>
</ol>
<h3 id="22-12-1-基本使用"><a href="#22-12-1-基本使用" class="headerlink" title="22.12.1 基本使用"></a>22.12.1 基本使用</h3><ul>
<li><p>创建视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW 视图名 AS SELECT语句;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER VIEW 视图名 AS SELECT语句;</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示创建视图的指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE VIEW 视图名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW  视图名1,视图名2;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="22-12-2-使用细节"><a href="#22-12-2-使用细节" class="headerlink" title="22.12.2 使用细节"></a>22.12.2 使用细节</h3><ol>
<li>创建视图后，数据库中只有一个视图结构文件，没有视图数据</li>
<li>视图的数据变化会影响基表，基表数据变化也会影响视图</li>
<li>视图中可以再使用视图</li>
</ol>
<h3 id="22-12-3-视图最佳实践"><a href="#22-12-3-视图最佳实践" class="headerlink" title="22.12.3 视图最佳实践"></a>22.12.3 视图最佳实践</h3><ul>
<li><p><strong>安全</strong>：</p>
<p>一些数据有不能让用户看到的重要信息。藉由建立一个视图，用户可以查询自己需要的字段，而不能查看保密的字段。</p>
</li>
<li><p><strong>性能</strong>：</p>
<p>关系数据库的数据常常分表存储，通过外键建立这些表之间的联系。此时，查询数据库会使用低效的连接（JOIN）。藉由建立一个视图，可以避免使用 JOIN 查询数据。</p>
</li>
<li><p><strong>灵活</strong>：</p>
<p>系统中有一张采用过时设计，即将废弃的旧表，但这张旧表不能轻易修改。藉由建立一个视图，把数据映射到新表，少做很多改动的同时达到了升级数据表的目的。</p>
</li>
</ul>
<h2 id="22-13-MySQL-管理"><a href="#22-13-MySQL-管理" class="headerlink" title="22.13 MySQL 管理"></a>22.13 MySQL 管理</h2><h3 id="22-13-1-用户管理"><a href="#22-13-1-用户管理" class="headerlink" title="22.13.1 用户管理"></a>22.13.1 用户管理</h3><blockquote>
<p>MySQL 的用户数据都储存在系统数据库 <code>mysql</code> 的表 <code>user</code> 中</p>
<p>不同的数据库用户登录到 DBMS 后，根据相应权限，可以操作的数据库和数据对象各不相同</p>
</blockquote>
<ol>
<li><p><code>user</code> 表的重要字段：</p>
<ul>
<li><p><code>host</code>：允许登录的位置。<code>localhost</code> 的场合表示该用户只允许本机登录。</p>
<p>也可以指定 ip 地址，如 <code>912.168.3.16</code></p>
</li>
<li><p><code>user</code>：用户名</p>
</li>
<li><p><code>authentication_string</code>：（通过 <code>password()</code> 函数加密后的）密码</p>
</li>
</ul>
</li>
<li><p>创建用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;用户名&#x27;@&#x27;允许登录位置&#x27; identified by &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure>

<p>创建用户，同时指定密码。</p>
<ul>
<li><p><code>@</code> 后面不能加空格</p>
</li>
<li><p>创建用户时，如果不指定 Host，默认为 <code>%</code>。</p>
<p><code>%</code> 表示所有 IP 都有连接权限</p>
</li>
<li><p>创建用户也可以这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;puppet&#x27;@&#x27;192.168.3.%&#x27; </span><br></pre></td></tr></table></figure>

<p>表示 192.168.3.* 的 IP 都可以登录用户</p>
</li>
</ul>
</li>
<li><p>删除用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP USER &#x27;用户名&#x27;@&#x27;允许登录位置&#x27;;</span><br></pre></td></tr></table></figure>

<p>删除用户时，如果 host 不是 <code>%</code>，需要明确指定 <code>&#39;用户&#39;@&#39;host&#39;</code></p>
</li>
<li><p>用户修改密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET PASSWORD = PASSWORD(&#x27;密码&#x27;);							#修改自己密码</span><br><span class="line">SET PASSWORD FOR &#x27;用户名&#x27;@&#x27;登录位置&#x27; = PASSWORD(&#x27;密码&#x27;);		#修改任意用户密码</span><br></pre></td></tr></table></figure>

<p>修改其他用户密码，需要拥有相应权限</p>
</li>
</ol>
<h3 id="22-13-2-权限管理"><a href="#22-13-2-权限管理" class="headerlink" title="22.13.2 权限管理"></a>22.13.2 权限管理</h3><ol>
<li><p>授予权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT 权限列表 ON 库.对象名 TO &#x27;用户名&#x27;@&#x27;登录位置&#x27; identified by &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>库.对象名</code> 是 <code>*.*</code> 的场合，代表本系统所有库的所有对象</p>
<p><code>identified by &#39;密码&#39;</code> 可省略。若写出，则用户存在即修改密码，不存在即创建用户。</p>
</li>
<li><p>回收用户权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE 权限列表 ON 库.对象名 FROM &#x27;用户名&#x27;@&#x27;登录位置&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>权限生效指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>如果权限没有生效，执行这个指令。</p>
</li>
</ol>
<p><strong>权限列表：</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>ALL</td>
<td>设置除 GRANT OPTION 外所有权限</td>
</tr>
<tr>
<td>ALTER</td>
<td>允许使用 <code>ALTER TABLE</code></td>
</tr>
<tr>
<td>ALTER ROUTINE</td>
<td>更改或取消已存储的子程序</td>
</tr>
<tr>
<td>CREATE</td>
<td>允许使用 <code>CREATE TABLE</code></td>
</tr>
<tr>
<td>CREATE ROUTINE</td>
<td>创建已存储的子程序</td>
</tr>
<tr>
<td>CREATE TEMPORARY TABLES</td>
<td>允许使用 <code>CREATE TEMPORARY TABLE</code></td>
</tr>
<tr>
<td>CREATE USER</td>
<td>允许使用 <code>CREATE USER</code>、<code>DROP USER</code>、<code>RENAME USER</code>、<code>REVOKE ALL PRIVILEGES</code></td>
</tr>
<tr>
<td>CREATE VIEW</td>
<td>允许使用 <code>CREATE VIEW</code></td>
</tr>
<tr>
<td>DELETE</td>
<td>允许使用 <code>DELETE</code></td>
</tr>
<tr>
<td>DROP</td>
<td>允许使用 <code>DROP TABLE</code></td>
</tr>
<tr>
<td>EXECUTE</td>
<td>允许用户运行已存储的子程序</td>
</tr>
<tr>
<td>FILE</td>
<td>允许使用 <code>SELECT…INTO OUTFILE</code>、<code>LOAD DATA INFILE</code></td>
</tr>
<tr>
<td>INDEX</td>
<td>允许使用 <code>CREATE INDEX</code>、<code>DROP INDEX</code></td>
</tr>
<tr>
<td>INSERT</td>
<td>允许使用 <code>INSERT</code></td>
</tr>
<tr>
<td>LOCK TABLES</td>
<td>允许对拥有 SELECT 权限的表使用 <code>LOCK TABLES</code></td>
</tr>
<tr>
<td>PROCESS</td>
<td>允许使用 <code>SHOW FULL PROCESSLIST</code></td>
</tr>
<tr>
<td>REFERENCES</td>
<td>-</td>
</tr>
<tr>
<td>RELOAD</td>
<td>允许使用 <code>FLUSH</code></td>
</tr>
<tr>
<td>REPLICATION CLIENT</td>
<td>允许用户询问从属服务器或主服务器的地址</td>
</tr>
<tr>
<td>REPLICATION SLAVE</td>
<td>用于复制星从属服务器（从主服务器中读取二进制日志事件）</td>
</tr>
<tr>
<td>SHOW DATABASE</td>
<td>允许使用 <code>SHOW DATABASE</code></td>
</tr>
<tr>
<td>SHOW VIEW</td>
<td>允许使用 <code>SHOW CREATE VIEW</code></td>
</tr>
<tr>
<td>SHUTDOWN</td>
<td>允许使用  <code>mysqladmin shutdown</code></td>
</tr>
<tr>
<td>SUPER</td>
<td>允许使用 <code>CHANGE MASTER</code>、<code>KILL</code>、<code>PURGE MASTER LOGS</code>、<code>SET GLOBAL</code> 语句，<code>mysqladmin debug</code> 命令。允许连接（一次），即使达到 max_connetions</td>
</tr>
<tr>
<td>UPDATE</td>
<td>允许使用 <code>UPDATE</code></td>
</tr>
<tr>
<td>USAGE</td>
<td>无权限</td>
</tr>
<tr>
<td>GRANT OPTION</td>
<td>允许授予权限</td>
</tr>
</tbody></table>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="F1-数据库"><a href="#F1-数据库" class="headerlink" title="F1 数据库"></a>F1 数据库</h2><p>数据、数据库、数据库管理系统、数据库系统 是数据库中最常用的 4 个基本概念。</p>
<p><strong>数据（Data）</strong>：数据是描述事物的符号记录，是信息存在的一种形式。只有通过解释或处理的数据才能称为有用的信息。</p>
<p><strong>数据库（Database）</strong>：数据按照一定格式存储在数据库内。数据库中存储的数据具有永久存储、有组织、可共享 这 3 个基本特点。</p>
<p><strong>数据库管理系统（Database Manage System，DBMS）</strong>：专门用于建立和管理数据库的一套软件。实现对数据有效的管理和维护。其主要功能包括：</p>
<ul>
<li>数据定义功能：通过数据库管理系统提供的数据定义语言（Data Definition Language，DDL）定义数据库中的数据对象（表、视图、存储过程、触发器等）。</li>
<li>数据操作功能：通过数据库管理系统提供的数据操作语言（Data Manipulation Language，DML）实现对数据的增删改查</li>
<li>数据库的运行管理功能：数据库的数据是可供多个用户同时使用的共享数据。DBMS 提供了统一的控制管理机制，保证并发使用的安全性，并在发生故障时能对数据库进行正确的恢复</li>
<li>数据库的建立维护功能：数据空间的维护、数据库的备份与恢复功能、数据库的重组织功能、性能监视、分析等</li>
<li>数据组织、存储、管理功能：数据库能对数据进行分类存储和管理以提高存取效率。例如索引查找、顺序查找等</li>
<li>其他功能：主要包括与其他软件的网络通信功能、不同数据库管理系统之间的数据传输及互相访问功能等</li>
</ul>
<p><strong>数据库系统（Database System）</strong>：在计算机中引入数据库技术之后的系统。一个完整的数据库系统包括数据库、数据库管理系统、相关实用工具、应用程序、数据库管理员和用户。其中数据库管理员最终通过 DBMS 维护数据库，用户（程序员和数据库终端用户）则是数据库的服务对象。</p>
<h3 id="F1-1-数据库的三级模式结构"><a href="#F1-1-数据库的三级模式结构" class="headerlink" title="F1.1 数据库的三级模式结构"></a>F1.1 数据库的三级模式结构</h3><p>不同的数据库管理系统基本上都遵循三级模式结构，即：用户级、概念级、物理级</p>
<p>具体而言，数据库系统的三级模式是指数据库系统是由：概念模式（Schema）、外模式（Exterrnal Schema）、内模式（Internal Schema）三级构成的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A(数据库) --- B[内模式] --模式/内模式映像--- C[概念模式]</span><br><span class="line">C --外模式/模式映像--- C1[外模式1]</span><br><span class="line">C --外模式/模式映像--- C2[外模式2]</span><br><span class="line">C --外模式/模式映像--- C3[外模式3]</span><br><span class="line">C1 --- C1A[应用A]</span><br><span class="line">C1 --- C1B[应用B]</span><br><span class="line">C2 --- C2C[应用C]</span><br><span class="line">C3 --- C3D[应用D]</span><br><span class="line">C3 --- C3E[应用E]</span><br></pre></td></tr></table></figure>

<h4 id="概念模式"><a href="#概念模式" class="headerlink" title="概念模式"></a>概念模式</h4><p>模式也称为概念模式或逻辑模式，它是数据库中全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图</p>
<p>模式实际上是数据库数据在逻辑级上的视图，即概念视图。其形式比数据的物理存储方式更为抽象。它不包含数据库的实现细节，仅定义数据的逻辑结构、数据间关系，以及数据相关的安全性、完整性等要求。</p>
<p>数据库按外模式的描述向用户提供数据，按内模式的描述存储数据。而模式是这两者的中间层。</p>
<p>模式不涉及物理存储细节和硬件环境，也无关于具体应用程序和开发语言。</p>
<p>一个数据库只有一个模式，且相对稳定。数据库管理系统提供了模式描述语言（Schema DDL），以严格定义模式。</p>
<h4 id="外模式"><a href="#外模式" class="headerlink" title="外模式"></a>外模式</h4><p>外模式也称为子模式或用户模式，它是数据库用户能看见和使用的局部数据的逻辑结构和特征的描述。</p>
<p>外模式是用户视图，通常是模式的子集，是对数据库整体数据结构的局部重构。如果不同用户在应用需求、看待数据的方式、对数据保密的要求方面存在差异，则外模式描述就不相同。模式中同样的数据，在外模式的表现可以不同。</p>
<p>一个数据库可以有多个不同外模式，且允许彼此间有重叠。一个外模式也可以被多个应用程序共享。</p>
<p>外模式简化了数据库系统的用户接口，便于用户使用，并有效支持了数据独立性和共享性。</p>
<p>数据库管理系统提供了子模式描述语言（Subschema DDL），以严格定义子模式。</p>
<h4 id="内模式"><a href="#内模式" class="headerlink" title="内模式"></a>内模式</h4><p>内模式也称为存储模式，是对数据库中数据物理结构和存储方式的描述，是数据库在内部的表示形式。</p>
<p>内模式是整个数据库的最底层表示。不同于物理层，是数据库管理员看到的，特定数据库管理系统所处理的数据库的内部结构，即内部视图或存储视图</p>
<p>一个数据库只有一个内模式。内模式不是最底层的物理层。数据库管理系统提供了内模式描述语言，以严格定义内模式。</p>
<h3 id="F1-2-映像与数据独立性"><a href="#F1-2-映像与数据独立性" class="headerlink" title="F1.2 映像与数据独立性"></a>F1.2 映像与数据独立性</h3><p>构成数据库系统的三级模式分别是对数据的三级抽象。它们彼此间具有以下特点</p>
<ul>
<li>一个数据库的整体逻辑结构和特征的描述（概念模式）独立于数据库其他层次结构（内&#x2F;外模式）。概念模式是数据库的核心，也是数据库设计的关键</li>
<li>一个数据库的内部存储模式依赖于概念模式，但独立于外模式，也独立于具体的存储设备。</li>
<li>外模式是在全局逻辑结构基础上定义的，其面向具体的应用程序，特定的应用程序依赖于特定的外模式。外模式独立于概念模式和内模式。</li>
</ul>
<p>数据库管理系统通过在内部提供三级模式间的两层映像，实现三级抽象和它们间的联系与转换。</p>
<p>这两层映像是：外模式&#x2F;模式映像、模式&#x2F;内模式映像</p>
<p>由于这两层映像的存在，使得数据库系统中的数据能具有较高 <strong>逻辑独立性</strong> 和 <strong>物理独立性</strong>。数据的定义和描述从应用程序中分离，从而简化了程序开发，也降低了维护难度。</p>
<h4 id="外模式-x2F-模式映像"><a href="#外模式-x2F-模式映像" class="headerlink" title="外模式&#x2F;模式映像"></a>外模式&#x2F;模式映像</h4><p>所谓映像，即是一种对应规则。外模式&#x2F;模式映像 定义了各个外模式和概念模式间的关系，这些映像通常在各自的外模式中加以描述。对于每个外模式，都会有一个 外模式&#x2F;模式映像</p>
<p>数据库系统的概念模式改变时，外模式&#x2F;模式映像 都要相应改变，以使外模式保持不变。由于 外模式&#x2F;模式映像 的存在，数据库管理员不必修改依赖外模式的应用程序本身。这样，就实现了外模式不受概念模式变化的影响，也保证了数据与程序的逻辑独立性。</p>
<h4 id="模式-x2F-内模式映像"><a href="#模式-x2F-内模式映像" class="headerlink" title="模式&#x2F;内模式映像"></a>模式&#x2F;内模式映像</h4><p>模式&#x2F;内模式映像 定义了数据库全局逻辑结构和物理存储间的关系。这种映像定义通常是在概念模式中加以描述的。数据库只有一个概念模式，也就只有一个 模式&#x2F;内模式映像。</p>
<p>数据库系统的物理存储改变时，数据库管理员要对 模式&#x2F;内模式映像 进行调整，以使概念模式保持不变。如此也实现了概念模式不受内模式变化的影响，并保证了数据与程序的物理独立性。</p>
<h3 id="F1-3-数据模型"><a href="#F1-3-数据模型" class="headerlink" title="F1.3 数据模型"></a>F1.3 数据模型</h3><p>一般而言，数据具有动态、静态两种特征。</p>
<ul>
<li>数据的静态特征：数据的基本结构、数据间的联系、对数据取值范围的约束</li>
<li>数据的动态特征：对数据可以进行符合一定规则的操作</li>
</ul>
<p>数据模型是一组概念和定义，用来描述数据的结构、定义、在结构上的操纵以及数据间的约束</p>
<h4 id="数据模型的三个要素"><a href="#数据模型的三个要素" class="headerlink" title="数据模型的三个要素"></a>数据模型的三个要素</h4><p>数据模型通常有三个要素：数据结构、数据操作、数据约束</p>
<ul>
<li><p>数据结构</p>
<p>数据结构描述系统的静态特性。其反映了数据模型最基本的特征。</p>
<p>常按照数据结构类型来命名数据模型。如：层次模型、网状模型、关系模型、面向对象模型</p>
</li>
<li><p>数据操作</p>
<p>数据操作描述系统的动态特性，是对对象实例允许执行的操作的集合。</p>
<p>数据操作分为两类：更新（插入、删除、修改）、检索</p>
</li>
<li><p>数据约束</p>
<p>数据约束描述数据结构中数据间的语法和语义关联，以保证数据的正确性、有效性和相容性</p>
<p>数据约束包括：完整性约束、数据安全性约束、并发控制约束</p>
</li>
</ul>
<h4 id="数据模型的分类"><a href="#数据模型的分类" class="headerlink" title="数据模型的分类"></a>数据模型的分类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(现实世界) --抽象--&gt; B(概念模型) --转换/组织--&gt; C(逻辑模型/物理模型)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>概念层数据模型</p>
<p>概念层是数据抽象级别的最高层。概念层数据模型也称 概念模型 或 信息模型。</p>
<p>概念模型描述现实世界的事物，而与具体计算机系统无关。</p>
</li>
<li><p>逻辑层数据模型</p>
<p>逻辑层是数据抽象的中间层，也称为数据的逻辑模型</p>
<p>逻辑模型描述数据整体的逻辑结构，既要考虑用户理解，也要照顾具体实现</p>
<p>任何数据库都是基于某种逻辑数据模型。</p>
<ul>
<li><p>层次模型</p>
<p>是数据库最早使用的一种类型。其数据结构是一棵有向树，每个结点对应一个记录集。</p>
<p>现实中的组织结构就是层次结构。但层次模型难以表达现实中实体间的复杂联系。</p>
</li>
<li><p>网状模型</p>
<p>是层次模型的扩展，以网状结构表示实体间的联系。</p>
<p>网状模型可以方便地表示实体间的联系，但结构复杂，难以规范化地实现。</p>
</li>
<li><p>关系模型</p>
<p>是层次模型的扩展，用二维表来表示实体及实体间联系。</p>
<p>关系模型建立在严格的数学概念之上。其概念单一，数据结构简单，便于理解。而且，关系模型的存取路径对用户透明，具有更高的数据独立性和安全性，也便于程序员开发和管理。</p>
</li>
<li><p>面向对象模型</p>
<p>面向对象方法与数据库结合所构成的数据模型称为面向对象模型。</p>
<p>面向对象模型既是概念模型又是逻辑模型。其表达能力丰富，对象复用性强，维护方便，是数据库的发展方向之一。</p>
</li>
</ul>
</li>
<li><p>物理层数据模型</p>
<p>也称为数据的物理模型。</p>
<p>物理模型描述数据在存储介质上的组织结构，是逻辑模型的物理实现。每种逻辑模型都有对应的物理模型。</p>
<p>物理模型的设计目标是提高数据库性能和有效利用空间。其不仅由数据库设计决定，也与操作系统、计算机硬件密切相关。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/22/22%20MySQL/" data-id="claq1vt5k0013twtfhdv623mk" data-title="&lt;Java&gt;22 MySQL" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-21 反射" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01public/20/21%20%E5%8F%8D%E5%B0%84/" class="article-date">
  <time class="dt-published" datetime="2022-01-19T16:00:00.000Z" itemprop="datePublished">2022-01-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01public/20/21%20%E5%8F%8D%E5%B0%84/">&lt;Java&gt;21 反射</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="21-反射"><a href="#21-反射" class="headerlink" title="21 反射"></a>21 反射</h1><blockquote>
<ol>
<li>反射机制（Reflection）允许程序在执行期借助于 Reflection API 取得任何类的内部信息（如成员变量、成员方法等），并能操作对象的属性及方法。反射在设计模式和框架底层都会用到。</li>
<li>加载完类之后，在堆中就产生了一个 <code>Class</code> 类型的对象（一个类只有一个 <code>Class</code> 对象），这个对象包含了类的完整结构信息。通过这个对象得到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构。所以，形象地称之为：反射</li>
</ol>
<p>ocp 原则（开闭原则）：不修改源码来扩展功能</p>
</blockquote>
<p><strong>计算机的三个阶段</strong></p>
<ol>
<li><p>代码阶段 &#x2F; 编译阶段</p>
<blockquote>
<p>编写代码 ——（Javac 编译）——&gt; .class 字节码文件</p>
</blockquote>
</li>
<li><p>Class 类阶段 &#x2F; 加载阶段</p>
<blockquote>
<p>字节码文件 ——（ClassLoader 类加载器）——&gt; <code>Class</code> 类对象（堆中）· 字节码二进制数据 &#x2F; 元数据（方法区）</p>
<p><code>Class</code> 类对象包含：成员变量 <code>Field[] fields</code>、构造器 <code>Constructor[] cons</code>、成员方法 <code>Methord[] ms</code></p>
</blockquote>
</li>
<li><p>Runtime 运行阶段</p>
<blockquote>
<p>创建对象，该对象知道其属于哪个 <code>Class</code> 对象</p>
</blockquote>
</li>
</ol>
<p><strong>反射机制可以完成</strong></p>
<ol>
<li>在运行时判断任意一个对象所属的类</li>
<li>在运行时构造任意一个类的对象</li>
<li>在运行时得到任意一个类所具有的成员变量和方法</li>
<li>在运行时调用任意一个对象的成员变量和方法</li>
<li>生成动态代理</li>
</ol>
<h2 id="21-1-反射相关的常用类"><a href="#21-1-反射相关的常用类" class="headerlink" title="21.1 反射相关的常用类"></a>21.1 反射相关的常用类</h2><ol>
<li><p><code>java.lang.Class</code>：代表一个类。<code>Class</code> 对象表示某个类加载后在堆中的对象</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> Class.forName(classFullPath);			<span class="comment">//[1]</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> cls.newInstance();						<span class="comment">//[2]</span></span><br></pre></td></tr></table></figure>

<ol>
<li>通过完整类名得到一个类的 Class 对象</li>
<li>通过该 Class 对象创建一个该类的 对象实例</li>
</ol>
</blockquote>
</li>
<li><p><code>java.lang.reflect.Method</code>：代表类的方法。<code>Method</code> 对象表示某个类的某个方法</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(methodName);			<span class="comment">//[1]</span></span><br><span class="line">method.invoke(o);									<span class="comment">//[2]</span></span><br></pre></td></tr></table></figure>

<ol>
<li>通过该 Class 对象得到一个 方法对象</li>
<li>方法对象.invoke：调用该方法</li>
</ol>
</blockquote>
</li>
<li><p><code>java.lang.reflect.Field</code>：代表类的成员变量</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> cls.getField(fieldName);				<span class="comment">//[1]</span></span><br></pre></td></tr></table></figure>

<ol>
<li>该方法只能得到非私有对象</li>
</ol>
</blockquote>
</li>
<li><p><code>java.lang.reflect.Constructor</code>：代表类的构造方法</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> cls.getConstructor();		<span class="comment">//[1]</span></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor2</span> <span class="operator">=</span> cls.getConstructor(String.class)</span><br><span class="line">    													<span class="comment">//[2]</span></span><br></pre></td></tr></table></figure>

<ol>
<li>得到一个无参构造器</li>
<li>得到一个形参是 <code>(String str)</code> 的构造器</li>
</ol>
</blockquote>
</li>
</ol>
<p><strong>反射的优点和缺点</strong></p>
<ul>
<li>优点：可以动态地创建和使用对象（也是框架底层核心），使用灵活。没有反射机制，框架技术就失去底层支撑</li>
<li>缺点：使用反射基本是解释执行。这对执行速度有影响。</li>
</ul>
<p><strong>反射调用优化 - 关闭访问检查</strong></p>
<ol>
<li><p><code>Method</code> 和 <code>Field</code>、<code>Constructor</code> 对象都有 <code>setAccessible()</code> 方法</p>
</li>
<li><p><code>setAccessible()</code> 作用是启动和禁用访问安全检查的开关</p>
</li>
<li><p>参数值为 true，表示反射对象在使用时取消访问检查，这样能提高反射效率。</p>
<p>为 false 表示执行访问检查</p>
</li>
</ol>
<h2 id="21-2-Class-类"><a href="#21-2-Class-类" class="headerlink" title="21.2 Class 类"></a>21.2 <code>Class</code> 类</h2><ol>
<li><code>Class</code> 也是类，因此也继承 <code>Object</code> 类</li>
<li><code>Class</code> 类不是 new 出来的，而是系统创建的</li>
<li>对于某个类的 <code>Class</code> 类对象，在内存中只有一份，因为类只加载一次</li>
<li>每个类的实例都会记得自己是由哪个 <code>Class</code> 实例生成</li>
<li>通过 <code>Class</code> 可以完整地得到一个类的完整结构，通过一系列 API</li>
<li><code>Class</code> 对象是存放在堆的</li>
<li>类的字节码二进制数据，是放在方法区的。有的地方称为类的元数据（包括 方法代码、变量名、方法名、访问权限 等）</li>
</ol>
<h3 id="21-2-1-Class-类的常用方法"><a href="#21-2-1-Class-类的常用方法" class="headerlink" title="21.2.1 Class 类的常用方法"></a>21.2.1 <code>Class</code> 类的常用方法</h3><ul>
<li><p><code>Class.forName(String)</code>：返回指定类名的 <code>Class</code> 对象</p>
</li>
<li><p><code>newInstance()</code>：返回一个无参构造器创建的实例</p>
</li>
<li><p><code>getName()</code>：返回该 <code>Class</code> 对象表示的实体的全类名</p>
</li>
<li><p><code>getClass()</code>：返回该 <code>Class</code> 对象的运行类型 <code>java.lang.Class</code></p>
</li>
<li><p><code>getPackage()</code>：返回该 <code>Class</code> 对象所在的包</p>
</li>
<li><p><code>getSuperClass()</code>：返回该 <code>Class</code> 对象的父类 <code>Class</code> 对象</p>
</li>
<li><p><code>getInterface()</code>：返回该 <code>Class</code> 对象的接口（数组）</p>
</li>
<li><p><code>getAnnotations()</code>：返回注解信息（<code>Annotation[]</code>）</p>
</li>
<li><p><code>getClassLoader()</code>：返回该 <code>Class</code> 对象的加载器（<code>ClassLoader</code> 类型）</p>
</li>
<li><p><code>getSuperclass()</code>：返回该 <code>Class</code> 对象实体的超类的 <code>Class</code></p>
</li>
<li><p><code>getConstructors()</code>：返回本类所有包含 <code>public</code> 修饰的构造器的 <code>Constructor</code> 对象数组</p>
<p>该方法返回的构造器不含父类构造器！</p>
</li>
<li><p><code>getDeclaredConstructer()</code>：返回本类所有构造器的 <code>Constructor</code> 对象数组</p>
</li>
<li><p><code>getFileds()</code>：返回一个包含 <code>public</code> 修饰的属性的 <code>Field</code> 对象的数组</p>
<p><code>getFiled(String name)</code>：返回指定的 <code>Field</code></p>
</li>
<li><p><code>getDeclaredFields()</code>：获取本类中所有属性</p>
</li>
<li><p><code>field.get(instance)</code>：返回指定实例的指定属性</p>
</li>
<li><p><code>field.set(instance, ..)</code>：给指定实例的指定属性赋值</p>
</li>
<li><p><code>getMethod()</code>：获得所有 <code>public</code> 修饰的方法的 <code>Method</code> 对象</p>
</li>
<li><p><code>getMethod(String name, Class paramTypes, ...)</code>：返回一个 <code>Method</code> 对象，其形参类型为 paramType</p>
</li>
<li><p><code>getDeclaredMethod()</code>：获取本类中所有方法</p>
</li>
</ul>
<h3 id="21-2-2-获取-Class-对象"><a href="#21-2-2-获取-Class-对象" class="headerlink" title="21.2.2 获取 Class 对象"></a>21.2.2 获取 <code>Class</code> 对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.note;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>（编译阶段）已知一个类的全类名，且该类在类路径下：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.melody.note.Test&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>应用场景：配置文件，读取类全路径，加载类。</p>
<p>可能抛出 <code>ClassNotFoundExcption</code></p>
</blockquote>
</li>
<li><p>（加载阶段）已知具体的类：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls2</span> <span class="operator">=</span> Test.class;</span><br></pre></td></tr></table></figure>

<p>应用场景：参数传递。</p>
<p>该方法最为安全</p>
</blockquote>
</li>
<li><p>（运行阶段）已知某个类的实例：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>().getClass();</span><br></pre></td></tr></table></figure>

<p>应用场景：通过创建好的对象获取 <code>Class</code> 对象</p>
</blockquote>
</li>
<li><p>通过类加载器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">cll</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>().getClass().getClassLoader();</span><br><span class="line"><span class="type">Class</span> <span class="variable">cls4</span> <span class="operator">=</span> cll.loadClass(<span class="string">&quot;com.melody.note.Test&quot;</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>基本数据类型：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clsB1</span> <span class="operator">=</span> <span class="type">int</span>.class;</span><br><span class="line">Class&lt;Boolean&gt; clsB2 = <span class="type">boolean</span>.class;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>基本数据类型包装类：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clsB3</span> <span class="operator">=</span> Character.TYPE;</span><br><span class="line">Class&lt;Long&gt; clsB4 = Long.TYPE;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="21-2-3-哪些类有-Class-对象"><a href="#21-2-3-哪些类有-Class-对象" class="headerlink" title="21.2.3 哪些类有 Class 对象"></a>21.2.3 哪些类有 <code>Class</code> 对象</h3><ol>
<li>外部类、成员内部类、静态内部类、局部内部类、匿名内部类</li>
<li>接口（interface）</li>
<li>数组</li>
<li>枚举（enum）</li>
<li>注解</li>
<li>基本数据类型</li>
<li>void</li>
</ol>
<h2 id="21-3-类的加载"><a href="#21-3-类的加载" class="headerlink" title="21.3 类的加载"></a>21.3 类的加载</h2><p><strong>基本说明</strong></p>
<blockquote>
<p>反射机制是 Java 实现动态语言的关键，也就是通过反射实现类动态加载</p>
</blockquote>
<ol>
<li>静态加载：编译时加载相关的类，如果没有则报错。依赖性强</li>
<li>静态加载：运行时加载需要的类，如果运行时不用该类，则不报错。降低了依赖性</li>
</ol>
<p><strong>类加载时机</strong></p>
<ol>
<li>创建对象时（new） [静态加载]</li>
<li>子类被加载时，父类也被加载 [静态加载]</li>
<li>调用类中的静态成员 [静态加载]</li>
<li>通过反射 [动态加载]</li>
</ol>
<p><img src="/img/Java_InputImage/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%9B%BE_21.3.png"></p>
<p><em>（类加载图_21.3）</em></p>
<ul>
<li><p>加载（Loading）：</p>
<p>将类的 .class 文件读入内存，并为之创建一个 java.lang.Class 对象。此过程由类加载器完成</p>
</li>
<li><p>连接（Linking）：</p>
<p>将类的二进制数据合并进 JRE 中</p>
</li>
<li><p>初始化（initialization）：</p>
<p>JVM 负责对类进行初始化。这里主要是静态成员</p>
</li>
</ul>
<h3 id="21-3-1-类加载的五个阶段"><a href="#21-3-1-类加载的五个阶段" class="headerlink" title="21.3.1 类加载的五个阶段"></a>21.3.1 类加载的五个阶段</h3><ul>
<li><p><strong>加载阶段</strong></p>
<p>JVM 在该阶段的主要目的是将字节码从不同数据源（.class 文件、jar 包、网络等）转化为二进制字节流加载到内存中，并生成一个代表该类的 <code>java.lang.Class</code> 对象</p>
</li>
<li><p><strong>连接阶段 - 验证</strong></p>
<p>目的是确保 <code>Class</code> 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。</p>
<p>包括：文件格式验证（是否以魔数 0xcafebabe 开头）、元数据验证、字节码验证、符号引用验证</p>
<p>可以考虑使用 <code>-Xverify:none</code> 参数来关闭大部分的类验证措施，以缩短虚拟机加载的时间</p>
</li>
<li><p><strong>连接阶段 - 准备</strong></p>
<p>JVM 会在该阶段对 静态变量 分配内存并执行默认初始化。这些变量使用的内存都将在方法区中进行分配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="number">1</span>;					<span class="comment">//实例属性，非静态变量，此阶段不分配内存</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> <span class="number">2</span>;			<span class="comment">//静态变量，默认初始化为 0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">n3</span> <span class="operator">=</span> <span class="number">3</span>;		<span class="comment">//static final 常量，静态初始化为 3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>连接阶段 - 解析</strong></p>
<p>JVM 将常量池内符号引用替换为直接引用的过程</p>
</li>
<li><p><strong>初始化</strong></p>
<p>到初始化阶段，才真正开始执行类中定义的 Java 程序代码。此阶段是执行 <code>&lt;clinit&gt;()</code> 方法的过程</p>
<p><code>&lt;clinit&gt;()</code> 方法是由编译器按语句在文件中出现的顺序，依次自动收集类中所有静态变量的赋值动作和静态代码块中的语句，并进行合并</p>
<p>JVM 会保证一个类的 <code>&lt;clinit&gt;()</code> 方法在多线程环境中被正确地加锁、同步。如果多个线程去初始化一个类，那么只会有一个线程去执行这个类的 <code>&lt;clinit&gt;()</code> 方法，其他线程都需要阻塞等待，直到活动线程执行 <code>&lt;clinit&gt;()</code> 方法完毕</p>
</li>
</ul>
<h2 id="21-4-通过反射获取类的结构信息"><a href="#21-4-通过反射获取类的结构信息" class="headerlink" title="21.4 通过反射获取类的结构信息"></a>21.4 通过反射获取类的结构信息</h2><p><strong><code>java.lang.Class</code> 类（与前面的的重复）</strong></p>
<blockquote>
<ul>
<li><p><code>getSuperClass()</code>：返回该 <code>Class</code> 对象的父类 <code>Class</code> 对象</p>
</li>
<li><p><code>getInterface()</code>：返回该 <code>Class</code> 对象的接口（数组）</p>
</li>
<li><p><code>getAnnotations()</code>：返回注解信息（<code>Annotation[]</code>）</p>
</li>
<li><p><code>getClassLoader()</code>：返回该 <code>Class</code> 对象的加载器（<code>ClassLoader</code> 类型）</p>
</li>
<li><p><code>getSuperclass()</code>：返回该 <code>Class</code> 对象实体的超类的 <code>Class</code></p>
</li>
<li><p><code>getConstructors()</code>：返回本类所有包含 <code>public</code> 修饰的构造器的 <code>Constructor</code> 对象数组</p>
<p>该方法返回的构造器不含父类构造器！</p>
</li>
<li><p><code>getDeclaredConstructer()</code>：返回本类所有构造器的 <code>Constructor</code> 对象数组</p>
</li>
<li><p><code>getFileds()</code>：返回一个包含 <code>public</code> 修饰的属性的 <code>Field</code> 对象的数组</p>
<p><code>getFiled(String name)</code>：返回指定的 <code>Field</code></p>
</li>
<li><p><code>getDeclaredFields()</code>：获取本类中所有属性</p>
</li>
<li><p><code>field.get(instance)</code>：返回指定实例的指定属性</p>
</li>
<li><p><code>field.set(instance, ..)</code>：给指定实例的指定属性赋值</p>
</li>
<li><p><code>getMethod()</code>：获得所有 <code>public</code> 修饰的方法的 <code>Method</code> 对象</p>
</li>
<li><p><code>getMethod(String name, Class paramTypes, ...)</code>：返回一个 <code>Method</code> 对象，其形参类型为 paramType</p>
</li>
<li><p><code>getDeclaredMethod()</code>：获取本类中所有方法</p>
</li>
</ul>
</blockquote>
<p><strong><code>java.lang.reflect.Field</code> 类</strong></p>
<blockquote>
<ul>
<li><p><code>getModifiers()</code>：以 int 形式返回修饰符</p>
<p>默认修饰符 [0]、public [1]、private [2]、protected [4]、static [8]、final [16]</p>
<p>示例：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>这个变量的修饰符的 int 表示 &#x3D; 1 + 8 + 16 &#x3D; 25</p>
</blockquote>
</li>
<li><p><code>getType()</code>：以 <code>Class</code> 形式返回类型</p>
<blockquote>
<p>上例变量的 <code>getType()</code> 等同于 <code>Integer.getClass()</code></p>
</blockquote>
</li>
<li><p><code>getName()</code>：返回属性名</p>
</li>
</ul>
</blockquote>
<p><strong><code>java.lang.reflect.Method</code> 类</strong></p>
<blockquote>
<ul>
<li><code>getModifiers()</code>：以 int 形式返回修饰符（同上）</li>
<li><code>getName()</code>：返回方法名</li>
<li><code>getReturnType()</code>：以 <code>Class</code> 形式返回返回类型</li>
<li><code>getParameterTypes()</code>：以 <code>Class[]</code> 形式返回形参类型数组</li>
</ul>
</blockquote>
<p><strong><code>java.lang.reflect.Constructer</code> 类</strong></p>
<blockquote>
<ul>
<li><code>getModifiers()</code>：以 int 形式返回修饰符</li>
<li><code>getName()</code>：返回构造器名（和全类名相等）</li>
<li><code>getParameterTypes()</code>：以 <code>Class[]</code> 形式返回形参类型数组</li>
</ul>
</blockquote>
<h2 id="21-5-通过反射创建对象"><a href="#21-5-通过反射创建对象" class="headerlink" title="21.5 通过反射创建对象"></a>21.5 通过反射创建对象</h2><ol>
<li><p>调用类中的 public 修饰的无参构造器</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj1</span> <span class="operator">=</span> cls.newInstance();</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>调用类中指定的构造器</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Constructer</span> <span class="variable">cons</span> <span class="operator">=</span> cls.getConstructer(<span class="type">int</span>.class, String.class, ...);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj2</span> <span class="operator">=</span> cons.newInstance(<span class="number">1</span>, <span class="string">&quot;nnn&quot;</span>, ...);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>setAccessible(true)</code>：爆破（暴力破解）。使用反射可以访问 private 构造器</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Constructer</span> <span class="variable">cons2</span> <span class="operator">=</span> cls.getDeclaredConstructer(<span class="type">boolean</span>.class ...);</span><br><span class="line">cons2.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj3</span> <span class="operator">=</span> cons.newInstance(<span class="literal">false</span>, ...);</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h2 id="21-6-通过反射访问成员"><a href="#21-6-通过反射访问成员" class="headerlink" title="21.6 通过反射访问成员"></a>21.6 通过反射访问成员</h2><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> cla.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">field.set(o, <span class="string">&quot;111&quot;</span>);								<span class="comment">//[1]</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>o 表示一个类的实例</p>
<p>如果该属性是静态属性，则对象 o 可以是 null</p>
</li>
</ol>
</blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getDeclaredMethod(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">method.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(o, <span class="string">&#x27;c&#x27;</span>, ...);		<span class="comment">//[1]</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>o 表示一个类的实例，后面是实参列表</p>
<p>同理，静态方法的场合，对象 o 可以是 null</p>
</li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01public/20/21%20%E5%8F%8D%E5%B0%84/" data-id="claq1vt5m001atwtf402xcd06" data-title="&lt;Java&gt;21 反射" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20 项目：多用户通讯系统" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/16public/20%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%A4%9A%E7%94%A8%E6%88%B7%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time class="dt-published" datetime="2022-01-15T16:00:00.000Z" itemprop="datePublished">2022-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/16public/20%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%A4%9A%E7%94%A8%E6%88%B7%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/">&lt;Java&gt;20 项目（多用户通讯系统）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="20-项目：多用户通讯系统"><a href="#20-项目：多用户通讯系统" class="headerlink" title="20 项目：多用户通讯系统"></a>20 项目：多用户通讯系统</h1><blockquote>
<p><strong>项目见（多用户通讯系统）</strong></p>
<p>服务端启动位置（多用户通讯系统\项目：通讯系统（服务端）\src\com\melody\transmission\common\ClientConnect.java）</p>
<p>客户端启动位置（项目：通讯系统（客户端）\src\com\melody\transmission\Test1.java）</p>
</blockquote>
<h2 id="20-1-需求分析"><a href="#20-1-需求分析" class="headerlink" title="20.1 需求分析"></a>20.1 需求分析</h2><ol>
<li>用户登录</li>
<li>拉取在线用户列表</li>
<li>无异常退出（客户端、服务端）</li>
<li>私聊</li>
<li>群聊</li>
<li>发文件</li>
<li>服务器推送新闻</li>
</ol>
<h3 id="20-1-1-登录"><a href="#20-1-1-登录" class="headerlink" title="20.1.1 登录"></a>20.1.1 登录</h3><p><strong>服务端</strong></p>
<ol>
<li>客户端连接到服务器后，会得到一个 <code>Socket</code></li>
<li>启动一个线程，该线程持有该 <code>Socket</code> 对象</li>
<li>为了更好地管理线程，需要使用集合来管理</li>
</ol>
<p><strong>客户端</strong></p>
<ol>
<li>和服务端通信时，使用对象方式，可以使用对象流来读写</li>
<li>客户端连接到服务端后，也会得到 <code>Socket</code></li>
<li>启动一个线程，该线程持有该 <code>Socket</code> 对象</li>
<li>为了更好地管理线程，需要使用集合来管理</li>
</ol>
<h3 id="20-1-2-无异常退出"><a href="#20-1-2-无异常退出" class="headerlink" title="20.1.2 无异常退出"></a>20.1.2 无异常退出</h3><blockquote>
<p>写下面内容的之前，我已经把代码都完成了。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fh411y7R8?p=688&t=0.8">韩老师的思路</a>都是最基本的思路，这些其实应该不参考笔记自己去想。</p>
<p>想不通的地方才看答案（笔记），我认为是比较好的方法。</p>
</blockquote>
<p><strong>服务端</strong></p>
<ol>
<li>服务器端和某个客户端通信的线程接到一个退出请求后，关闭 socket 并退出线程</li>
</ol>
<p><strong>客户端</strong></p>
<ol>
<li>调用方法，向服务端发送登出请求，之后客户端调用方法正常退出</li>
</ol>
<h3 id="下略"><a href="#下略" class="headerlink" title="下略"></a>下略</h3><blockquote>
<p>没记</p>
</blockquote>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="多用户通讯系统"><a href="#多用户通讯系统" class="headerlink" title="多用户通讯系统"></a>多用户通讯系统</h3><p>开始写的时候思路没整理好，最后乱七八糟的</p>
<p>又没什么注释，所以别往下翻了</p>
<h4 id="通用部分（客户端-amp-服务端）"><a href="#通用部分（客户端-amp-服务端）" class="headerlink" title="通用部分（客户端 &amp; 服务端）"></a>通用部分（客户端 &amp; 服务端）</h4><blockquote>
<p>MyTools.java：工具类</p>
<p>UserData.java：用户数据类，包含完整的用户信息。这些信息存储在服务端。每个客户端只可能在验证通过的场合，持有最多一个来自服务端的属于客户自己的该类对象</p>
<p>User.java：简易的用户类。只是用以传递一组账号和密码。一般由客户端发送往服务端。这些账号和密码未必是正确的。</p>
<p>Message.java：数据包。客户端和服务端的所有通信都以传递该数据包的形式进行。</p>
<p>MessageType.java：代码表。客户端和服务端各自持有一份相同的该表，用以对数据包进行识别。</p>
</blockquote>
<ul>
<li><p><strong>MyTools.java</strong></p>
<p>精简了一下放上来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTools</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Scanner</span> <span class="variable">inp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个方法能读取一个 输入流 的内容</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] whatInputIs(InputStream is) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = is.read(bytes, <span class="number">0</span>, bytes.length)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            bis.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bis.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>User.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String pw;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String id, String pw)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.pw = pw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPw</span><span class="params">(String pw)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pw = pw;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>UserData.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserData</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ID;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pw;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">online</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String[] friendID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">leftMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">    UserData(String name, String pw, String ID) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.pw = pw;</span><br><span class="line">        <span class="built_in">this</span>.ID = ID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPw</span><span class="params">(String pw)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pw = pw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOnline</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> online;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnline</span><span class="params">(<span class="type">boolean</span> online)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.online = online;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">listed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((online ? <span class="string">&quot;·在线&quot;</span> : <span class="string">&quot;离线中&quot;</span>) + <span class="string">&quot;\t用户名：（&quot;</span> + ID + <span class="string">&quot;）&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">userData</span> <span class="operator">=</span> (UserData) o;</span><br><span class="line">        <span class="keyword">return</span> online == userData.online &amp;&amp; Objects.equals(ID, userData.ID) &amp;&amp; Objects.equals(name, userData.name) &amp;&amp; Objects.equals(pw, userData.pw);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(ID, name, pw, online);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Message.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>, MessageType &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> String time;</span><br><span class="line">    <span class="keyword">private</span> String sender;</span><br><span class="line">    <span class="keyword">private</span> String receiver;</span><br><span class="line">    <span class="keyword">private</span> String messageType;</span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String message, String sender, String receiver, String messageType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.time = getDateTime();</span><br><span class="line">        <span class="built_in">this</span>.sender = sender;</span><br><span class="line">        <span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">        <span class="built_in">this</span>.messageType = messageType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObject</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTime</span><span class="params">(String time)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.time = time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSender</span><span class="params">(String sender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sender = sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getReceiver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> receiver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setReceiver</span><span class="params">(String receiver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.receiver = receiver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessageType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> messageType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessageType</span><span class="params">(String messageType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messageType = messageType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getDate(LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getDate</span><span class="params">(LocalDateTime ldt)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mon</span> <span class="operator">=</span> ldt.getMonthValue();</span><br><span class="line">        <span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> ldt.getDayOfMonth();</span><br><span class="line">        <span class="keyword">return</span> ldt.getYear() + <span class="string">&quot;.&quot;</span> + (mon &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + mon : mon) + <span class="string">&quot;.&quot;</span> + (day &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + day : day);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">time</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> time(LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">time</span><span class="params">(LocalDateTime ldt)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hour</span> <span class="operator">=</span> ldt.getHour();</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> ldt.getMinute();</span><br><span class="line">        <span class="type">int</span> <span class="variable">sec</span> <span class="operator">=</span> ldt.getSecond();</span><br><span class="line">        <span class="keyword">return</span> (hour &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + hour : hour) + <span class="string">&quot;:&quot;</span> + (min &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + min : min) + <span class="string">&quot;:&quot;</span> + (sec &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> + sec : sec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="keyword">return</span> getDate(ldt) + <span class="string">&quot;  &quot;</span> + time();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>MessageType.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageType</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGIN_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;lS&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGIN_FAILED</span> <span class="operator">=</span> <span class="string">&quot;lF&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGIN_USER_NOT_EXIST</span> <span class="operator">=</span> <span class="string">&quot;lU&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGIN_WRONG_PW</span> <span class="operator">=</span> <span class="string">&quot;lP&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_SHOW_LIST</span> <span class="operator">=</span> <span class="string">&quot;11SL&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_SHOW_ONLINE_LIST</span> <span class="operator">=</span> <span class="string">&quot;11SO&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">CHAT</span> <span class="operator">=</span> <span class="string">&quot;CM&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">GROUP_CHAT</span> <span class="operator">=</span> <span class="string">&quot;GM&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">FILE</span> <span class="operator">=</span> <span class="string">&quot;CF&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_CHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;15CN&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_CHANGE_PW</span> <span class="operator">=</span> <span class="string">&quot;16CP&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_CHANGE_HIDE</span> <span class="operator">=</span> <span class="string">&quot;17CH&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">LOGGED_LOGOUT</span> <span class="operator">=</span> <span class="string">&quot;19OT&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">REQUEST_ALLOWED</span> <span class="operator">=</span> <span class="string">&quot;RE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">REQUEST_REJECTED</span> <span class="operator">=</span> <span class="string">&quot;RR&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">REPEAT_LOGIN</span> <span class="operator">=</span> <span class="string">&quot;EXC_RL&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><blockquote>
<p>ClientConnet.java：入口</p>
<p>ClientLogin.java：管理所有登录活动。该线程将持续监听用户登录。用户登录成功后启动一个专用的会话线程。</p>
<p>Serve.java：这就是那个专用会话线程。会持续监听用户请求，并作出反应。</p>
<p>ServeCollection.java：该类收集所有活动中的 Serve 线程。</p>
<p>UserDataEnum.java：记录所有用户数据的枚举类。数据库的替代方法（还没学数据库）</p>
</blockquote>
<ul>
<li><p><strong>ClientConnet.java（入口）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.login.ClientLogin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientConnect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">thisIP</span> <span class="operator">=</span> <span class="string">&quot;192.168.3.16&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> HashMap&lt;String, UserData&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> HashMap&lt;String, Socket&gt; sockets = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (UserDataEnum userData : UserDataEnum.values()) &#123;</span><br><span class="line">            data.put(userData.user.getId(), userData.user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ClientLogin</span>()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ClientLogin.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.login;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.common.*;</span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.connected.Serve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientLogin</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocket = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9000</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                login(serverSocket);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(ServerSocket serverSocket)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">clientSocket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(clientSocket.getInputStream());</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(clientSocket.getOutputStream());</span><br><span class="line"></span><br><span class="line">        String checkRes;</span><br><span class="line">        <span class="type">User</span> <span class="variable">clientUser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Message</span> <span class="variable">toSend</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, InetAddress.getLocalHost().getHostAddress(), clientSocket.getInetAddress().getHostAddress(), <span class="literal">null</span>);</span><br><span class="line">        toSend.setObject(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            clientUser = (User) ois.readObject();</span><br><span class="line">            checkRes = checkUserData(clientUser);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            checkRes = MessageType.LOGIN_FAILED;</span><br><span class="line">        &#125;</span><br><span class="line">        toSend.setMessageType(checkRes);</span><br><span class="line">        <span class="keyword">if</span> (checkRes.equals(MessageType.LOGIN_SUCCESS)) &#123;</span><br><span class="line">            ClientConnect.data.get(clientUser.getId()).setOnline(<span class="literal">true</span>);</span><br><span class="line">            toSend.setObject(ClientConnect.data.get(clientUser.getId()));</span><br><span class="line">            oos.writeObject(toSend);</span><br><span class="line">            <span class="type">Serve</span> <span class="variable">serve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Serve</span>(clientSocket, oos, ois, clientUser.getId());</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(serve).start();</span><br><span class="line"><span class="comment">//            ClientSocketsCollection.addSocket(clientUser.getId(), clientSocket);</span></span><br><span class="line">            ServeCollection.add(clientUser.getId(), serve);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            oos.writeObject(toSend);</span><br><span class="line">            oos.close();</span><br><span class="line">            ois.close();</span><br><span class="line">            clientSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">checkUserData</span><span class="params">(User inp)</span> &#123;</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">inpIDUser</span> <span class="operator">=</span> ClientConnect.data.get(inp.getId());</span><br><span class="line">        <span class="keyword">if</span> (inpIDUser == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> MessageType.LOGIN_USER_NOT_EXIST;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!inpIDUser.getPw().equals(inp.getPw())) &#123;</span><br><span class="line">            <span class="keyword">return</span> MessageType.LOGIN_WRONG_PW;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Serve</span> <span class="variable">temp</span> <span class="operator">=</span> ServeCollection.get(inpIDUser.getId());</span><br><span class="line">        <span class="keyword">if</span> (temp != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                temp.sendRepeatLoginException();</span><br><span class="line">                System.out.println(Message.getDateTime() + <span class="string">&quot; &quot;</span> + temp.id + <span class="string">&quot; 重复登陆&quot;</span>);</span><br><span class="line">                temp.forceLogout();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> MessageType.LOGIN_FAILED;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> MessageType.LOGIN_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Serve.java（主干）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.connected;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.common.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Serve</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Socket clientSocket;</span><br><span class="line">    <span class="keyword">private</span> ObjectOutputStream oos;</span><br><span class="line">    <span class="keyword">private</span> ObjectInputStream ois;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">connecting</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Serve</span><span class="params">(Socket clientSocket, ObjectOutputStream oos, ObjectInputStream ois, String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clientSocket = clientSocket;</span><br><span class="line">        <span class="built_in">this</span>.oos = oos;</span><br><span class="line">        <span class="built_in">this</span>.ois = ois;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Message.getDateTime() + <span class="string">&quot; &quot;</span> + id + <span class="string">&quot; 登录 &quot;</span> + clientSocket.getLocalAddress().getHostName());</span><br><span class="line">        ClientConnect.data.get(id).setOnline(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">while</span> (connecting) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                serve();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    forceLogout();</span><br><span class="line">                    System.out.println(Message.getDateTime() + <span class="string">&quot; &quot;</span> + id + <span class="string">&quot; 系统强行登出 &quot;</span> + e.toString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">serve</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">inp</span> <span class="operator">=</span> (Message) ois.readObject();</span><br><span class="line">        <span class="type">Message</span> <span class="variable">toSend</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, ClientConnect.thisIP, clientSocket.getInetAddress().getHostAddress(), <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (inp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_SHOW_LIST)) &#123;</span><br><span class="line">            sendList(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_CHANGE_NAME)) &#123;</span><br><span class="line">            setNewName(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_CHANGE_HIDE)) &#123;</span><br><span class="line">            changeHide(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_CHANGE_PW)) &#123;</span><br><span class="line">            changPw(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_SHOW_ONLINE_LIST)) &#123;</span><br><span class="line">            sendOnlineList(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.CHAT)) &#123;</span><br><span class="line">            chat(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.GROUP_CHAT)) &#123;</span><br><span class="line">            groupChat(inp, toSend);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.LOGGED_LOGOUT)) &#123;</span><br><span class="line">            logout(inp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getMessageType().equals(MessageType.FILE)) &#123;</span><br><span class="line">            sendFile(inp, toSend);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendList</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (UserData userData : ClientConnect.data.values()) &#123;</span><br><span class="line">            sb.append(userData.listed());</span><br><span class="line">            sb.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        toSend.setMessage(sb.toString());</span><br><span class="line">        toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendOnlineList</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (UserData userData : ClientConnect.data.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (userData.isOnline()) &#123;</span><br><span class="line">                sb.append(userData.listed());</span><br><span class="line">                sb.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        toSend.setMessage(sb.toString());</span><br><span class="line">        toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setNewName</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> inp.getMessage();</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">temp</span> <span class="operator">=</span> (UserData) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!temp.getId().equals(id) || !temp.equals(ClientConnect.data.get(id))) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            temp.setName(newName);</span><br><span class="line">            ClientConnect.data.put(id, temp);</span><br><span class="line">            toSend.setObject(ClientConnect.data.get(temp.getId()));</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">changPw</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">newPw</span> <span class="operator">=</span> inp.getMessage();</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">temp</span> <span class="operator">=</span> (UserData) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!temp.getId().equals(id) || !temp.equals(ClientConnect.data.get(id))) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            temp.setPw(newPw);</span><br><span class="line">            ClientConnect.data.put(id, temp);</span><br><span class="line">            toSend.setObject(ClientConnect.data.get(id));</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">changeHide</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">temp</span> <span class="operator">=</span> (UserData) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!temp.getId().equals(id) || !temp.equals(ClientConnect.data.get(id))) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            temp.setOnline(!temp.isOnline());</span><br><span class="line">            ClientConnect.data.put(id, temp);</span><br><span class="line">            toSend.setObject(ClientConnect.data.get(temp.getId()));</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">chat</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        User[] users = (User[]) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!users[<span class="number">0</span>].getId().equals(id) || !users[<span class="number">0</span>].getPw().equals(ClientConnect.data.get(id).getPw())) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (users[<span class="number">1</span>].getId().equals(id) || ClientConnect.data.get(users[<span class="number">1</span>].getId()) == <span class="literal">null</span>) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">UserData</span> <span class="variable">tar</span> <span class="operator">=</span> ClientConnect.data.get(users[<span class="number">1</span>].getId());</span><br><span class="line">            <span class="type">UserData</span> <span class="variable">form</span> <span class="operator">=</span> ClientConnect.data.get(id);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">send</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            toSend.setMessageType(MessageType.CHAT);</span><br><span class="line">            send.append(inp.getTime()).append(<span class="string">&quot; &quot;</span>).append(form.getName()).append(<span class="string">&quot; 对 你 说：&quot;</span>).append(inp.getMessage());</span><br><span class="line">            <span class="keyword">if</span> (ServeCollection.get(tar.getId()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                toSend.setMessage(send.toString());</span><br><span class="line">                ServeCollection.get(tar.getId()).oos.writeObject(toSend);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ClientConnect.data.get(tar.getId()).leftMessage.append(send).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            toSend.setObject(<span class="keyword">new</span> <span class="title class_">User</span>(tar.getName(), <span class="literal">null</span>));</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">groupChat</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!user.getId().equals(id) || !user.getPw().equals(ClientConnect.data.get(id).getPw())) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.GROUP_CHAT);</span><br><span class="line">            <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> <span class="string">&quot;[群发]&quot;</span> + inp.getTime() + <span class="string">&quot; &quot;</span> + ClientConnect.data.get(id).getName() +</span><br><span class="line">                    <span class="string">&quot; 说：&quot;</span> + inp.getMessage();</span><br><span class="line">            toSend.setMessage(word);</span><br><span class="line">            <span class="keyword">for</span> (Serve serve : ServeCollection.toValue()) &#123;</span><br><span class="line">                serve.oos.writeObject(toSend);</span><br><span class="line">            &#125;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendFile</span><span class="params">(Message inp, Message toSend)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(id, inp.getSender());</span><br><span class="line">        <span class="keyword">if</span> (!user.getPw().equals(ClientConnect.data.get(id).getPw())) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inp.getReceiver().equals(id) || ClientConnect.data.get(inp.getReceiver()) == <span class="literal">null</span>) &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toSend.setMessageType(MessageType.FILE);</span><br><span class="line">            toSend.setMessage(inp.getMessage());</span><br><span class="line">            toSend.setSender(id);</span><br><span class="line">            toSend.setReceiver(inp.getReceiver());</span><br><span class="line">            toSend.setObject(inp.getObject());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ServeCollection.get(inp.getReceiver()).oos.writeObject(toSend);</span><br><span class="line">                toSend.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                toSend.setMessageType(MessageType.REQUEST_REJECTED);</span><br><span class="line">            &#125;</span><br><span class="line">            toSend.setObject(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        oos.writeObject(toSend);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(Message inp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">temp</span> <span class="operator">=</span> (UserData) inp.getObject();</span><br><span class="line">        <span class="keyword">if</span> (!temp.getId().equals(id) || !temp.equals(ClientConnect.data.get(id))) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ClientConnect.data.get(id).setOnline(<span class="literal">false</span>);</span><br><span class="line">            ois.close();</span><br><span class="line">            oos.close();</span><br><span class="line">            clientSocket.close();</span><br><span class="line">            connecting = <span class="literal">false</span>;</span><br><span class="line">            ServeCollection.remove(id);</span><br><span class="line">            System.out.println(Message.getDateTime() + <span class="string">&quot; &quot;</span> + id + <span class="string">&quot; 用户登出 &quot;</span> + clientSocket.getInetAddress().getHostName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forceLogout</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        ClientConnect.data.get(id).setOnline(<span class="literal">false</span>);</span><br><span class="line">        ois.close();</span><br><span class="line">        oos.close();</span><br><span class="line">        clientSocket.close();</span><br><span class="line">        connecting = <span class="literal">false</span>;</span><br><span class="line">        ServeCollection.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendRepeatLoginException</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        oos.writeObject(<span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, MessageType.REPEAT_LOGIN));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ServeCollection.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.connected.Serve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServeCollection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, Serve&gt; serves = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String id, Serve serve)</span>&#123;</span><br><span class="line">        serves.put(id, serve);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Serve <span class="title function_">get</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serves.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Collection&lt;Serve&gt; <span class="title function_">toValue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serves.values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        serves.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>UserDataEnum.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserDataEnum</span> &#123;</span><br><span class="line">    USER01(<span class="string">&quot;申鹤&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0001&quot;</span>),</span><br><span class="line">    USER02(<span class="string">&quot;胡桃&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0002&quot;</span>),</span><br><span class="line">    USER03(<span class="string">&quot;甘雨&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0003&quot;</span>),</span><br><span class="line">    USER04(<span class="string">&quot;刻晴&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0004&quot;</span>),</span><br><span class="line">    USER05(<span class="string">&quot;香菱&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0005&quot;</span>),</span><br><span class="line">    USER06(<span class="string">&quot;凝光&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0006&quot;</span>),</span><br><span class="line">    USER07(<span class="string">&quot;云堇&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0007&quot;</span>),</span><br><span class="line">    USER08(<span class="string">&quot;留云借风真君&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0008&quot;</span>),</span><br><span class="line">    USER09(<span class="string">&quot;降魔大圣&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0009&quot;</span>),</span><br><span class="line">    USER10(<span class="string">&quot;歌尘浪市真君&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0010&quot;</span>),</span><br><span class="line">    USER11(<span class="string">&quot;理水叠山真君&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0011&quot;</span>),</span><br><span class="line">    USER12(<span class="string">&quot;摩拉克斯&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0012&quot;</span>),</span><br><span class="line">    USER13(<span class="string">&quot;救苦渡厄真君&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;0013&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> UserData user;</span><br><span class="line"></span><br><span class="line">    UserDataEnum(String name, String pw, String ID) &#123;</span><br><span class="line">        user = <span class="keyword">new</span> <span class="title class_">UserData</span>(name, pw, ID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><blockquote>
<p>Test1.java：程序入口</p>
<p>ClientInterface.java：程序的主干</p>
<p>ClientThread.java：由这个线程收集服务端发来的数据，并记录</p>
<p>ClientThreadCollection.java：思路混乱的产物。现在我也不知道这是干嘛的（好在没几行代码）</p>
<p>Utility.java：工具类</p>
</blockquote>
<ul>
<li><p><strong>Test1.java（入口）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.melody.transmission.common.ClientInterface;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClientInterface</span>().menu_0();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ClientInterface.java（主干）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientInterface</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">thisIP</span> <span class="operator">=</span> <span class="string">&quot;192.168.3.16&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">serverIP</span> <span class="operator">=</span> <span class="string">&quot;192.168.3.16&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserData</span> <span class="variable">loggedUser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> ClientThread ct;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line">    ObjectOutputStream oos;</span><br><span class="line">    ObjectInputStream ois;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">cancelMenu</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">File</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//一级菜单、登录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">menu_0</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">running0</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (running0) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;===========欢迎使用通讯系统（试做版）===========&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;\t\t\t1. 用户登录&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;\t\t\t9. 退出系统&quot;</span>);</span><br><span class="line">            System.out.print(<span class="string">&quot;请输入：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">inpString</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (inpString.equals(<span class="string">&quot;1&quot;</span>)) &#123;</span><br><span class="line">                    menuLogin_0_1();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inpString.equals(<span class="string">&quot;9&quot;</span>)) &#123;</span><br><span class="line">                    running0 = <span class="literal">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException | ClassNotFoundException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;错误&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException d) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;链接失败！&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;再见~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//一级菜单、登录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">menuLogin_0_1</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------用户登录-------------------&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入用户ID（4位）：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">4</span>, <span class="literal">false</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入密码（6位）：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pw</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">6</span>, <span class="literal">false</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">        user = <span class="keyword">new</span> <span class="title class_">User</span>(id, pw);</span><br><span class="line">        loggedUser = tryLogin_0_1_1(user);</span><br><span class="line">        <span class="keyword">if</span> (loggedUser == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            oos.close();</span><br><span class="line">            ois.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;欢迎回来，&quot;</span> + loggedUser.getName());</span><br><span class="line">            isLoggedIn_1();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserData <span class="title function_">tryLogin_0_1_1</span><span class="params">(User user)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        socket = <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getByName(serverIP), <span class="number">9000</span>);</span><br><span class="line">        oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">        oos.writeObject(user);</span><br><span class="line">        <span class="type">Message</span> <span class="variable">received</span> <span class="operator">=</span> (Message) ois.readObject();</span><br><span class="line">        <span class="type">String</span> <span class="variable">reply</span> <span class="operator">=</span> received.getMessageType();</span><br><span class="line">        <span class="keyword">if</span> (reply.equals(MessageType.LOGIN_WRONG_PW)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reply.equals(MessageType.LOGIN_USER_NOT_EXIST)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;用户名不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reply.equals(MessageType.LOGIN_SUCCESS)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (UserData) received.getObject();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reply.equals(MessageType.LOGIN_FAILED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//二级菜单</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isLoggedIn_1</span><span class="params">()</span> &#123;</span><br><span class="line">        ct = <span class="keyword">new</span> <span class="title class_">ClientThread</span>(socket, oos, ois, <span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(ct).start();</span><br><span class="line">        running = <span class="literal">true</span>;</span><br><span class="line">        showBasicMenu_1_();</span><br><span class="line">        System.out.println(loggedUser.leftMessage);</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (loggedUser.leftMessage.length() != <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------以上是留言----------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (running) &#123;</span><br><span class="line">            showBasicMenu_1_();</span><br><span class="line">            System.out.print(<span class="string">&quot;请选择：&quot;</span>);</span><br><span class="line">            <span class="type">char</span> <span class="variable">inp</span> <span class="operator">=</span> Utility.readChar();</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">switch</span> (inp) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    loggedGetList_1_1();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                    loggedChat_1_2();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                    loggedGroupChat_1_3();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">                    loggedSendFile_1_4();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">                    loggedChangeName_1_5();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">                    loggedChangePw_1_6();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">                    loggedChangeHide_1_7();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">                    showOthersMenu_1_();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        loggedLogout_1_9();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;复位&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                    loggedShowLeftMessage_1_L();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;H&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">                    loggedShowChatMessage_1_H();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">                    loggedClearMessage_1_C();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                    loggedFileDeal_1_D();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;F&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">                    loggedShowFilePath_1_F();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;N&#x27;</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">                    loggedChangeFilePath_1_N();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;错误：请检查输入内容&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showBasicMenu_1_</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cancelMenu) &#123;</span><br><span class="line">            cancelMenu = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;================&quot;</span> + loggedUser.getName() + <span class="string">&quot;（&quot;</span> + loggedUser.getID() + <span class="string">&quot;）================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t1. 获取用户列表&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t2. 聊天&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t3. 群聊&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t4. 发送文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t5. 修改昵称&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t6. 修改密码&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t7. 切换隐身状态（目前：&quot;</span> + (loggedUser.isOnline() ? <span class="string">&quot;非隐身）&quot;</span> : <span class="string">&quot;隐身★~）&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t8. 其他&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t9. 退出&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showOthersMenu_1_</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;================&quot;</span> + loggedUser.getName() + <span class="string">&quot;（&quot;</span> + loggedUser.getID() + <span class="string">&quot;）================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tC. 清空在线消息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tD. 查看文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tH. 在线消息记录&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tL. 查看离线留言&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tF. 查看文件存放目录&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tN. 更改文件存放目录&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\tM. 返回（显示一级菜单）&quot;</span>);</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedGetList_1_1</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_SHOW_LIST);</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取列表失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------成员列表如下----------------&quot;</span>);</span><br><span class="line">            System.out.println(message.getMessage());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取列表失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedGetActiveList_1_1A</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_SHOW_ONLINE_LIST);</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取在线成员列表失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------在线成员列表如下--------------&quot;</span>);</span><br><span class="line">            System.out.println(message.getMessage());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取在线成员列表失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedChat_1_2</span><span class="params">()</span> &#123;</span><br><span class="line">        loggedGetActiveList_1_1A();</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.CHAT);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入私聊对象：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">tarId</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">10</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (tarId == <span class="literal">null</span> || tarId.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tarId.equals(loggedUser.getID())) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;不能私聊自己&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print(<span class="string">&quot;发送内容：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">100</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (word == <span class="literal">null</span> || word.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        User[] temp = <span class="keyword">new</span> <span class="title class_">User</span>[<span class="number">2</span>];</span><br><span class="line">        temp[<span class="number">0</span>] = user;</span><br><span class="line">        temp[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">User</span>(tarId, <span class="literal">null</span>);</span><br><span class="line">        message.setObject(temp);</span><br><span class="line">        message.setMessage(word);</span><br><span class="line">        showBasicMenu_1_();</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r访问失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.sb.append(<span class="string">&quot;\n&quot;</span>).append(message.getTime()).append(<span class="string">&quot; 你对 &quot;</span>).append(((User) message.getObject()).getId()).append(<span class="string">&quot; 说：&quot;</span>).append(word);</span><br><span class="line">            System.out.println(ct.sb);</span><br><span class="line">            System.out.println(<span class="string">&quot;\r发送成功&quot;</span>);</span><br><span class="line">            cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r发送失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedGroupChat_1_3</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.GROUP_CHAT);</span><br><span class="line">        System.out.print(<span class="string">&quot;发送内容：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">100</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (word == <span class="literal">null</span> || word.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        message.setObject(user);</span><br><span class="line">        message.setMessage(word);</span><br><span class="line">        showBasicMenu_1_();</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r访问失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r发送成功&quot;</span>);</span><br><span class="line">            cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;\r发送失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedSendFile_1_4</span><span class="params">()</span> &#123;</span><br><span class="line">        loggedGetActiveList_1_1A();</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.FILE);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入要发送的用户：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">tar</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">4</span>, <span class="literal">true</span>);</span><br><span class="line">        message.setReceiver(tar);</span><br><span class="line">        <span class="keyword">if</span> (tar == <span class="literal">null</span> || tar.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tar.equals(loggedUser.getID())) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：不能发给自己&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tar.length() &lt; <span class="number">4</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：用户 ID 是 4 位字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入文件完整路径：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">file_Str</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">500</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (file_Str == <span class="literal">null</span> || file_Str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file = <span class="keyword">new</span> <span class="title class_">File</span>(file_Str);</span><br><span class="line">            <span class="keyword">if</span> (!file.isFile()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            data = Utility.loadFile(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            showBasicMenu_1_();</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：文件路径错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        message.setSender(loggedUser.getPw());</span><br><span class="line">        message.setObject(data);</span><br><span class="line">        message.setMessage(file.getName());</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;发送失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件发送成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cancelMenu = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedChangeName_1_5</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_CHANGE_NAME);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一个新名字（不超过10位）：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">10</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (newName == <span class="literal">null</span> || newName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        message.setMessage(newName);</span><br><span class="line">        message.setObject(loggedUser);</span><br><span class="line">        loggedUser = <span class="literal">null</span>;</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;访问失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">            loggedUser = (UserData) message.getObject();</span><br><span class="line">            System.out.println(<span class="string">&quot;修改完毕：（&quot;</span> + loggedUser.getID() + <span class="string">&quot;）&quot;</span> + loggedUser.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedChangePw_1_6</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_CHANGE_PW);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入原密码：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pw</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">20</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (pw == <span class="literal">null</span> || pw.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pw.equals(loggedUser.getPw())) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入新密码（6位）：&quot;</span>);</span><br><span class="line">        pw = Utility.readKeyBoard(<span class="number">6</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (pw == <span class="literal">null</span> || pw.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pw.length() != <span class="number">6</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：密码长度应该是 6 位&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        message.setMessage(pw);</span><br><span class="line">        message.setObject(loggedUser);</span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;访问失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;密码修改成功&quot;</span>);</span><br><span class="line">            loggedUser = (UserData) message.getObject();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedChangeHide_1_7</span><span class="params">()</span> &#123;</span><br><span class="line">        message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_CHANGE_HIDE);</span><br><span class="line">        message.setObject(loggedUser);</span><br><span class="line"><span class="comment">//        loggedUser = null;</span></span><br><span class="line">        sendAndReceive();</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;访问失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_ALLOWED)) &#123;</span><br><span class="line">            loggedUser = (UserData) message.getObject();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.REQUEST_REJECTED)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求被拒绝&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedLogout_1_9</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;确认退出吗？（Y/N）&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Utility.readConfirmSelection() == <span class="string">&#x27;Y&#x27;</span>) &#123;</span><br><span class="line">            message = <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="literal">null</span>, loggedUser.getID(), serverIP, MessageType.LOGGED_LOGOUT);</span><br><span class="line">            message.setObject(loggedUser);</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">            loggedUser = <span class="literal">null</span>;</span><br><span class="line">            socket.close();</span><br><span class="line">            ct.running = <span class="literal">false</span>;</span><br><span class="line">            running = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedShowChatMessage_1_H</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(ct.sb);</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------没有更多了----------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedShowLeftMessage_1_L</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(loggedUser.leftMessage);</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------没有更多了----------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedClearMessage_1_C</span><span class="params">()</span> &#123;</span><br><span class="line">        ct.sb.delete(<span class="number">0</span>, ct.sb.length());</span><br><span class="line">        System.out.println(<span class="string">&quot;完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedFileDeal_1_D</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">fileMenuRunning</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (fileMenuRunning) &#123;</span><br><span class="line">            showFileDealMenu_1_D_();</span><br><span class="line">            System.out.print(<span class="string">&quot;请选择：&quot;</span>);</span><br><span class="line">            <span class="type">char</span> <span class="variable">inp</span> <span class="operator">=</span> Utility.readChar();</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">switch</span> (inp) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    fileShowAllName_1_D_1();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                    fileShowNewestName_1_D_2();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">                    fileDeleteNewestOne_1_D_3();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">                    fileDownloadNewestOne_1_D_4();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">                    fileDownloadAll_1_D_5();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">                    loggedChangeFilePath_1_N();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">                    fileMenuRunning = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;错误：请检查输入内容&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showFileDealMenu_1_D_</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cancelMenu) &#123;</span><br><span class="line">            cancelMenu = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------文件管理----------------&quot;</span>);</span><br><span class="line">        ct.showFilesRemain();</span><br><span class="line">        loggedShowFilePath_1_F();</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t1. 查看所有文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t2. 查看最新文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t3. 删除最新的文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t4. 下载最新的文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t5. 全部下载&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t6. 修改存放路径&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\t\t9. 返回上级目录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fileShowAllName_1_D_1</span><span class="params">()</span> &#123;</span><br><span class="line">        showFileDealMenu_1_D_();</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ct.filesToDeal.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;没有未处理的文件了★~~&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            System.out.println((n + <span class="number">1</span>) + <span class="string">&quot;. &quot;</span> + ct.fileName[n]);</span><br><span class="line">        &#125; <span class="keyword">while</span> (++n &lt; ct.fileName.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fileShowNewestName_1_D_2</span><span class="params">()</span> &#123;</span><br><span class="line">        showFileDealMenu_1_D_();</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ct.filesToDeal.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;没有未处理的文件了★~~&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(ct.fileName.length + <span class="string">&quot;. &quot;</span> + ct.fileName[ct.fileName.length - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fileDeleteNewestOne_1_D_3</span><span class="params">()</span> &#123;</span><br><span class="line">        showFileDealMenu_1_D_();</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ct.filesToDeal.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;没有未处理的文件了★~~&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ct.fileName.length + <span class="string">&quot;. &quot;</span> + ct.fileName[ct.fileName.length - <span class="number">1</span>]);</span><br><span class="line">        System.out.println(<span class="string">&quot;确定删除吗？&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;确认退出吗？（Y/N）&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Utility.readConfirmSelection() == <span class="string">&#x27;N&#x27;</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ct.deleteNewestFile()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fileDownloadNewestOne_1_D_4</span><span class="params">()</span> &#123;</span><br><span class="line">        showFileDealMenu_1_D_();</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ct.filesToDeal.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;没有未处理的文件了★~~&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> ct.fileName[ct.fileName.length - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (ct.downloadNewestFile()) &#123;</span><br><span class="line">            System.out.println(str + <span class="string">&quot; 下载成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fileDownloadAll_1_D_5</span><span class="params">()</span> &#123;</span><br><span class="line">        showFileDealMenu_1_D_();</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ct.filesToDeal.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;没有未处理的文件了★~~&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            fileDownloadNewestOne_1_D_4();</span><br><span class="line">        &#125; <span class="keyword">while</span> (ct.filesToDeal.length &gt; <span class="number">0</span>);</span><br><span class="line">        cancelMenu = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedShowFilePath_1_F</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;文件保存目录如下：&quot;</span> + filePath);</span><br><span class="line">        cancelMenu = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loggedChangeFilePath_1_N</span><span class="params">()</span> &#123;</span><br><span class="line">        loggedShowFilePath_1_F();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入一个新的路径&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">newPath</span> <span class="operator">=</span> Utility.readKeyBoard(<span class="number">500</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (newPath == <span class="literal">null</span> || newPath.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">            cancelMenu = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        File path;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            path = <span class="keyword">new</span> <span class="title class_">File</span>(newPath);</span><br><span class="line">            path.mkdir();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：路径输入错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        filePath = path;</span><br><span class="line">        cancelMenu = <span class="literal">false</span>;</span><br><span class="line">        showBasicMenu_1_();</span><br><span class="line">        System.out.println(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        loggedShowFilePath_1_F();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendAndReceive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">Date</span>()).getTime();</span><br><span class="line">        ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;异常&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">Date</span>().getTime() - now &gt;= <span class="number">5000</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;超时&quot;</span>);</span><br><span class="line">                message = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ct.messageReceived) &#123;</span><br><span class="line">                message = ct.message;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line">        ct.messageReceived = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getDate(LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getDate</span><span class="params">(LocalDateTime ldt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ldt.getYear() + <span class="string">&quot;.&quot;</span> + ldt.getMonthValue() + <span class="string">&quot;.&quot;</span> + ldt.getDayOfMonth();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getTime(LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getTime</span><span class="params">(LocalDateTime ldt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ldt.getHour() + <span class="string">&quot;:&quot;</span> + ldt.getMinute() + <span class="string">&quot;:&quot;</span> + ldt.getSecond();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getDateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="keyword">return</span> getDate(ldt) + <span class="string">&quot;  &quot;</span> + getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private Message packageMessage(String str) &#123;</span></span><br><span class="line"><span class="comment">//        return new Message(str, thisIP, serverIP, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ClientThread.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> ObjectOutputStream oos;</span><br><span class="line">    <span class="keyword">private</span> ObjectInputStream ois;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">messageReceived</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">private</span> ClientInterface ci;</span><br><span class="line">    <span class="comment">//    public byte[] fileToDeal;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">receivedFileDealt</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[][] filesToDeal = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>][];			<span class="comment">//这里改为创建一个本地缓存，在内存里存放路径更好</span></span><br><span class="line">    														<span class="comment">//但我懒得改了</span></span><br><span class="line">    <span class="keyword">public</span> String[] fileName = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (running) &#123;</span><br><span class="line">                message = (Message) ois.readObject();</span><br><span class="line">                <span class="keyword">if</span> (message.getMessageType().equals(MessageType.CHAT) || message.getMessageType().equals(MessageType.GROUP_CHAT)) &#123;</span><br><span class="line">                    chatReceived();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMessageType().equals(MessageType.FILE)) &#123;</span><br><span class="line">                    filesReceived();</span><br><span class="line">                &#125;</span><br><span class="line">                messageReceived = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            ci.running = <span class="literal">false</span>;</span><br><span class="line">            System.out.print(<span class="string">&quot;\r已离线：&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientThread</span><span class="params">(Socket socket, ObjectOutputStream oos, ObjectInputStream ois, ClientInterface ci)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        <span class="built_in">this</span>.oos = oos;</span><br><span class="line">        <span class="built_in">this</span>.ois = ois;</span><br><span class="line">        <span class="built_in">this</span>.ci = ci;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Socket <span class="title function_">getSocket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">chatReceived</span><span class="params">()</span> &#123;</span><br><span class="line">        sb.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        sb.append(message.getMessage());</span><br><span class="line">        System.out.println(<span class="string">&quot;\r&quot;</span>);</span><br><span class="line">        ci.showBasicMenu_1_();</span><br><span class="line">        System.out.print(<span class="string">&quot;\r          &quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;\r&quot;</span> + sb);</span><br><span class="line">        System.out.print(<span class="string">&quot;\n请选择：&quot;</span>);</span><br><span class="line">        message.setMessageType(MessageType.REQUEST_ALLOWED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">filesReceived</span><span class="params">()</span> &#123;</span><br><span class="line">        filesToDeal = Arrays.copyOf(filesToDeal, filesToDeal.length + <span class="number">1</span>);</span><br><span class="line">        filesToDeal[filesToDeal.length - <span class="number">1</span>] = (<span class="type">byte</span>[]) message.getObject();</span><br><span class="line">        fileName = Arrays.copyOf(fileName, fileName.length + <span class="number">1</span>);</span><br><span class="line">        fileName[fileName.length - <span class="number">1</span>] = message.getMessage();</span><br><span class="line">        receivedFileDealt = <span class="literal">false</span>;</span><br><span class="line">        showFilesRemain();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showFilesRemain</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\r★您有 &quot;</span> + filesToDeal.length + <span class="string">&quot; 个文件等待处理★&quot;</span>);</span><br><span class="line"><span class="comment">//        System.out.println(&quot;\r★按 D 键处理★&quot;);</span></span><br><span class="line">        <span class="keyword">if</span> (filesToDeal.length == <span class="number">0</span>)&#123;</span><br><span class="line">            receivedFileDealt = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteNewestFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            filesToDeal = Arrays.copyOf(filesToDeal, filesToDeal.length - <span class="number">1</span>);</span><br><span class="line">            fileName = Arrays.copyOf(fileName, fileName.length - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (fileName.length != filesToDeal.length)&#123;</span><br><span class="line">                fileName = Arrays.copyOf(fileName, filesToDeal.length - <span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;错误：文件或文件名丢失&quot;</span>);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            showFilesRemain();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">downloadNewestFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">savePath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(ci.filePath, fileName[fileName.length - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (Utility.saveFile(filesToDeal[filesToDeal.length -<span class="number">1</span>], savePath))&#123;</span><br><span class="line">            <span class="keyword">return</span> deleteNewestFile();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;错误：文件存储失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ClientThreadCollection.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientThreadCollection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, ClientThread&gt; threads = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addSocket</span><span class="params">(String ip, ClientThread ct)</span> &#123;</span><br><span class="line">        threads.put(ip, ct);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ClientThread <span class="title function_">get</span><span class="params">(String ip)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threads.get(ip);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Utility.java（工具类，不是我写的）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.transmission.common;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 韩顺平</span></span><br><span class="line"><span class="comment"> * 工具类的作用:</span></span><br><span class="line"><span class="comment"> * 处理各种情况的用户输入，并且能够按照程序员的需求，得到用户的控制台输入。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.IIOException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Utility</span> &#123;</span><br><span class="line">    <span class="comment">//静态属性。。。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个菜单选项，值：1——5的范围</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1——5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">readMenuSelection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">1</span>, <span class="literal">false</span>);<span class="comment">//包含一个字符的字符串</span></span><br><span class="line">            c = str.charAt(<span class="number">0</span>);<span class="comment">//将字符串转换成字符char类型</span></span><br><span class="line">            <span class="keyword">if</span> (c != <span class="string">&#x27;1&#x27;</span> &amp;&amp; c != <span class="string">&#x27;2&#x27;</span> &amp;&amp;</span><br><span class="line">                    c != <span class="string">&#x27;3&#x27;</span> &amp;&amp; c != <span class="string">&#x27;4&#x27;</span> &amp;&amp; c != <span class="string">&#x27;5&#x27;</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;选择错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个字符</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 一个字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">readChar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">1</span>, <span class="literal">false</span>);<span class="comment">//就是一个字符</span></span><br><span class="line">        <span class="keyword">return</span> str.charAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个字符，如果直接按回车，则返回指定的默认值；否则返回输入的那个字符</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 默认值或输入的字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">readChar</span><span class="params">(<span class="type">char</span> defaultValue)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">1</span>, <span class="literal">true</span>);<span class="comment">//要么是空字符串，要么是一个字符</span></span><br><span class="line">        <span class="keyword">return</span> (str.length() == <span class="number">0</span>) ? defaultValue : str.charAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的整型，长度小于2位</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 整数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readInt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">10</span>, <span class="literal">false</span>);<span class="comment">//一个整数，长度&lt;=10位</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                n = Integer.parseInt(str);<span class="comment">//将字符串转换成整数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;数字输入错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的 整数或默认值，如果直接回车，则返回默认值，否则返回输入的整数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 整数或默认值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readInt</span><span class="params">(<span class="type">int</span> defaultValue)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">10</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> defaultValue;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//异常处理...</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                n = Integer.parseInt(str);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;数字输入错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的指定长度的字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit 限制的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指定长度的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> readKeyBoard(limit, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的指定长度的字符串或默认值，如果直接回车，返回默认值，否则返回字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit        限制的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指定长度的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(<span class="type">int</span> limit, String defaultValue)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(limit, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> str.equals(<span class="string">&quot;&quot;</span>) ? defaultValue : str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的确认选项，Y或N</span></span><br><span class="line"><span class="comment">     * 将小的功能，封装到一个方法中.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Y或N</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">readConfirmSelection</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        System.out.println(&quot;请输入你的选择(Y/N): 请小心选择&quot;);</span></span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;<span class="comment">//无限循环</span></span><br><span class="line">            <span class="comment">//在这里，将接受到字符，转成了大写字母</span></span><br><span class="line">            <span class="comment">//y =&gt; Y n=&gt;N</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> readKeyBoard(<span class="number">1</span>, <span class="literal">false</span>).toUpperCase();</span><br><span class="line">            c = str.charAt(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;Y&#x27;</span> || c == <span class="string">&#x27;N&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;请重新输入（输入 Y/N）：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能： 读取一个字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit       读取的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blankReturn 如果为true ,表示 可以读空字符串。</span></span><br><span class="line"><span class="comment">     *                    如果为false表示 不能读空字符串。</span></span><br><span class="line"><span class="comment">     *                    &lt;p&gt;</span></span><br><span class="line"><span class="comment">     *                    如果输入为空，或者输入大于limit的长度，就会提示重新输入。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">readKeyBoard</span><span class="params">(<span class="type">int</span> limit, <span class="type">boolean</span> blankReturn)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义了字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//scanner.hasNextLine() 判断有没有下一行</span></span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">            line = scanner.nextLine();<span class="comment">//读取这一行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果line.length=0, 即用户没有输入任何内容，直接回车</span></span><br><span class="line">            <span class="keyword">if</span> (line.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (blankReturn) <span class="keyword">return</span> line;<span class="comment">//如果blankReturn=true,可以返回空串</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">continue</span>; <span class="comment">//如果blankReturn=false,不接受空串，必须输入内容</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果用户输入的内容大于了 limit，就提示重写输入</span></span><br><span class="line">            <span class="comment">//0 &lt; 如果用户如的内容  &lt;= limit ,我就接受</span></span><br><span class="line">            <span class="keyword">if</span> (line.length() &lt; <span class="number">1</span> || line.length() &gt; limit) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;输入长度（不能大于&quot;</span> + limit + <span class="string">&quot;）错误，请重新输入：&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> line;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] receiveFile(InputStream is) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = is.read(bytes, <span class="number">0</span>, bytes.length)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            bis.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bis.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] loadFile(File path) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(path);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = is.read(bytes, <span class="number">0</span>, bytes.length)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            bis.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        bytes = bis.toByteArray();</span><br><span class="line">        bis.close();</span><br><span class="line">        <span class="keyword">return</span> bytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">saveFile</span><span class="params">(<span class="type">byte</span>[] data, File path)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">temp</span> <span class="operator">=</span> path;</span><br><span class="line">        <span class="keyword">while</span> (temp.isFile()) &#123;</span><br><span class="line">            temp = <span class="keyword">new</span> <span class="title class_">File</span>(path.getParent(), <span class="string">&quot;（拷贝&quot;</span> + n++ + <span class="string">&quot;）&quot;</span> + path.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(temp);</span><br><span class="line">            is.write(data);</span><br><span class="line">            is.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/16public/20%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%A4%9A%E7%94%A8%E6%88%B7%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/" data-id="claq1vt5k0010twtf31r6c9n4" data-title="&lt;Java&gt;20 项目（多用户通讯系统）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A8%8B%E5%BA%8F/" rel="tag">程序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-19 网络编程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/12/19%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2022-01-11T16:00:00.000Z" itemprop="datePublished">2022-01-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/12/19%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">&lt;Java&gt;19 网络编程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="19-网络编程"><a href="#19-网络编程" class="headerlink" title="19 网络编程"></a>19 网络编程</h1><p>网络通信：两台设备之间通过网络实现数据传输。</p>
<p><code>java.net</code> 包下提供了一系列类或接口，供程序员使用，完成网络通信</p>
<h2 id="19-1-网络的相关概念"><a href="#19-1-网络的相关概念" class="headerlink" title="19.1 网络的相关概念"></a>19.1 网络的相关概念</h2><p><strong>网络</strong></p>
<p>网络：两台或多台设备通过一定物理设备连接起来构成了网络</p>
<p>根据网络覆盖范围的不同，对网络进行分类：</p>
<ul>
<li>局域网：覆盖范围最小，仅覆盖一个教室·机房</li>
<li>城域网：覆盖范围较大，可覆盖一个城市</li>
<li>广域网：覆盖范围最大，可以覆盖全国，甚至全球。万维网 是广域网的代表</li>
</ul>
<p><strong>IP 地址</strong></p>
<p>IP 地址：用于唯一标识网络中的每台计算机 &#x2F; 主机</p>
<p>查看 IP 地址：<code>ipconfig</code></p>
<p>IPv4 是 4 个字节（32位）表示。每个字节范围是 [0,255]</p>
<p>IP 地址的表示形式：点分十进制（xx.xx.xx.xx），每个十进制数范围是 [0,255]</p>
<p>IP 地址的组成 &#x3D; 网络地址 + 主机地址</p>
<ul>
<li>A类：0 + 7 位网络号 + 24 位主机号（0.0.0.0 ~ 127.255.255.255）</li>
<li>B类：1 + 0 + 14 位网络号 + 16 位主机号（128.0.0.0 ~ 191.255.255.255）</li>
<li>C类：1 + 1 + 0 + 21 位网络号 + 8 位主机号（192.0.0.0 ~ 223.255.255.255）</li>
<li>D类：1 + 1 + 1 + 0 + 28 位多播组号（224.0.0.0 ~ 239.255.255.255）</li>
<li>E类：1 + 1 + 1 + 1 + 0 + 27 位（留待后用）（240.0.0.0 ~ 247.255.255.255）</li>
</ul>
<p>IPv6 是互联网工程任务组设计的用于替代 IPv4 的下一代 IP 协议。其地址数量可以为全世界每一粒沙子编上一个地址</p>
<p>IPv4 最大的问题在于网络地址资源有限，严重制约了互联网的应用和发展。IPv6 的使用，不仅能解决网络地址资源数量的问题，也解决了多种接入设备接入互联网的障碍</p>
<p>IPv6 使用 16 个字节（128 位）表示地址。</p>
<p>表示形式有：</p>
<ul>
<li><p>冒分十六进制表示法： （X:X:X:X:X:X:X:X）</p>
<p><code>:</code> 之间的部分，出现 0 开头的场合，那些 0 可以省略</p>
</li>
<li><p>0 位压缩表示法：把连续的 <code>0</code> 压缩为 <code>::</code>，这个压缩只能出现一次（X::X:X）</p>
</li>
<li><p>内嵌 IPv4 地址表示法：前 96位 用冒分十六进制表示，后面 32位 用 IPv4 的点分十进制（X:X:X:X:X:XX:d.d.d.d）</p>
</li>
</ul>
<p><strong>子网掩码</strong></p>
<p>只用一个 IP 地址，无法分辨网络部分与主机部分的分界线。因此，使用子网掩码来表示分界线。</p>
<p>这个场合，对应的网络部分的子网掩码的二进制数字设为 1</p>
<p><img src="/img/Java_InputImage/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E5%9B%BE_19.1.png"><br><em>(子网掩码图_19.1)</em></p>
<p>此外，还能把子网掩码与 IP 地址组合</p>
<ul>
<li>在 IP 地址后加斜线及网络部分二进制数字数（IPV4）：192.168.15.1&#x2F;16</li>
<li>IPv6：X:X:X:X:X:X:X:X&#x2F;64</li>
</ul>
<p>通过更改子网掩码，可以细分网络为多个子网。</p>
<p><img src="/img/Java_InputImage/%E5%AD%90%E7%BD%91%E5%9B%BE_19.1.png"><br><em>(子网图_19.1)</em></p>
<p><strong>私有地址</strong></p>
<p>私有地址：与 IP 地址（全局地址）相比，在不同的网络中可以重复的地址。</p>
<p>私有地址是以下范围中的地址。这些地址不能作为全局地址使用：</p>
<ul>
<li>10.0.0.0 ~ 10.255.255.255</li>
<li>172.16.0.0 ~ 172.31.255.255</li>
<li>192.168.0.0 ~ 192.168.255.255</li>
</ul>
<p>将私有地址连接到全局地址的方法：</p>
<ul>
<li>NAT：一种私有地址与全局地址一一对应的机制</li>
<li>NAPT：一种用一个全局地址连接多个计算机的机制</li>
</ul>
<p><strong>域名</strong></p>
<p>示例：<a target="_blank" rel="noopener" href="http://bbs.tianya.cn/post-house-252774-1.shtml">http://bbs.tianya.cn/post-house-252774-1.shtml</a></p>
<p>为了方便记忆，解决记忆 IP 的困难</p>
<p>IP 地址根据 HTTP 协议 映射成域名</p>
<p>通过 DNS（Domain Name System）服务将域名转化为 IP 地址</p>
<p><strong>端口号</strong></p>
<p>用于标识计算机上某个特定的网络程序</p>
<p>表示形式：以整数形式，范围 [0,65535]</p>
<p>0 ~ 1024 已经被占用，不要使用。比如 ssh 22、ftp 21、smtp 25、http 80</p>
<p>常见的网络程序端口号：</p>
<ul>
<li>tomcat：8080</li>
<li>mysql：3306</li>
<li>oracle：1521</li>
<li>sqlserver：1433</li>
</ul>
<p><strong>网络通信协议</strong></p>
<p>协议（TCP&#x2F;IP）</p>
<p>TCP&#x2F;IP：传输控制协议 &#x2F; 因特网互联协议（Transmission Control Protocol &#x2F; Internet Protocol），又叫 网络通讯协议。这个协议是 Internet 最基本的协议、Internet 国际互联网络的基础。简单来讲，就是由 网络层的 IP 协议 和传输层的 TCP 协议 组成</p>
<p><img src="/img/Java_InputImage/%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%9B%BE_19.1.png"></p>
<p><em>(数据封装图_19.1)</em></p>
<table>
<thead>
<tr>
<th>OSI 模型（理论）</th>
<th>TCP&#x2F;IP 模型（实际使用）</th>
<th>TCP&#x2F;IP 模型各层对应协议</th>
</tr>
</thead>
<tbody><tr>
<td>应用层</td>
<td>应用层</td>
<td>HTTP、ftp、telent、DNS……</td>
</tr>
<tr>
<td>表示层</td>
<td>应用层</td>
<td>同上</td>
</tr>
<tr>
<td>会话层</td>
<td>应用层</td>
<td>同上</td>
</tr>
<tr>
<td>传输层</td>
<td>传输层（TCP）</td>
<td>TCP、UDP……</td>
</tr>
<tr>
<td>网络层</td>
<td>网络层（IP）</td>
<td>IP、ICMP、ARP……</td>
</tr>
<tr>
<td>数据链路层</td>
<td>物理 + 数据链路层</td>
<td>Link</td>
</tr>
<tr>
<td>物理层</td>
<td>物理 + 数据链路层</td>
<td>同上</td>
</tr>
</tbody></table>
<h3 id="19-1-1-TCP-和-UDP"><a href="#19-1-1-TCP-和-UDP" class="headerlink" title="19.1.1 TCP 和 UDP"></a>19.1.1 TCP 和 UDP</h3><p><strong>TCP</strong></p>
<p>传输控制协议</p>
<ol>
<li>使用 TCP 协议前，须先建立 TCP 连接，形成传输数据通道。TCP 通信是一对一通信</li>
<li>传输前，采用 “三次握手” 方式，是可靠的</li>
<li>TCP 协议进行通信的两个应用进程：客户端、服务端</li>
<li>在连接中可进行大数据量的传输。传输前，先确认要交流的数据量。那个数据量、数据窗口取较小方的数值。</li>
<li>发送方没有收到接收方的确认应答时，（在一定次数内）会再次发送数据包</li>
<li>传输完毕，需释放已建立的连接，效率低</li>
</ol>
<p><strong>UDP</strong></p>
<p>用户数据协议</p>
<ol>
<li>将 数据、源、目的 封装成数据包，不需要建立连接。可以同时向多个接收方发送</li>
<li>每个数据包大小限制在 64K 以内，不适合传输大量数据</li>
<li>因无需连接，所以是不可靠的</li>
<li>接收方无需发送确认应答</li>
<li>发送数据结束时无需释放资源（因为不是面向连接的），速度快</li>
</ol>
<h2 id="19-2-InetAddress-类"><a href="#19-2-InetAddress-类" class="headerlink" title="19.2 InetAddress 类"></a>19.2 <code>InetAddress</code> 类</h2><p><strong>相关方法</strong></p>
<ul>
<li><code>getLocalHost</code>：获取本机 <code>InetAddress</code> 对象</li>
<li><code>getByName</code>：根据指定主机名 &#x2F; 域名获取 IP 地址对象</li>
<li><code>getHostName</code>：获取 <code>InetAddress</code> 对象的主机名</li>
<li><code>getHostAddress</code>：获取 <code>InetAddress</code> 对象的地址</li>
</ul>
<h2 id="19-3-Socket"><a href="#19-3-Socket" class="headerlink" title="19.3 Socket"></a>19.3 Socket</h2><ol>
<li>套接字（Socket）开发网络应用程序被广泛采用，以至于成为了事实上的标准</li>
<li>通信的两端都要有 Socket，是两台机器间通信的端点</li>
<li>网络通信其实就是 Socket 间的通信</li>
<li>Socket 允许程序把网络连接当成一个流，数据在两个 Socket 间通过 IO 传输</li>
<li>一般主动发起通信的应用程序属于客户端，等待通信请求的为服务端</li>
</ol>
<h3 id="19-3-1-TCP-网络通信编程"><a href="#19-3-1-TCP-网络通信编程" class="headerlink" title="19.3.1 TCP 网络通信编程"></a>19.3.1 TCP 网络通信编程</h3><ol>
<li>基于客户端——服务端的网络通信</li>
<li>底层使用的是 TCP &#x2F; IP 协议</li>
<li>应用场景距离：客户端发送数据，服务端接收并显示</li>
<li>基于 Socket 的 TCP 编程</li>
</ol>
<p><strong>下面，示范一个 服务端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">server</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"> <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9000</span>);		<span class="comment">//[1]</span></span><br><span class="line"> <span class="type">Socket</span> <span class="variable">clientSocket</span> <span class="operator">=</span> serverSocket.accept();	   			<span class="comment">//[2]</span></span><br><span class="line"> <span class="comment">//下面是输入流，不解释了</span></span><br><span class="line"> <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> clientSocket.getInputStream();</span><br><span class="line"> System.out.println(clientSocket.getInetAddress());</span><br><span class="line"> <span class="type">int</span> n;</span><br><span class="line"> <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"> <span class="type">byte</span>[] B = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line"> <span class="keyword">while</span> ((n = inputStream.read(b, <span class="number">0</span>, <span class="number">1024</span>)) != -<span class="number">1</span>) &#123;</span><br><span class="line">     B = Arrays.copyOf(B, B.length + n);</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">         B[B.length - n + i] = b[i];</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> serverSocket.close();										<span class="comment">//[3]</span></span><br><span class="line"> System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(B));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>ServerSocket serverSocket = new ServerSocket(9000);</code></p>
<p>这个语句用以监听 9000 这个端口</p>
<p>细节：这里要求该端口没有被其他服务占用。</p>
</li>
<li><p><code>Socket clientSocket = serverSocket.accept();</code></p>
<p>这个语句用以接收连接的 <code>Socket</code>。没有连接时，程序会阻滞在这里</p>
<p>细节：此处 <code>accept()</code> 可以返回多个 <code>Socket</code>，即多并发</p>
</li>
<li><p><code>serverSocket.close();</code></p>
<p>结束后，务必关闭！</p>
</li>
</ol>
<p><strong>下面，示范一个客户端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">client</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"> <span class="type">String</span> <span class="variable">serverIP</span> <span class="operator">=</span> <span class="string">&quot;192.168.3.16&quot;</span>;								<span class="comment">//[1]</span></span><br><span class="line"> <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(serverIP, <span class="number">9000</span>);					<span class="comment">//[2]</span></span><br><span class="line"> <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line"> outputStream.write(<span class="string">&quot;hello,Server!&quot;</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"> socket.shutdownOutput();										<span class="comment">//[3]</span></span><br><span class="line"> outputStream.close();</span><br><span class="line"> socket.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>这个 IP 是我的本机地址。代表的是 服务端 地址</p>
</li>
<li><p><code>Socket socket = new Socket(serverIP, 9000);	</code></p>
<p>表示访问指定 IP 的 9000 端口</p>
</li>
<li><p><code>socket.shutdownOutput();	</code></p>
<p>这里是输出一个结束标记。若不如此做，socket 就不知道是否数据发送完成</p>
<p>特别的，由 字节流 输出的场合，<code>writer.newLine()</code> 可以替代结束标记。但是这个场合，接收必须是 <code>reader.readLine()</code></p>
</li>
</ol>
<h4 id="19-3-1-1-netstat-指令"><a href="#19-3-1-1-netstat-指令" class="headerlink" title="19.3.1.1 netstat 指令"></a>19.3.1.1 netstat 指令</h4><ol>
<li><p><code>netstat -an</code> 可以查看当前主机网络情况，包括端口监听情况和网络连接情况</p>
</li>
<li><p><code>netstat -an | more</code> 可以分页显示</p>
</li>
<li><p><code>netstat -anb</code> 可以显示占用端口的应用</p>
</li>
<li><p>要求在 dos 控制台下执行</p>
</li>
<li><p>Listening 表示某个端口在监听。</p>
<p>如果有一个外部程序连接到该端口，就会显示一条连接信息 Established</p>
</li>
</ol>
<h4 id="19-3-1-2-TCP-连接秘密"><a href="#19-3-1-2-TCP-连接秘密" class="headerlink" title="19.3.1.2 TCP 连接秘密"></a>19.3.1.2 TCP 连接秘密</h4><p><strong>当客户端连接到服务端后，实际上客户端也是通过一个端口和服务端进行通讯的。这个端口由 TCP&#x2F;IP 来分配，是不确定的，随机的。</strong></p>
<h3 id="19-3-2-UDP-网络通信编程"><a href="#19-3-2-UDP-网络通信编程" class="headerlink" title="19.3.2 UDP 网络通信编程"></a>19.3.2 UDP 网络通信编程</h3><ol>
<li>类 <code>DatagramSocket</code> 和 <code>DatagramPacket</code> 实现了基于 UDP 协议网络程序</li>
<li>没有明确的服务端和客户端，演变成数据的发送端和接收端</li>
<li>UDP 数据报通过数据报套接字 <code>DatagramSocket</code> 发送和接收。系统不保证 UDP 数据报一定能安全送到目的地，也不能确定什么时候能抵达</li>
<li><code>DatagramPacket</code> 对象封装了 UDP 数据报，在数据报中包含了发送端的 IP 地址和端口号以及接收端的 IP 地址和端口号</li>
<li>接收到 <code>DtagramPacket</code> 对象时，需要进行拆包，取出数据</li>
<li><code>DatagramSocket</code> 可以指定在哪个端口接收数据</li>
<li>UDP 协议中每个数据报都给出了完整的地址信息，因此无需发送方和接收方的连接</li>
</ol>
<p><strong>下面，示范一个接收端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">9000</span>);					<span class="comment">//[1]</span></span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes, bytes.length);	<span class="comment">//[2]</span></span><br><span class="line">System.out.println(<span class="string">&quot;萝茵 聆听中……&quot;</span>);</span><br><span class="line">ds.receive(dp);													<span class="comment">//[3]</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> dp.getLength();</span><br><span class="line">bytes = dp.getData();</span><br><span class="line">System.out.println(<span class="string">&quot;萝茵听到了如下内容：\n&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, len));</span><br><span class="line">ds.close();														<span class="comment">//[4]</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>DatagramSocket ds = new DatagramSocket(9000);</code></p>
<p>以 9000 这个端口作为监听端口</p>
</li>
<li><p><code>DatagramPacket dp = new DatagramPacket(bytes, bytes.length);</code></p>
<p>构建 <code>DatagramPacket</code> 对象，准备接收数据</p>
</li>
<li><p><code>ds.receive(dp);	</code></p>
<p>监听信息，放到刚刚创建的 <code>DatagramPacket</code> 对象</p>
</li>
<li><p><code>ds.close()</code></p>
<p>要记得关闭呦 ★ ~</p>
</li>
</ol>
<p><strong>下面，示范一个发送端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;萝茵，大声喊道：你好，世界！&quot;</span>);</span><br><span class="line"><span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8000</span>);					<span class="comment">//[1]</span></span><br><span class="line"><span class="type">InetAddress</span> <span class="variable">ia</span> <span class="operator">=</span> InetAddress.getByName(serverIP);</span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="string">&quot;你好，世界&quot;</span>.getBytes(StandardCharsets.UTF_8);</span><br><span class="line"><span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes, bytes.length, ia, <span class="number">9001</span>);</span><br><span class="line">																<span class="comment">//[2]</span></span><br><span class="line">ds.send(dp);													<span class="comment">//[3]</span></span><br><span class="line">System.out.println(<span class="string">&quot;声音在虚无中回荡着……&quot;</span>);</span><br><span class="line">ds.close();														<span class="comment">//[4]</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>DatagramSocket ds = new DatagramSocket(8000);</code></p>
<p>以 8000 这个端口作为发送端口</p>
</li>
<li><p><code>DatagramPacket dp = new DatagramPacket(bytes, bytes.length, ia, 9001);</code></p>
<p>把要发送的数据、数据长度、对象地址、对象端口 放到包里</p>
</li>
<li><p><code>ds.send(dp);</code></p>
<p>走你 ★ ~</p>
</li>
<li><p><code>ds.close();	</code></p>
<p>鸟尽弓藏</p>
</li>
</ol>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="项目开发流程"><a href="#项目开发流程" class="headerlink" title="项目开发流程"></a>项目开发流程</h3><h4 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1 需求分析"></a>1 需求分析</h4><p><strong>需求分析师（懂技术 + 懂行业）</strong></p>
<ol>
<li>需求分析报告<ul>
<li>项目功能</li>
<li>客户要求</li>
</ul>
</li>
</ol>
<h4 id="2-设计阶段"><a href="#2-设计阶段" class="headerlink" title="2 设计阶段"></a>2 设计阶段</h4><p><strong>架构师 &#x2F; 项目经理</strong></p>
<ol>
<li><p>设计工作</p>
<ul>
<li>UML 类图</li>
<li>流程图</li>
<li>模块设计</li>
<li>数据库设计</li>
<li>架构</li>
</ul>
</li>
<li><p>原型开发</p>
</li>
<li><p>组建团队</p>
</li>
</ol>
<h4 id="3-实现阶段"><a href="#3-实现阶段" class="headerlink" title="3 实现阶段"></a>3 实现阶段</h4><p><strong>程序员 &#x2F; 码农</strong></p>
<ol>
<li>完成架构师的模块功能</li>
<li>测试自己的模块</li>
</ol>
<h4 id="4-测试阶段"><a href="#4-测试阶段" class="headerlink" title="4 测试阶段"></a>4 测试阶段</h4><p><strong>测试工程师</strong></p>
<ol>
<li>单元测试</li>
<li>测试用例</li>
<li>白盒测试</li>
<li>黑盒测试</li>
<li>集成测试</li>
</ol>
<h4 id="5-实施阶段"><a href="#5-实施阶段" class="headerlink" title="5 实施阶段"></a>5 实施阶段</h4><p><strong>实施工程师（开发能力 &#x2F; 环境配置部署能力）</strong></p>
<ol>
<li>把项目正确地部署到客户的平台，并保证运行正常</li>
<li>身体好</li>
</ol>
<h4 id="6-维护阶段"><a href="#6-维护阶段" class="headerlink" title="6 维护阶段"></a>6 维护阶段</h4><ol>
<li>发现 bug 并解决</li>
<li>项目升级</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/12/19%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" data-id="claq1vt5h000ptwtfa0p15ant" data-title="&lt;Java&gt;19 网络编程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-18 项目：坦克大战" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/11/18%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98/" class="article-date">
  <time class="dt-published" datetime="2022-01-10T17:17:02.000Z" itemprop="datePublished">2022-01-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/11/18%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98/">&lt;Java&gt;18 项目（坦克大战）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="18-项目：坦克大战"><a href="#18-项目：坦克大战" class="headerlink" title="18 项目：坦克大战"></a>18 项目：坦克大战</h1><p>还有很多细节、优化方法没实现，但困难的已经没有了。</p>
<p>先不打磨了，还是以学习 Java 为主。</p>
<h3 id="二阶段毕业"><a href="#二阶段毕业" class="headerlink" title="二阶段毕业"></a>二阶段毕业</h3><blockquote>
<p>关于 数量 的注释可能不对。那些注释是早些时候添加的。后来添加了新功能，这些注释没有及时更新</p>
<p>TankGame.java：程序的入口</p>
<p>MyPanel.java：窗口、图像的绘制。这是该项目的主干</p>
<p>Player.java、Enemy.java：己方、敌方的坦克类。Tank.java 是他们的父类</p>
<p>Vehicle.java：记录了所有坦克预设的枚举类。该包下还有另一个记录了所有子弹类型的枚举类 Bullet</p>
<p>Map.java：记录了地图数据的枚举类，包含不同关卡。但我没设计关卡</p>
<p>InputImage.java：所有导入的图片。是我准备的素材</p>
<p>Timing.java：一个计时器。当时能力有限，用这个作为某个计时功能的代替方案</p>
</blockquote>
<ul>
<li><p><strong>TankGame.java（入口）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.ష</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 小派蒙会开坦克吗？</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⠴⠒⠛⠲⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀⠀   ⠀⢻⡄⣠⠶⣆⠀⣸⣀⣀⠀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀ ⠀⠀⢀⡠⠬⠛⢓⣏⠉⣾⣉⣀⠉⢹⡀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀ ⠀⢀⡖⠋⣠⠴⠛⠙⢹⠞⢳⢀⣨⡵⠚⠀⠀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀⣰⠋⡠⠎⠁⣀⠤⠒⠚⠛⠙⠒⠳⠤⣄⡀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀⠘⠐⢼⠖⠋⠀⠀⢀⠀⠀⠀⠀⠀⠀⠘⣌⡒⠲⢹⠀⠀⠀⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀ ⠀⡸⠁⠀⠀⠀⠀⡆⠀⠀⠐⠀⠢⣄⠀⡽⡙⡲⠑⠒⠒⡒⠁</span></span><br><span class="line"><span class="comment"> * ⢀⡠⠴⠚⠀⠀⠀⠀⠀⣕⠝⣄⡀⢀⠀⠀⡇⠵⢍⠚⢾⡀⢠⠖⠁⠀       ___________________</span></span><br><span class="line"><span class="comment"> * ⠈⠦⣄⣀⠀⡔⠀⠀⢁⡞⠀⠉⠲⣄⡀⢲⢼⠀⢀⠳⡄⠁⠀⢣⠀⠀     /  坦克？是新游戏喔。   \</span></span><br><span class="line"><span class="comment"> * ⠀⠀⣠⠃⢐⠄⠀⠀⠴⠅⠠⡊⡢⠀⠉⠉⠁⠀⢆⠕⠹⡀⠀⠈⡆⠀  &lt;   开玩笑，我超勇的好不好   \</span></span><br><span class="line"><span class="comment"> * ⠀⠠⡇⠀⡸⠀⠀⠀⠨⡅⠀⠒⠈⠀⢄⠠⠠⠔⠀⠀⠀⢻⠀⠀⢣⠀     \     我超会玩的啦 ~     /</span></span><br><span class="line"><span class="comment"> * ⠀⢸⠅⠀⡕⠀⠀⠀⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡤⡏⠀⠀⢸⠀       \____________________/</span></span><br><span class="line"><span class="comment"> * ⠀⠈⡇⠀⣣⠀⠀⠈⠀⠸⡦⠴⠲⢚⢚⠙⠝⠙⠍⠝⣱⠏⢠⠀⢸⠅</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠙⣆⠘⣄⠀⠠⣄⠀⠹⣌⠌⠀⠂⠐⢈⠄⡁⢌⠳⣺⠏⢀⡞⠀</span></span><br><span class="line"><span class="comment"> * ⠀⠀⠀⠀⠙⠺⠛⣲⠜⠟⡓⡚⣏⣔⡀⡌⣀⢂⣔⠴⠋⢏⠒⠁⠀⠀</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 什么新游戏，比游戏还刺激！还可以教你 学 Ja va 哦 ~</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TankGame</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MyPanel mp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Thread thread;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">File</span> <span class="variable">savePath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\Program\\Melody\\TankGame\\saveData.sav&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> abandoned;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> <span class="number">1200</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">enemyNum</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">char</span> <span class="variable">inpChar</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        mp = <span class="keyword">new</span> <span class="title class_">MyPanel</span>(width, height, enemyNum);</span><br><span class="line">        <span class="keyword">if</span> (savePath.isFile()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;开始新游戏？（Y新游戏/N读档）&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                inpChar = scanner.next().charAt(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (inpChar == <span class="string">&#x27;Y&#x27;</span> || inpChar == <span class="string">&#x27;y&#x27;</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inpChar == <span class="string">&#x27;N&#x27;</span> || inpChar == <span class="string">&#x27;n&#x27;</span>) &#123;</span><br><span class="line">                        mp.pause = <span class="literal">true</span>;</span><br><span class="line">                        mp.toLoad = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;错误！请重新输入（Y新游戏/N读档）&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TankGame</span> <span class="variable">game</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TankGame</span>(Math.abs(width), Math.abs(height), Math.abs(enemyNum));</span><br><span class="line">        thread = <span class="keyword">new</span> <span class="title class_">Thread</span>(game.mp);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TankGame</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> enemyNum)</span> &#123;</span><br><span class="line">        width = Math.max(width, <span class="number">800</span>);</span><br><span class="line">        height = Math.max(height, <span class="number">600</span>);</span><br><span class="line">        <span class="built_in">this</span>.add(mp);</span><br><span class="line">        <span class="built_in">this</span>.setSize(width + <span class="number">20</span>, height + <span class="number">240</span>);</span><br><span class="line">        <span class="built_in">this</span>.addKeyListener(mp);</span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>MyPanel.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyListener;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * ！！！！！！！！！！！！！！！该类需要重新整理！！！！！！！！！！！！！！！！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> <span class="keyword">implements</span> <span class="title class_">KeyListener</span>, Runnable, Serializable &#123;</span><br><span class="line">    <span class="comment">//5 个静态变量依次是：允许的同屏最大敌人数量的上限、战斗区域宽度、战斗区域高度、玩家、是否通关</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENEMY_MAX</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> <span class="number">1200</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Player</span> <span class="variable">player</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Player</span>(<span class="number">640</span>, <span class="number">640</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">gameSuspend</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][][] mapData = <span class="keyword">new</span> <span class="title class_">int</span>[width][height][<span class="number">2</span>];                        <span class="comment">//*****此处需要修改*****</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//12 个成员变量，依次是：所有敌人坦克、所有被摧毁的敌人坦克、同屏最大敌人数量（用户设定）、敌人初始位置集（含坐标、占用情况）、</span></span><br><span class="line">    <span class="comment">//          敌人初始位置集（仅坐标）、关卡敌人总数、W键是否正被按下、A键是否正被按下、S键是否正被按下、D键是否正被按下、开火键是否正被按下、</span></span><br><span class="line">    <span class="comment">//          导入图片媒介、地图集、关卡数</span></span><br><span class="line">    <span class="keyword">private</span> Vector&lt;Tank&gt; enemy = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Vector&lt;Tank&gt; deadEnemy = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> enemyMax;</span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap&lt;<span class="type">int</span>[], Boolean&gt; enemyPositions = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[][] enemyPosition;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">isPressingW</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">isPressingA</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">isPressingS</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">isPressingD</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">isFiring</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">Image</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Map[] maps = Map.values();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Tank boss;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">bossActive</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">pause</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">saved</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loaded</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">toLoad</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">toSave</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">boolean</span> <span class="variable">abandoned</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyPanel</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> enemyNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = (<span class="type">int</span>) (width / <span class="number">40</span>) * <span class="number">40</span>;</span><br><span class="line">        <span class="built_in">this</span>.height = (<span class="type">int</span>) (height / <span class="number">40</span>) * <span class="number">40</span>;               <span class="comment">//设置长宽</span></span><br><span class="line">        enemyNum = Math.max(enemyNum, <span class="number">0</span>);</span><br><span class="line">        enemyMax = Math.min(enemyNum, ENEMY_MAX);           <span class="comment">//设置同屏最大敌人数量</span></span><br><span class="line">        enemyPosition = <span class="keyword">new</span> <span class="title class_">int</span>[enemyMax][<span class="number">2</span>];                <span class="comment">//已经确定了要生成的敌人位置数量，生成位置数组（空）</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; enemyMax; i++) &#123;                <span class="comment">//生成敌人初始位置。</span></span><br><span class="line">            <span class="type">int</span>[] tempPosition = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">            tempPosition[<span class="number">0</span>] = i * <span class="number">150</span> + <span class="number">50</span>;</span><br><span class="line">            tempPosition[<span class="number">1</span>] = <span class="number">50</span>;</span><br><span class="line">            <span class="keyword">while</span> (tempPosition[<span class="number">0</span>] &gt; (width - <span class="number">100</span>)) &#123;</span><br><span class="line">                tempPosition[<span class="number">1</span>] += <span class="number">120</span>;</span><br><span class="line">                tempPosition[<span class="number">0</span>] -= (width - <span class="number">150</span>);</span><br><span class="line">                <span class="keyword">if</span> (tempPosition[<span class="number">1</span>] &gt; height - <span class="number">100</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            enemyPosition[i][<span class="number">0</span>] = tempPosition[<span class="number">0</span>];</span><br><span class="line">            enemyPosition[i][<span class="number">1</span>] = tempPosition[<span class="number">1</span>];</span><br><span class="line">        &#125;                                                    <span class="comment">//此时 敌人初始位置数组 生成完毕。</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] ints : enemyPosition) &#123;</span><br><span class="line">            enemyPositions.put(ints, <span class="literal">false</span>);                 <span class="comment">//装满 敌人初始位置集 默认全部是未占用</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        nextLevel();</span><br><span class="line">        player.start();             <span class="comment">//启动玩家线程</span></span><br><span class="line">        <span class="keyword">while</span> (!abandoned) &#123;</span><br><span class="line">            creatEnemy();</span><br><span class="line">            gameSuspend = <span class="literal">false</span>;<span class="comment">//创建敌人坦克。这个方法同时会启动敌人坦克线程</span></span><br><span class="line">            <span class="keyword">while</span> (!gameSuspend) &#123;</span><br><span class="line">                repaint();              <span class="comment">//刷新</span></span><br><span class="line">                checkLevelClear();</span><br><span class="line">                <span class="keyword">if</span>(toSave)&#123;</span><br><span class="line">                    saveData();</span><br><span class="line">                    toSave  = <span class="literal">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(toLoad)&#123;</span><br><span class="line">                    loadData();</span><br><span class="line">                    toLoad  = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            pauseBetweenLevels(<span class="number">1200</span> + (bossActive ? <span class="number">2000</span> : <span class="number">0</span>));</span><br><span class="line">            <span class="keyword">while</span> (!gameSuspend) &#123;</span><br><span class="line">                repaint();</span><br><span class="line">            &#125;</span><br><span class="line">            nextLevel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        drawUI(g);                      <span class="comment">//画出 UI</span></span><br><span class="line">        drawPlayer(g);                  <span class="comment">//画出 玩家坦克（包含子弹）</span></span><br><span class="line">        drawEnemy(g);                   <span class="comment">//画出 所有敌人坦克（包含子弹）</span></span><br><span class="line">        drawDeadTank(g);                <span class="comment">//画出 被破坏坦克的残留动画和残留子弹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出 UI</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawUI</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        g.setColor(Color.GRAY);</span><br><span class="line">        g.fillRect(<span class="number">2</span>, <span class="number">2</span>, width - <span class="number">4</span>, height - <span class="number">4</span>);        <span class="comment">//以上 4 行，画出了战斗场地</span></span><br><span class="line">        g.setColor(Color.WHITE);</span><br><span class="line">        g.fillRect(<span class="number">0</span>, height, width, <span class="number">200</span>);</span><br><span class="line">        drawHp(g);                                                      <span class="comment">//画 HP 槽</span></span><br><span class="line">        drawFireCD(g);                                                  <span class="comment">//画 开火 槽</span></span><br><span class="line">        drawEnemyNum(g);                                                <span class="comment">//画 雷达 槽</span></span><br><span class="line">        drawStars(g);                                                   <span class="comment">//画 经验值 星星</span></span><br><span class="line">        <span class="keyword">if</span> (pause) &#123;</span><br><span class="line">            drawPause(g);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画 HP 槽</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawHp</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="comment">//下面画出 绿色 HP 槽。随着 HP 减少，槽会变空</span></span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">50</span>));</span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.fillRect(<span class="number">50</span>, height + <span class="number">60</span>, (<span class="type">int</span>) (<span class="number">20</span> * player.vehicle.LIFE) + <span class="number">4</span>, <span class="number">30</span>);</span><br><span class="line">        g.setColor(player.lifeRemains / player.vehicle.LIFE &gt; <span class="number">0.2</span> ? Color.GREEN : Color.RED);</span><br><span class="line">        g.fill3DRect(<span class="number">52</span>, height + <span class="number">62</span>, (<span class="type">int</span>) (<span class="number">20</span> * Math.max(player.lifeRemains, <span class="number">0</span>)), <span class="number">26</span>, <span class="literal">true</span>);</span><br><span class="line">        g.fill3DRect(<span class="number">52</span>, height + <span class="number">80</span>, (<span class="type">int</span>) (<span class="number">20</span> * Math.max(player.lifeRemains, <span class="number">0</span>) - <span class="number">1</span>), <span class="number">6</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//下面画出一段说明文</span></span><br><span class="line">        g.setColor(Color.GRAY);</span><br><span class="line">        <span class="keyword">if</span> (player.vehicle == Vehicle.Basic) &#123;</span><br><span class="line">            g.drawString(<span class="string">&quot;防弹衣&quot;</span>, <span class="number">50</span>, height + <span class="number">140</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            g.drawString(player.vehicle == Vehicle.Tank_Special ? <span class="string">&quot;复合装甲&quot;</span> : <span class="string">&quot;装甲&quot;</span>, <span class="number">50</span>, height + <span class="number">140</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画 开火 槽</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawFireCD</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="comment">//以下画出 橙色 开火槽。随着装弹，槽会填满</span></span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">50</span>));</span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.fillRect((<span class="type">int</span>) ((width / <span class="number">2</span>) + <span class="number">60</span>), height + <span class="number">60</span>, <span class="number">205</span>, <span class="number">30</span>);</span><br><span class="line">        g.setColor(player.vehicle == Vehicle.Tank_Special ? Color.cyan : Color.ORANGE);</span><br><span class="line">        g.fill3DRect((<span class="type">int</span>) ((width / <span class="number">2</span>) + <span class="number">62</span>), height + <span class="number">62</span>,</span><br><span class="line">                (<span class="type">int</span>) (player.getAtkSpeed() * (player.fireCD - Math.max(player.fireCount, <span class="number">0</span>)) + <span class="number">1</span>), <span class="number">26</span>, <span class="literal">true</span>);</span><br><span class="line">        g.fill3DRect((<span class="type">int</span>) ((width / <span class="number">2</span>) + <span class="number">62</span>), height + <span class="number">80</span>,</span><br><span class="line">                (<span class="type">int</span>) (player.getAtkSpeed() * (player.fireCD - Math.max(player.fireCount, <span class="number">0</span>))), <span class="number">6</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//以下画出一段说明文字</span></span><br><span class="line">        g.setColor(Color.GRAY);</span><br><span class="line">        <span class="keyword">if</span> (player.vehicle == Vehicle.Basic) &#123;</span><br><span class="line">            g.drawString(player.fireCount &lt;= <span class="number">10</span> ? <span class="string">&quot;哒哒哒哒哒……&quot;</span> : player.fireCount == player.fireCD ? <span class="string">&quot;加特林停了&quot;</span> : <span class="string">&quot;加特林转啊！&quot;</span>,</span><br><span class="line">                    width / <span class="number">2</span> + <span class="number">60</span>, height + <span class="number">140</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            g.drawString(player.fireCount &lt;= <span class="number">0</span> ? <span class="string">&quot;弹药装填完毕&quot;</span> : <span class="string">&quot;装填中…&quot;</span>, width / <span class="number">2</span> + <span class="number">60</span>, height + <span class="number">140</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出 敌人数量（这个方法是UI的一部分，统计数量，而不是画坦克）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawEnemyNum</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">20</span>));</span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.drawString(<span class="string">&quot;雷达发现敌人数量：&quot;</span> + (maps[level].levelEnemyNum - deadEnemy.size()), (<span class="type">int</span>) (width * <span class="number">0.77</span>), height + <span class="number">22</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出 经验值。有几点就有几颗红星被点亮。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawStars</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (player.vehicle.LEVEL_UP_REQUIRED) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">10</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">280</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">9</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">250</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">8</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">220</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">7</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">190</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">6</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">160</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">5</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">130</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">4</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">100</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">3</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">70</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">2</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">40</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                g.drawImage(player.enhance &gt;= <span class="number">1</span> ? InputImage.star : InputImage.nStar,</span><br><span class="line">                        <span class="number">10</span>, height + <span class="number">10</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="built_in">this</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                g.setColor(Color.GRAY);             <span class="comment">//不能升级的坦克，画一个小小的圆</span></span><br><span class="line">                g.fillOval(<span class="number">40</span>, height + <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawPause</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">70</span>));</span><br><span class="line">        g.setColor(Color.DARK_GRAY);</span><br><span class="line">        g.drawString(<span class="string">&quot;游戏暂停中，按 P 键继续游戏&quot;</span>, (<span class="type">int</span>) ((width / <span class="number">2</span>) * <span class="number">0.2</span>), (height / <span class="number">2</span> - <span class="number">100</span>));</span><br><span class="line">        <span class="keyword">if</span> (saved)&#123;</span><br><span class="line">            g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">50</span>));</span><br><span class="line">            g.setColor(Color.DARK_GRAY);</span><br><span class="line">            g.drawString(<span class="string">&quot;存档成功！&quot;</span>, (<span class="type">int</span>) ((width / <span class="number">2</span>) * <span class="number">0.8</span>), (height / <span class="number">2</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(loaded)&#123;</span><br><span class="line">            g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;等线&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">50</span>));</span><br><span class="line">            g.setColor(Color.DARK_GRAY);</span><br><span class="line">            g.drawString(<span class="string">&quot;读档成功！&quot;</span>, (<span class="type">int</span>) ((width / <span class="number">2</span>) * <span class="number">0.8</span>), (height / <span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (deadEnemy.size() &gt;= maps[level].levelEnemyNum &amp;&amp; (!bossActive || !boss.alive))&#123;</span><br><span class="line">            g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;黑体&quot;</span>, Font.ITALIC + Font.BOLD, <span class="number">70</span>));</span><br><span class="line">            g.setColor(Color.ORANGE);</span><br><span class="line">            g.drawString(<span class="string">&quot;下一波敌人接近中！&quot;</span>, (<span class="type">int</span>) ((width / <span class="number">2</span>) * <span class="number">0.5</span>), (<span class="type">int</span>)(height * <span class="number">0.8</span>));</span><br><span class="line">                                                                                        <span class="comment">//*****此处需要修改*****</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出 玩家坦克</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawPlayer</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        player.pause = <span class="built_in">this</span>.pause;</span><br><span class="line">        drawLivingTank(g, player);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出敌人坦克</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawEnemy</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        Iterator&lt;Tank&gt; iterator = enemy.iterator();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Tank</span> <span class="variable">temp</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (!temp.alive) &#123;                              <span class="comment">//这个分支，坦克已被摧毁</span></span><br><span class="line">                temp.releaseCollisionSize();                <span class="comment">//消除其碰撞体积</span></span><br><span class="line">                iterator.remove();</span><br><span class="line">                deadEnemy.add(temp);                        <span class="comment">//从 敌人集 把该坦克删除，加入 破坏坦克集</span></span><br><span class="line">                player.enhanced(temp.vehicle);              <span class="comment">//给玩家结算经验</span></span><br><span class="line">                enemyPositions.put(enemyPosition[n], <span class="literal">false</span>);<span class="comment">//该坦克占用的位置被解放</span></span><br><span class="line">            &#125;</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">        creatEnemy();                       <span class="comment">//尝试生成新的坦克</span></span><br><span class="line">        iterator = enemy.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Tank</span> <span class="variable">t</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            t.pause = <span class="built_in">this</span>.pause;                <span class="comment">//暂停设置</span></span><br><span class="line"><span class="comment">//            if (t.specialCount &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">//                t.specialCount--;                                     //*****此处需要修改*****</span></span><br><span class="line"><span class="comment">//            &#125; else &#123;</span></span><br><span class="line">            drawLivingTank(g, t);       <span class="comment">//画出所有（敌人的）坦克</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bossActive) &#123;</span><br><span class="line">            boss.pause = <span class="built_in">this</span>.pause;</span><br><span class="line">            drawBoss(g);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawBoss</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (boss.alive) &#123;</span><br><span class="line">            drawTank(g, boss);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            drawExplosion(g, boss);</span><br><span class="line">        &#125;</span><br><span class="line">        drawBullet(g, boss);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出被摧毁的坦克的残留特效及其所有残留子弹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawDeadTank</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        Iterator&lt;Tank&gt; iterator = deadEnemy.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Tank</span> <span class="variable">temp</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            temp.pause = <span class="built_in">this</span>.pause;</span><br><span class="line">            <span class="keyword">if</span> (temp.specialCount &gt; <span class="number">0</span>) &#123;          <span class="comment">//敌人的特殊计数残留时，画出其爆炸效果</span></span><br><span class="line">                temp.specialCount--;                                        <span class="comment">//*****此处需要修改*****</span></span><br><span class="line">                drawExplosion(g, temp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (temp.bullets.size() &gt; <span class="number">0</span>) &#123;          <span class="comment">//敌人的子弹有残留时，画出该子弹</span></span><br><span class="line">                drawBullet(g, temp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出存活的坦克及其所有子弹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawLivingTank</span><span class="params">(Graphics g, Tank tank)</span> &#123;</span><br><span class="line">        <span class="comment">//以下部分画出坦克</span></span><br><span class="line">        <span class="keyword">if</span> (tank.alive) &#123;</span><br><span class="line">            drawTank(g, tank);       <span class="comment">//存活的场合，画出坦克</span></span><br><span class="line">            drawBullet(g, tank);                <span class="comment">//画出子弹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画坦克。这个方法能画出朝向正确的坦克。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawTank</span><span class="params">(Graphics g, Tank tank)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> dirState2(tank.dir);</span><br><span class="line">        <span class="keyword">switch</span> (tank.vehicle) &#123;</span><br><span class="line">            <span class="keyword">case</span> Tank_Lv1:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tank1 : InputImage.tank1r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_Lv2:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tank2 : InputImage.tank2r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_Lv3:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tank3 : InputImage.tank3r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_E1:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tankE1 : InputImage.tankE1r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_E2:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tankE2 : InputImage.tankE2r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_E3:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tankE3 : InputImage.tankE3r;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_Special:</span><br><span class="line">                image = dirState(tank.dir) ? InputImage.tankSp : InputImage.tankSpr;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Basic:</span><br><span class="line">                <span class="keyword">if</span> (tank.fireCount &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">                    image = dirState(tank.dir) ? InputImage.basicL : InputImage.basicLR;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    image = dirState(tank.dir) ? InputImage.basic : InputImage.basicR;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        g.drawImage(image, b ? tank.x + <span class="number">80</span> : tank.x, b ? tank.y + <span class="number">80</span> : tank.y, b ? -<span class="number">80</span> : <span class="number">80</span>, b ? -<span class="number">80</span> : <span class="number">80</span>, <span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (tank.invincible &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (tank.vehicle) &#123;             <span class="comment">//无敌持续中的场合，画出护盾</span></span><br><span class="line">                <span class="keyword">case</span> Tank_Special:</span><br><span class="line">                <span class="keyword">case</span> Basic:</span><br><span class="line">                    image = dirState(tank.dir) ? InputImage.bubble : InputImage.bubbleR;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    image = dirState(tank.dir) ? InputImage.bubbleE : InputImage.bubbleER;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g.drawImage(image, tank.x - <span class="number">5</span>, tank.y - <span class="number">5</span>, <span class="number">90</span>, <span class="number">90</span>, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出子弹。这个方法也会判断子弹的状态（是否存活）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawBullet</span><span class="params">(Graphics g, Tank tank)</span> &#123;</span><br><span class="line">        Iterator&lt;Bullet&gt; iterator = tank.bullets.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Bullet</span> <span class="variable">temp</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            temp.pause = pause;</span><br><span class="line">            <span class="keyword">if</span> (!temp.active) &#123;                 <span class="comment">//子弹消亡的场合，移除子弹</span></span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;                            <span class="comment">//走到这里，说明子弹存活。</span></span><br><span class="line">                <span class="keyword">switch</span> (tank.party) &#123;           <span class="comment">//看看是哪个阵营发出的子弹，去判定别的阵营的坦克</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                        <span class="keyword">if</span> (bossActive &amp;&amp; checkHit(boss, temp, tank)) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">for</span> (Tank t : enemy) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (checkHit(t, temp, tank)) &#123;      <span class="comment">//遍历敌坦克，看看打中了谁。打中则停止判定</span></span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                        checkHit(player, temp, tank);           <span class="comment">//看看有没有击中玩家</span></span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                &#125;</span><br><span class="line">                drawBullet(g, tank.vehicle, temp.getDir(), temp.getX(), temp.getY());       <span class="comment">//画出子弹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出子弹。这个方法通常由上个方法调用，能画出朝向正确的子弹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawBullet</span><span class="params">(Graphics g, Vehicle vehicle, <span class="type">char</span> dir, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> dirState2(dir);</span><br><span class="line">        <span class="keyword">switch</span> (vehicle.BULLET) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">                image = dirState(dir) ? InputImage.nBullet : InputImage.nBulletR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">                image = dirState(dir) ? InputImage.eBullet : InputImage.eBulletR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">                image = dirState(dir) ? InputImage.gBullet : InputImage.gBulletR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        g.drawImage(image, b ? x + <span class="number">10</span> : x, b ? y + <span class="number">10</span> : y, b ? -<span class="number">10</span> : <span class="number">10</span>, b ? -<span class="number">10</span> : <span class="number">10</span>, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画出爆炸。爆炸分为几个阶段，而且不同坦克也有不同爆炸特效</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drawExplosion</span><span class="params">(Graphics g, Tank tank)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tank.specialCount &gt; <span class="number">350</span>) &#123;</span><br><span class="line">            drawTank(g, tank);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (tank.vehicle) &#123;</span><br><span class="line">            <span class="keyword">case</span> Tank_E3:</span><br><span class="line">                <span class="keyword">if</span> (tank.specialCount &lt; <span class="number">600</span> &amp;&amp; tank.specialCount &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tank.specialCount &gt;= <span class="number">500</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion1;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tank.specialCount &gt;= <span class="number">400</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion2;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tank.specialCount &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion3;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tank.specialCount &gt;= <span class="number">200</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion4;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        image = InputImage.explosion5;</span><br><span class="line">                    &#125;</span><br><span class="line">                    g.drawImage(image, tank.x, tank.y, <span class="number">80</span>, <span class="number">80</span>, <span class="built_in">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Tank_E1:</span><br><span class="line">            <span class="keyword">case</span> Tank_E2:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">if</span> (tank.specialCount &lt; <span class="number">450</span> &amp;&amp; tank.specialCount &gt;= <span class="number">50</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tank.specialCount &gt;= <span class="number">250</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion1;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tank.specialCount &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                        image = InputImage.explosion2;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        image = InputImage.explosion3;</span><br><span class="line">                    &#125;</span><br><span class="line">                    g.drawImage(image, tank.x, tank.y, <span class="number">80</span>, <span class="number">80</span>, <span class="built_in">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        tank.specialCount = Math.max(tank.specialCount, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面这两个方法可以帮助其他方法画出正确朝向的对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dirState</span><span class="params">(<span class="type">char</span> dir)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dir == <span class="string">&#x27;u&#x27;</span> || dir == <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dirState2</span><span class="params">(<span class="type">char</span> dir)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dir == <span class="string">&#x27;l&#x27;</span> || dir == <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查子弹是否击中目标</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkHit</span><span class="params">(Tank tank, Bullet bullet, Tank from)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hit(tank, bullet) &amp;&amp; !bullet.hasHit(tank)) &#123;        <span class="comment">//检查是否击中目标 及 目标是否已被击中过</span></span><br><span class="line">            bullet.setHit(tank);</span><br><span class="line">            <span class="keyword">if</span> (tank.invincible &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                bullet.pierce = <span class="number">0</span>;              <span class="comment">//撞到无敌的坦克时，子弹直接报销</span></span><br><span class="line">            &#125;</span><br><span class="line">            bullet.active = bullet.pierce &gt; <span class="number">0</span>;          <span class="comment">//子弹穿透降为 0 的场合，子弹消亡</span></span><br><span class="line">            <span class="keyword">if</span> (!tank.takeDamage(from, bullet.getDir())) &#123;                      <span class="comment">//坦克伤害计数完后，在这里把 HP 归 0 的坦克记为已销毁</span></span><br><span class="line">                tank.alive = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//看看子弹是否击中坦克。由上个方法调用</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hit</span><span class="params">(Tank tank, Bullet bullet)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tank.alive) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tank.vehicle == Vehicle.Basic) &#123;</span><br><span class="line">            <span class="keyword">return</span> pIn(tank.x + <span class="number">30</span>, <span class="number">20</span>, bullet.getX() + <span class="number">5</span>) &amp;&amp; pIn(tank.y + <span class="number">30</span>, <span class="number">20</span>, bullet.getY() + <span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (tank.getDir()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> pIn(tank.x + <span class="number">20</span>, <span class="number">40</span>, bullet.getX() + <span class="number">5</span>) &amp;&amp; pIn(tank.y + <span class="number">3</span>, <span class="number">76</span>, bullet.getY() + <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> pIn(tank.x + <span class="number">3</span>, <span class="number">76</span>, bullet.getX() + <span class="number">5</span>) &amp;&amp; pIn(tank.y + <span class="number">20</span>, <span class="number">40</span>, bullet.getY() + <span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//看看某个坐标（横坐标或纵坐标）是否在[p, p + w]范围内</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">pIn</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> w, <span class="type">int</span> toCheck)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toCheck &gt;= p &amp;&amp; toCheck &lt;= (p + w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyTyped</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//监视器。以下方式保证了动画的流畅度</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyPressed</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (e.getKeyCode()) &#123;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_W:</span><br><span class="line">                isPressingW = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_A:</span><br><span class="line">                isPressingA = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_D:</span><br><span class="line">                isPressingD = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_S:</span><br><span class="line">                isPressingS = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_J:         <span class="comment">//J 是开火键</span></span><br><span class="line">                isFiring = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"><span class="comment">//            //===================以下为测试用=====================</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_Q:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                for (Tank tank : enemy) &#123;</span></span><br><span class="line"><span class="comment">//                    tank.alive = false;</span></span><br><span class="line"><span class="comment">//                    tank.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_E:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                deadEnemy.clear();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_1:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.setVehicle(Vehicle.Tank_Lv1);</span></span><br><span class="line"><span class="comment">//                player.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_2:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.setVehicle(Vehicle.Tank_Lv2);</span></span><br><span class="line"><span class="comment">//                player.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_3:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.setVehicle(Vehicle.Tank_Lv3);</span></span><br><span class="line"><span class="comment">//                player.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_4:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.setVehicle(Vehicle.Tank_Special);</span></span><br><span class="line"><span class="comment">//                player.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_5:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.setVehicle(Vehicle.Basic);</span></span><br><span class="line"><span class="comment">//                player.releaseCollisionSize();</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_Z:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.buffedDef = 100;</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_X:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.buffedDef = 0;</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_C:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.invincible = 1000000;</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case KeyEvent.VK_V:                                     //该 case 仅测试用。  务必删除！务必删除！</span></span><br><span class="line"><span class="comment">//                player.invincible = 0;</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line">            <span class="comment">//===================以上为测试用=====================</span></span><br><span class="line">        &#125;</span><br><span class="line">        isGoing();          <span class="comment">//看看玩家是否正在移动</span></span><br><span class="line">        isFiring();         <span class="comment">//看看玩家是否正在开火</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//同上</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyReleased</span><span class="params">(KeyEvent e)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (e.getKeyCode()) &#123;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_W:             <span class="comment">//向上</span></span><br><span class="line">                isPressingW = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_A:             <span class="comment">//向左</span></span><br><span class="line">                isPressingA = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_D:             <span class="comment">//向右</span></span><br><span class="line">                isPressingD = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_S:             <span class="comment">//向下</span></span><br><span class="line">                isPressingS = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_J:             <span class="comment">//开火</span></span><br><span class="line">                isFiring = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_P:             <span class="comment">//暂停</span></span><br><span class="line">                gamePause();</span><br><span class="line">                saved = <span class="literal">false</span>;</span><br><span class="line">                loaded = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_I:             <span class="comment">//读档（需要暂停）</span></span><br><span class="line">                toLoad = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> KeyEvent.VK_O:             <span class="comment">//存档（需要暂停）</span></span><br><span class="line">                toSave = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        isGoing();</span><br><span class="line">        isFiring();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新玩家的移动状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isGoing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!player.pause) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isPressingW) &#123;</span><br><span class="line">                player.dir = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPressingS) &#123;</span><br><span class="line">                player.dir = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPressingA) &#123;</span><br><span class="line">                player.dir = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPressingD) &#123;</span><br><span class="line">                player.dir = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        player.isMoving = isPressingA || isPressingS || isPressingD || isPressingW;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新玩家的开火状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isFiring</span><span class="params">()</span> &#123;</span><br><span class="line">        player.isFiring = isFiring;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成敌人，直到允许的最大数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">creatEnemy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (enemy.size() &lt; enemyMax &amp;&amp; enemy.size() &lt; maps[level].levelEnemyNum - deadEnemy.size()) &#123;</span><br><span class="line">            <span class="type">int</span>[] temp = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] ints : enemyPosition) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!enemyPositions.get(ints)) &#123;            <span class="comment">//为坦克分配初始位置</span></span><br><span class="line">                    temp = ints;</span><br><span class="line">                    enemyPositions.put(ints, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (temp == <span class="literal">null</span>) &#123;                 <span class="comment">//应该不会抛出异常。但，以防万一，加上这句</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Tank</span> <span class="variable">tempTank</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enemy</span>(temp[<span class="number">0</span>], temp[<span class="number">1</span>], maps[level]);</span><br><span class="line">            <span class="keyword">if</span> (deadEnemy.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                tempTank.specialCount = <span class="number">0</span>;          <span class="comment">//坦克有延迟显示。这里取消了第一组坦克（初始敌人坦克）的延迟显示</span></span><br><span class="line">            &#125;</span><br><span class="line">            enemy.add(tempTank);         <span class="comment">//在 敌人集 中添加新的坦克</span></span><br><span class="line">            tempTank.start();            <span class="comment">//启动该新坦克线程</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个方法有两个作用：</span></span><br><span class="line">    <span class="comment">//  1. 其他敌人全灭时，激活 BOSS</span></span><br><span class="line">    <span class="comment">//  2. 所有敌人全灭时，进入下一关</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkLevelClear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (deadEnemy.size() == maps[level].levelEnemyNum &amp;&amp; !bossActive &amp;&amp; boss != <span class="literal">null</span> &amp;&amp; boss.alive) &#123;</span><br><span class="line">            boss.start();</span><br><span class="line">            bossActive = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (deadEnemy.size() &gt;= maps[level].levelEnemyNum &amp;&amp; (boss == <span class="literal">null</span> || !boss.alive)) &#123;</span><br><span class="line">            gameSuspend = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关卡间设置短暂停顿</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pauseBetweenLevels</span><span class="params">(<span class="type">int</span> time)</span> &#123;</span><br><span class="line">        gameSuspend = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Timing</span>(time)).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每次调用会切换 暂停状态。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">gamePause</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pause = !<span class="built_in">this</span>.pause;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进入下一关时，加载下一关数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">nextLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        player.releaseCollisionSize();</span><br><span class="line">        player.x = <span class="number">200</span>;</span><br><span class="line">        player.y = height - <span class="number">200</span>;</span><br><span class="line">        level++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; maps[level].mapData.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; maps[level].mapData[i].length; j++) &#123;</span><br><span class="line">                inputMapData(i, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] ints : enemyPosition) &#123;</span><br><span class="line">            enemyPositions.put(ints, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Tank tank : deadEnemy) &#123;</span><br><span class="line">            tank.releaseCollisionSize();</span><br><span class="line">        &#125;</span><br><span class="line">        enemy.clear();</span><br><span class="line">        deadEnemy.clear();</span><br><span class="line">        player.lifeRemains = player.vehicle.LIFE;</span><br><span class="line">        player.invincible = <span class="number">0</span>;</span><br><span class="line">        gameSuspend = <span class="literal">false</span>;</span><br><span class="line">        boss = maps[level].boss;</span><br><span class="line">        <span class="keyword">if</span> (boss != <span class="literal">null</span>) &#123;</span><br><span class="line">            boss.x = Math.max(width / <span class="number">2</span> - <span class="number">40</span>, <span class="number">0</span>);</span><br><span class="line">            boss.y = <span class="number">70</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bossActive = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从 Map 类中 加载既定的地图数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inputMapData</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">40</span>; k++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>; l &lt; <span class="number">40</span>; l++) &#123;</span><br><span class="line">                mapData[(x * <span class="number">40</span>) + k][(y * <span class="number">40</span>) + l][<span class="number">1</span>] = maps[level].mapData[x][y][<span class="number">1</span>];</span><br><span class="line">                mapData[(x * <span class="number">40</span>) + k][(y * <span class="number">40</span>) + l][<span class="number">0</span>] = maps[level].mapData[x][y][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;                                                                           <span class="comment">//*****此处需要修改*****</span></span><br><span class="line">        <span class="comment">//这里需要对 地图逻辑、坦克行进逻辑 都进行修改。</span></span><br><span class="line">        <span class="comment">// 现行方法是：由 mapData[][] 记录每个像素的数据。每个像素点的占用情况实时更新。</span></span><br><span class="line">        <span class="comment">// 改成：由 mapData[][] 记录所有 40 * 40 方格的数据。</span></span><br><span class="line">        <span class="comment">//      相信这个办法应该能解决现行方法偶发的空气墙问题，扩展性也会更好。存档大小也能缩小，因而也有机会优化存档逻辑。</span></span><br><span class="line">        <span class="comment">//      目前的代码基本兼容这个新方法。Map 类的数据本来就是 40 * 40 方格模式。地图大小、各类模型尺寸也都是 40 的整数倍</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读档</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">loadData</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pause) &#123;</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!TankGame.savePath.exists()) &#123;</span><br><span class="line">                    TankGame.savePath.createNewFile();</span><br><span class="line">                &#125;</span><br><span class="line">                ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(TankGame.savePath));</span><br><span class="line">                <span class="keyword">if</span>((MyPanel)ois.readObject() != <span class="literal">null</span>)&#123;</span><br><span class="line">                    player = (Player) ois.readObject();</span><br><span class="line"><span class="comment">//                    mapData = (int[][][]) ois.readObject();</span></span><br><span class="line">                    enemy = (Vector&lt;Tank&gt;) ois.readObject();</span><br><span class="line">                    deadEnemy = (Vector&lt;Tank&gt;) ois.readObject();</span><br><span class="line">                    enemyPositions = (LinkedHashMap&lt;<span class="type">int</span>[], Boolean&gt;) ois.readObject();</span><br><span class="line">                    enemyPosition = (<span class="type">int</span>[][]) ois.readObject();</span><br><span class="line">                    maps = (Map[]) ois.readObject();</span><br><span class="line">                    boss = (Tank) ois.readObject();</span><br><span class="line">                    level = ois.readInt();</span><br><span class="line">                    bossActive = ois.readBoolean();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ois.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            pause = <span class="literal">true</span>;</span><br><span class="line">            loaded = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; maps[level].mapData.length; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; maps[level].mapData[i].length; j++) &#123;</span><br><span class="line">                    inputMapData(i, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (Tank tank : enemy) &#123;</span><br><span class="line">                tank.start();</span><br><span class="line">                <span class="keyword">for</span> (Bullet bullet : tank.bullets) &#123;</span><br><span class="line">                    bullet.start();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (Tank tank : deadEnemy) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Bullet bullet : tank.bullets) &#123;</span><br><span class="line">                    bullet.start();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(bossActive &amp;&amp; boss.alive)&#123;</span><br><span class="line">                boss.start();</span><br><span class="line">            &#125;</span><br><span class="line">            player.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存档</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveData</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pause) &#123;</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!TankGame.savePath.exists()) &#123;</span><br><span class="line">                    TankGame.savePath.createNewFile();</span><br><span class="line">                &#125;</span><br><span class="line">                oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TankGame.savePath));</span><br><span class="line">                oos.writeObject(TankGame.mp);</span><br><span class="line">                oos.writeObject(player);</span><br><span class="line"><span class="comment">//                oos.writeObject(mapData);         //占用太大</span></span><br><span class="line">                oos.writeObject(enemy);</span><br><span class="line">                oos.writeObject(deadEnemy);</span><br><span class="line">                oos.writeObject(enemyPositions);</span><br><span class="line">                oos.writeObject(enemyPosition);</span><br><span class="line">                oos.writeObject(maps);</span><br><span class="line">                oos.writeObject(boss);</span><br><span class="line">                oos.writeInt(level);</span><br><span class="line">                oos.writeBoolean(bossActive);</span><br><span class="line">                saved = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    oos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Tank.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//坦克类。这是一个抽象类，Player 和 Enemy 类会继承此类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tank</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;             <span class="comment">//为什么是 继承Thread 而不是 实现Runnable？因为我写这些代码的时候还没学到那里……</span></span><br><span class="line">    <span class="comment">/*从上到下依次是：横坐标、纵坐标、坦克类型、方向、当前生命值、速度增幅、攻速增幅、攻击范围增幅、攻击力增幅、防御力增幅、</span></span><br><span class="line"><span class="comment">                    开火间隔、开火间隔计时、子弹集、是否存活、无敌状态持续时间、阵营、死亡计时</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Vehicle</span> <span class="variable">vehicle</span> <span class="operator">=</span> Vehicle.Basic;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">char</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> lifeRemains;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">buffedSpeed</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">buffedAtkSpeed</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">buffedAtkRange</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">buffedAtk</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">buffedDef</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">fireCD</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">fireCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Vector&lt;Bullet&gt; bullets = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;();   <span class="comment">//所有活动中的子弹会被存放在里面</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="variable">alive</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">invincible</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> party;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">pause</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">specialCount</span> <span class="operator">=</span> <span class="number">800</span>;             <span class="comment">//坦克死亡后，该计时才开始计数。这个计数是为了播放爆炸动画。计数完毕后该对象会被消除。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tank</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">        setVehicle(Vehicle.Basic);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置坦克种类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVehicle</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.vehicle = vehicle;</span><br><span class="line">        <span class="built_in">this</span>.lifeRemains = vehicle.LIFE;</span><br><span class="line">        <span class="built_in">this</span>.fireCD = <span class="number">200</span> / getAtkSpeed();      <span class="comment">//开火间隔由这个公式算出</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">getDir</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//受到伤害。这个方法由子类实现</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">takeDamage</span><span class="params">(Tank tank, <span class="type">char</span> dir)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//移动。</span></span><br><span class="line"><span class="comment">//    abstract void move(char move);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span>[] tryMove()&#123;</span><br><span class="line">        <span class="type">int</span>[] temp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        temp[<span class="number">0</span>] = x;</span><br><span class="line">        temp[<span class="number">1</span>] = y;</span><br><span class="line">        <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                temp[<span class="number">1</span>]--;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                temp[<span class="number">1</span>]++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                temp[<span class="number">0</span>]--;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                temp[<span class="number">0</span>]++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">outOfArea</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt; MyPanel.width - <span class="number">80</span> || y &gt; MyPanel.height - <span class="number">80</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">runIntoSth</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">checking</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                checking = MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">40</span>][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                checking = MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">40</span>][y + <span class="number">40</span> + (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                checking = MyPanel.mapData[x + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span>][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                checking = MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">40</span>][<span class="number">1</span>] == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>)][y + <span class="number">39</span> + (vehicle.SIZE / <span class="number">2</span>)][<span class="number">1</span>] == <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> !checking;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setCollisionSize</span><span class="params">(<span class="type">int</span> tempX, <span class="type">int</span> tempY, <span class="type">int</span> type, <span class="type">int</span> hp)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; vehicle.SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; vehicle.SIZE; j++) &#123;</span><br><span class="line">                MyPanel.mapData[tempX + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + i][tempY + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + j][<span class="number">1</span>] = type;</span><br><span class="line">                MyPanel.mapData[tempX + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + i][tempY + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + j][<span class="number">0</span>] = hp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">releaseCollisionSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; vehicle.SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; vehicle.SIZE; j++) &#123;</span><br><span class="line">                MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + i][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + j][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                MyPanel.mapData[x + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + i][y + <span class="number">40</span> - (vehicle.SIZE / <span class="number">2</span>) + j][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开火</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fireCount &gt; <span class="number">0</span>) &#123;        <span class="comment">//fireCount &gt; 0 说明开火CD 还没好，直接 return</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (vehicle == Vehicle.Basic) &#123;     <span class="comment">//Basic 体积和一般坦克不同，故而发射子弹的位置也不同</span></span><br><span class="line">            fireCount = <span class="number">10</span>;                 <span class="comment">//其武器也不同，所以 开火CD 的逻辑也不同。这里使其每发子弹的间隔很短</span></span><br><span class="line">            <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">39</span>, y + <span class="number">17</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">31</span>, y + <span class="number">53</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">17</span>, y + <span class="number">31</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">53</span>, y + <span class="number">39</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fireCount = fireCD;</span><br><span class="line">            <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">35</span>, y - <span class="number">10</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">35</span>, y + <span class="number">80</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                    fire(x - <span class="number">10</span>, y + <span class="number">35</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                    fire(x + <span class="number">80</span>, y + <span class="number">35</span>, dir, getAtkRange());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fire</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">char</span> dir, <span class="type">int</span> range)</span> &#123;</span><br><span class="line">        <span class="type">Bullet</span> <span class="variable">tempBullet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bullet</span>(vehicle.BULLET, x, y, dir, range, <span class="built_in">this</span>);</span><br><span class="line">        bullets.add(tempBullet);  <span class="comment">//创建一个新的 子弹 实例，并让其运行</span></span><br><span class="line">        tempBullet.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isFront</span><span class="params">(<span class="type">char</span> dir)</span> &#123;               <span class="comment">//判断是否被从正面击中。如若是，坦克的防御力生效</span></span><br><span class="line">        <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.dir == <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.dir == <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.dir == <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.dir == <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">(<span class="type">boolean</span> pause)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.pause = pause;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAtk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vehicle.ATK + buffedAtk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getDef</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vehicle.DEF + buffedDef;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAtkSpeed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vehicle.ATK_SPEED + buffedAtkSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSpeed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vehicle.SPEED + buffedSpeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAtkRange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vehicle.ATK_RANGE + buffedAtkRange;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Player.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">extends</span> <span class="title class_">Tank</span> &#123;</span><br><span class="line">    <span class="comment">//三个属性依次是：经验值、是否正在移动、是否正在开火</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">enhance</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//这两个变量由 MyPanel 的 监视器决定。按下移动/开火键时，变为 true。松开时，变为 false</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">isMoving</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">isFiring</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Player</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(x, y);</span><br><span class="line">        party = <span class="number">0</span>;              <span class="comment">//阵营为 0</span></span><br><span class="line">        setVehicle(Vehicle.Basic);          <span class="comment">//设置初始坦克。               可以随意修改</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (alive) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span> / getSpeed());         <span class="comment">//速度越快、行动越快</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!pause) &#123;</span><br><span class="line">                <span class="keyword">if</span> (invincible &gt; <span class="number">0</span>) &#123;       <span class="comment">//无敌冷却减少</span></span><br><span class="line">                    invincible--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isMoving) &#123;             <span class="comment">//正在移动的场合，使其移动</span></span><br><span class="line">                    move();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isFiring) &#123;             <span class="comment">//正在开火的场合，使其开火</span></span><br><span class="line">                    fire();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vehicle == Vehicle.Basic) &#123;          <span class="comment">//Basic 是特别的。按住开火键的场合，开火CD才减少，不然会增加。</span></span><br><span class="line">                    <span class="comment">// 这样做是为了模拟 加特林 的手感</span></span><br><span class="line">                    fireCount += fireCount &gt;= fireCD ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    fireCount--;            <span class="comment">//开火CD 自然减少</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] temp = tryMove();</span><br><span class="line">        <span class="keyword">if</span> (!outOfArea(temp[<span class="number">0</span>], temp[<span class="number">1</span>]) &amp;&amp; !runIntoSth(temp[<span class="number">0</span>], temp[<span class="number">1</span>])) &#123;</span><br><span class="line">            releaseCollisionSize();</span><br><span class="line">            setCollisionSize(temp[<span class="number">0</span>], temp[<span class="number">1</span>], -<span class="number">2</span>, -<span class="number">1</span>);</span><br><span class="line">            x = temp[<span class="number">0</span>];</span><br><span class="line">            y = temp[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fireCount &gt; <span class="number">0</span>) &#123;            <span class="comment">//如果 开火CD 没到，让其自然减少，然后 return</span></span><br><span class="line">            fireCount--;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">super</span>.fire();               <span class="comment">//真正的开火</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得经验值。每次消灭敌人坦克会调用该方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enhanced</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.vehicle == Vehicle.Basic &amp;&amp; Math.random() &gt; <span class="number">0.9</span>) &#123;         <span class="comment">//特殊设定：Basic 的场合，消灭敌人有概率夺取坦克</span></span><br><span class="line">            <span class="keyword">switch</span> (vehicle) &#123;</span><br><span class="line">                <span class="keyword">case</span> Tank_E1:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv1);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_E2:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv2);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_E3:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv3);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_Special:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Special);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (vehicle) &#123;</span><br><span class="line">                <span class="keyword">case</span> Tank_E1:</span><br><span class="line">                    enhance += <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_E2:</span><br><span class="line">                    enhance += <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_E3:</span><br><span class="line">                    enhance += <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_Special:</span><br><span class="line">                    enhance += <span class="number">10</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            enhanced();         <span class="comment">//看看能不能升级</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查看是否升级</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enhanced</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (vehicle.LEVEL_UP_REQUIRED &gt; <span class="number">0</span> &amp;&amp; enhance &gt;= vehicle.LEVEL_UP_REQUIRED) &#123;</span><br><span class="line">            enhance -= vehicle.LEVEL_UP_REQUIRED;</span><br><span class="line">            releaseCollisionSize();</span><br><span class="line">            <span class="keyword">switch</span> (vehicle) &#123;</span><br><span class="line">                <span class="keyword">case</span> Basic:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv1);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_Lv1:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv2);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Tank_Lv2:</span><br><span class="line">                    setVehicle(Vehicle.Tank_Lv3);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">            &#125;</span><br><span class="line">            setCollisionSize(x, y, -<span class="number">2</span>, -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置坦克。每次设置会重置经验值</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVehicle</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setVehicle(vehicle);</span><br><span class="line">        <span class="built_in">this</span>.enhance = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (vehicle == Vehicle.Basic) &#123;</span><br><span class="line">            fireCount = fireCD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//受到伤害。传入的是造成伤害的坦克，和击中的子弹方向</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">takeDamage</span><span class="params">(Tank tank, <span class="type">char</span> dir)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">damage</span> <span class="operator">=</span> tank.getAtk() * vehicle.DEF_BY_PERCENT - (isFront(dir) ? <span class="built_in">this</span>.getDef() : <span class="number">0</span>);    <span class="comment">//侧后方中弹，防御力不生效</span></span><br><span class="line">        <span class="keyword">if</span> (invincible &gt; <span class="number">0</span>) &#123;               <span class="comment">//无敌的场合，不受伤害</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((lifeRemains -= Math.max(damage, <span class="number">0.1</span>)) &lt;= <span class="number">0</span>) &#123;           <span class="comment">//这里扣除了生命值。最少扣除 0.1。</span></span><br><span class="line">            invincible += <span class="number">200</span>;              <span class="comment">//坦克被打爆，给一段无敌时间</span></span><br><span class="line">            releaseCollisionSize();</span><br><span class="line">            <span class="keyword">switch</span> (vehicle) &#123;              <span class="comment">//坦克降级。Basic 的场合，游戏结束</span></span><br><span class="line">                <span class="keyword">case</span> Tank_Lv3:</span><br><span class="line">                <span class="keyword">case</span> Tank_Lv2:</span><br><span class="line">                <span class="keyword">case</span> Tank_Lv1:</span><br><span class="line">                <span class="keyword">case</span> Tank_Special:</span><br><span class="line">                    setVehicle(Vehicle.Basic);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Basic:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">            setCollisionSize(x, y, -<span class="number">2</span>, -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        invincible += <span class="number">100</span>;      <span class="comment">//只要受到了伤害，产生短暂无敌时间</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Enemy.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//敌人的坦克</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Enemy</span> <span class="keyword">extends</span> <span class="title class_">Tank</span> &#123;</span><br><span class="line">    <span class="comment">//step：坦克的前进次数。归 0 时会转向</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> FIRE_PROBABILITY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Enemy</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        setVehicle(vehicle);</span><br><span class="line">        party = <span class="number">1</span>;</span><br><span class="line">        dir = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">        invincible = <span class="number">300</span>;</span><br><span class="line">        FIRE_PROBABILITY = <span class="number">0.95</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Enemy</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Map map)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(x, y);</span><br><span class="line">        giveVehicle(map.probability_E1, map.probability_E2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Enemy</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(x, y);</span><br><span class="line">        party = <span class="number">1</span>;              <span class="comment">//敌方坦克阵营为 1</span></span><br><span class="line"><span class="comment">//        randomDir();</span></span><br><span class="line"><span class="comment">//        giveVehicle();</span></span><br><span class="line">        dir = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">        invincible = <span class="number">130</span>;       <span class="comment">//敌方坦克出生时，赋予短时间的无敌</span></span><br><span class="line">        FIRE_PROBABILITY = <span class="number">0.985</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">700</span> + specialCount);          <span class="comment">//坦克出生时，使其短暂休眠。</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        specialCount = <span class="number">200</span> + (<span class="type">int</span>) (<span class="number">80</span> * lifeRemains);         <span class="comment">//坦克的 死亡计数，和坦克种类有关</span></span><br><span class="line">        <span class="keyword">while</span> (alive) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep((<span class="number">100</span> / getSpeed()));       <span class="comment">//坦克速度越快，其所有行动速度越快</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!pause) &#123;</span><br><span class="line">                <span class="keyword">if</span> (invincible &gt; <span class="number">0</span>) &#123;           <span class="comment">//无敌时间减少</span></span><br><span class="line">                    invincible--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (fireCount &gt; <span class="number">0</span>) &#123;            <span class="comment">//开火CD计数减少</span></span><br><span class="line">                    fireCount--;</span><br><span class="line">                &#125;</span><br><span class="line">                move();               <span class="comment">//移动</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        releaseCollisionSize();</span><br><span class="line">        <span class="keyword">while</span> (specialCount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!pause) &#123;</span><br><span class="line">                specialCount--;                                    <span class="comment">//*****此处需要修改*****</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">giveVehicle</span><span class="params">(<span class="type">double</span> probabilityE1, <span class="type">double</span> probabilityE2)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">result</span> <span class="operator">=</span> Math.random();</span><br><span class="line">        <span class="keyword">if</span> (result &lt;= probabilityE1) &#123;</span><br><span class="line">            setVehicle(Vehicle.Tank_E1);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result &lt;= probabilityE2) &#123;</span><br><span class="line">            setVehicle(Vehicle.Tank_E2);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setVehicle(Vehicle.Tank_E3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;            <span class="comment">//传入的字符没用。</span></span><br><span class="line">        <span class="keyword">if</span> (step &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            randomDir();                        <span class="comment">//步数归 0 时，赋予其随机方向</span></span><br><span class="line">            realMove();</span><br><span class="line">            step = (<span class="type">int</span>) (Math.random() * <span class="number">200</span> + <span class="number">60</span> - <span class="number">3</span> * getSpeed());       <span class="comment">//赋予其随机的步数</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (step &lt;= <span class="number">60</span> - <span class="number">2</span> * getSpeed()) &#123;       <span class="comment">//最后几步的时候，让坦克在原地稍作停留（不移动）</span></span><br><span class="line">            step--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            realMove();</span><br><span class="line">            step--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Math.random() &gt; FIRE_PROBABILITY) &#123;            <span class="comment">//使敌方坦克有 1.5% 的概率开火。这个概率经过测试，比较合适           这里可以更改</span></span><br><span class="line">            fire();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">realMove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] temp = tryMove();</span><br><span class="line">        <span class="keyword">if</span> (!outOfArea(temp[<span class="number">0</span>], temp[<span class="number">1</span>]) &amp;&amp; !runIntoSth(temp[<span class="number">0</span>], temp[<span class="number">1</span>])) &#123;</span><br><span class="line">            releaseCollisionSize();</span><br><span class="line">            setCollisionSize(temp[<span class="number">0</span>], temp[<span class="number">1</span>], -<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">            x = temp[<span class="number">0</span>];</span><br><span class="line">            y = temp[<span class="number">1</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            step -= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//赋予随机方向（概率均匀）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">randomDir</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> ((<span class="type">int</span>) (Math.random() * <span class="number">4</span>)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                dir = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                dir = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                dir = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                dir = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//受伤。传入的是造成伤害的坦克（以计算伤害），及子弹方向（用于判断是否是正面中弹）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">takeDamage</span><span class="params">(Tank tank, <span class="type">char</span> dir)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">damage</span> <span class="operator">=</span> tank.getAtk() * vehicle.DEF_BY_PERCENT - (isFront(dir) ? getDef() : <span class="number">0</span>);     <span class="comment">//侧后方中弹的场合，防御力不生效</span></span><br><span class="line">        <span class="keyword">if</span> (invincible &gt; <span class="number">0</span>) &#123;               <span class="comment">//如果坦克无敌，不会受到伤害</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">this</span>.lifeRemains -= Math.max(damage, <span class="number">0.1</span>)) &gt; <span class="number">0</span>;        <span class="comment">//在这里进行了生命值的扣除，最少扣 0.1。返回是否生命值有剩</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Vehicle.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//该枚举类存放所有可能的坦克种类及其参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Vehicle</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="comment">//Basic 是特别的。设定上，Basic 是离开载具，扛着加特林的驾驶员。其体积和一般坦克不同</span></span><br><span class="line">    Basic(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">3</span>, <span class="number">400</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="string">&#x27;g&#x27;</span>, <span class="number">10</span>),</span><br><span class="line">    Tank_Lv1(<span class="number">5</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1000</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_Lv2(<span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1000</span>, <span class="number">10</span>, <span class="number">0.9</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_Lv3(<span class="number">10</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1600</span>, -<span class="number">1</span>, <span class="number">0.8</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_E1(<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1000</span>, -<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_E2(<span class="number">7</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">1000</span>, -<span class="number">1</span>, <span class="number">0.8</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_E3(<span class="number">10</span>, <span class="number">18</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">1600</span>, -<span class="number">1</span>, <span class="number">0.6</span>, <span class="string">&#x27;n&#x27;</span>),</span><br><span class="line">    Tank_Special(<span class="number">25</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">18</span>, <span class="number">1</span>, <span class="number">100000</span>, -<span class="number">1</span>, <span class="number">0.4</span>, <span class="string">&#x27;e&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从上到下依次是：攻击力、生命值、防御力、速度、攻击速度、攻击范围、升级经验、减伤、子弹种类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> ATK;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">double</span> LIFE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> DEF;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> SPEED;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> ATK_SPEED;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> ATK_RANGE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> LEVEL_UP_REQUIRED;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">double</span> DEF_BY_PERCENT;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">char</span> BULLET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> SIZE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Vehicle(<span class="type">int</span> atk, <span class="type">double</span> life, <span class="type">int</span> def, <span class="type">int</span> speed, <span class="type">int</span> atkSpeed, <span class="type">int</span> atkRange,</span><br><span class="line">            <span class="type">int</span> levelUpRequired, <span class="type">double</span> defByPercent, <span class="type">char</span> bullet, <span class="type">int</span> size) &#123;</span><br><span class="line">        <span class="built_in">this</span>.ATK = atk;</span><br><span class="line">        <span class="built_in">this</span>.LIFE = life;</span><br><span class="line">        <span class="built_in">this</span>.DEF = def;</span><br><span class="line">        <span class="built_in">this</span>.SPEED = speed;</span><br><span class="line">        <span class="built_in">this</span>.ATK_SPEED = atkSpeed;</span><br><span class="line">        <span class="built_in">this</span>.ATK_RANGE = atkRange;</span><br><span class="line">        <span class="built_in">this</span>.LEVEL_UP_REQUIRED = levelUpRequired;</span><br><span class="line">        <span class="built_in">this</span>.DEF_BY_PERCENT = defByPercent;</span><br><span class="line">        <span class="built_in">this</span>.BULLET = bullet;</span><br><span class="line">        <span class="built_in">this</span>.SIZE = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Vehicle(<span class="type">int</span> atk, <span class="type">double</span> life, <span class="type">int</span> def, <span class="type">int</span> speed, <span class="type">int</span> atkSpeed, <span class="type">int</span> atkRange,</span><br><span class="line">            <span class="type">int</span> levelUpRequired, <span class="type">double</span> defByPercent, <span class="type">char</span> bullet) &#123;</span><br><span class="line">        <span class="built_in">this</span>(atk, life, def, speed, atkSpeed, atkRange, levelUpRequired, defByPercent, bullet, <span class="number">80</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//子弹类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bullet</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//从上到下依次是：横坐标、纵坐标、方向、子弹速度、子弹是否存在、最大飞行范围、穿透数量、已命中的坦克</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> dir;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> BULLET_SPEED;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">active</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> range;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> pierce;</span><br><span class="line">    <span class="keyword">private</span> Tank master;</span><br><span class="line">    <span class="keyword">private</span> Tank[] hit;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="variable">pause</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Bullet</span><span class="params">(<span class="type">char</span> type, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">char</span> dir, <span class="type">int</span> range, Tank master)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">                <span class="built_in">this</span>.BULLET_SPEED = <span class="number">3</span>;</span><br><span class="line">                <span class="built_in">this</span>.pierce = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">                <span class="built_in">this</span>.BULLET_SPEED = <span class="number">2</span>;</span><br><span class="line">                <span class="built_in">this</span>.pierce = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">this</span>.BULLET_SPEED = <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">this</span>.pierce = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        hit = <span class="keyword">new</span> <span class="title class_">Tank</span>[pierce];</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">        <span class="built_in">this</span>.dir = dir;</span><br><span class="line">        <span class="built_in">this</span>.range = range;</span><br><span class="line">        <span class="built_in">this</span>.master = master;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (dir) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">                y -= BULLET_SPEED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                y += BULLET_SPEED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                x += BULLET_SPEED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">                x -= BULLET_SPEED;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((range -= BULLET_SPEED) &lt;= <span class="number">0</span> || outOfArea(x, y)) &#123;     <span class="comment">//如果达到最大飞行范围，则销毁该子弹</span></span><br><span class="line">            active = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">outOfArea</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt; MyPanel.width - <span class="number">10</span> || y &gt; MyPanel.height - <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">getDir</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getBULLET_SPEED</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BULLET_SPEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHit</span><span class="params">(Tank tank)</span> &#123;             <span class="comment">//当有坦克被该子弹击中后，该方法会被调用。一般由 MyPanel 类中的 checkHit 方法调用</span></span><br><span class="line">        hit[hit.length - pierce--] = tank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasHit</span><span class="params">(Tank tank)</span> &#123;          <span class="comment">//判断一辆坦克是否已被击中过。一般由 MyPanel 类中的 checkHit 方法调用</span></span><br><span class="line">        <span class="keyword">for</span> (Tank t : hit) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t == tank) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">(<span class="type">boolean</span> pause)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pause = pause;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (active) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!pause) &#123;</span><br><span class="line">                move();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Map.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Map</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    Level1(<span class="number">10</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="number">0</span>, creatNewMap1()),</span><br><span class="line">    Level2(<span class="number">15</span>, <span class="number">0.5</span>, <span class="number">1</span>, Vehicle.Tank_E2, <span class="number">10</span>, creatNewMap2()),</span><br><span class="line">    Level3(<span class="number">20</span>, <span class="number">0.33</span>, <span class="number">0.66</span>, Vehicle.Tank_E3, <span class="number">15</span>, creatNewMap3()),</span><br><span class="line">    Level4(<span class="number">20</span>, <span class="number">0.2</span>, <span class="number">0.5</span>, Vehicle.Tank_Special, <span class="number">20</span>, creatNewMap4());</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> levelEnemyNum;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">double</span> probability_E1;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">double</span> probability_E2;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Tank boss;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][][] mapData;</span><br><span class="line">    <span class="comment">//[0]：种类。-1 坦克；0 道路；1 墙；2 草丛；3 水池</span></span><br><span class="line">    <span class="comment">//[1]：HP。-1 不可破坏；0 可以通行；1 basic以外任意子弹击中1次可以破坏；2、3 同 1</span></span><br><span class="line"></span><br><span class="line">    Map(<span class="type">int</span> levelEnemyNum, <span class="type">double</span> probability_E1, <span class="type">double</span> probability_E2, Vehicle boss, <span class="type">int</span> bossBuff, <span class="type">int</span>[][][] map) &#123;</span><br><span class="line">        <span class="built_in">this</span>.levelEnemyNum = levelEnemyNum;</span><br><span class="line">        <span class="built_in">this</span>.probability_E1 = probability_E1;</span><br><span class="line">        <span class="built_in">this</span>.probability_E2 = probability_E2;</span><br><span class="line">        <span class="keyword">if</span> (boss == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.boss = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.boss = <span class="keyword">new</span> <span class="title class_">Enemy</span>(boss);</span><br><span class="line">            <span class="built_in">this</span>.boss.lifeRemains += bossBuff;</span><br><span class="line">        &#125;</span><br><span class="line">        mapData = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatNewMap1() &#123;</span><br><span class="line">        <span class="type">int</span>[][][] newMap = creatNewMap();</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatNewMap2() &#123;</span><br><span class="line">        <span class="type">int</span>[][][] newMap = creatNewMap();</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatNewMap3() &#123;</span><br><span class="line">        <span class="type">int</span>[][][] newMap = creatNewMap();</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatNewMap4() &#123;</span><br><span class="line">        <span class="type">int</span>[][][] newMap = creatNewMap();</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatNewMap() &#123;</span><br><span class="line">        <span class="type">int</span>[][][] newMap = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">30</span>][<span class="number">20</span>][<span class="number">2</span>];</span><br><span class="line">        newMap = creatBasicMap(newMap);</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][][] creatBasicMap(<span class="type">int</span>[][][] map)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; map.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; map[i].length; j++) &#123;</span><br><span class="line">                map[i][j][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                map[i][j][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addWall</span><span class="params">(<span class="type">int</span>[][][] map, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        map[x][y][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        map[x][y][<span class="number">1</span>] = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addArea</span><span class="params">(<span class="type">int</span>[][][] map, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> kind, <span class="type">int</span> hp)</span> &#123;</span><br><span class="line">        map[x][y][<span class="number">0</span>] = kind;</span><br><span class="line">        map[x][y][<span class="number">1</span>] = hp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">removeTankCollisionSize</span><span class="params">(Tank tank)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setTankCollisionSize</span><span class="params">(Tank tank)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>InputImage.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">该类中存放所有需要的图片。</span></span><br><span class="line"><span class="comment">包含：坦克图片（tank/basic：4 * 2 + 1 = 9 种）；</span></span><br><span class="line"><span class="comment">     子弹图片（bullet：2 * 2 = 4 种）；</span></span><br><span class="line"><span class="comment">     护盾图片（bubble：2 * 2 = 4种）；</span></span><br><span class="line"><span class="comment">     星星图片（star：2种）、爆炸图片（explosion：5种）;</span></span><br><span class="line"><span class="comment">     地形图片（4种）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputImage</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank1</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv1.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank2</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv2.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank3</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv3.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">basic</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/P.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">basicL</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Pl.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">basicR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Pr.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">basicLR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Plr.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE1</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E1.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE2</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E2.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE3</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E3.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank1r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv1r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank2r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv2r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tank3r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Lv3r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE1r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E1r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE2r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E2r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankE3r</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_E3r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankSp</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Sp.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">tankSpr</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Tank_Spr.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">bubble</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Bubble_red.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">bubbleR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Bubble_red_r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">bubbleE</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Bubble.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">bubbleER</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Bubble_r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">eBullet</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/E_bullet.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">eBulletR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/E_bullet_r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">nBullet</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/N_bullet.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">nBulletR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/N_bullet_r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">gBullet</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/G_bullet.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">gBulletR</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/G_bullet_r.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">star</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Star.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">nStar</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Star_n.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">explosion1</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Explosion/Explosion1.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">explosion2</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Explosion/Explosion2.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">explosion3</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Explosion/Explosion3.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">explosion4</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Explosion/Explosion4.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">explosion5</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Explosion/Explosion5.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">iron</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Landform/Iron.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">wall</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Landform/Wall.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">water</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Landform/Water.png&quot;</span>));</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Image</span> <span class="variable">trees</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/pic/Landform/Trees.png&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Timing.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.melody.tank_game;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Melody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Timing</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Timing</span><span class="params">(<span class="type">int</span> time)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.time = time;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        MyPanel.gameSuspend = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入的图片</p>
<p><img src="/img/Java_InputImage/pic/Bubble.png"></p>
<p><img src="/img/Java_InputImage/pic/Bubble_r.png" alt="Bubble_r"></p>
<p><img src="/img/Java_InputImage/pic/Bubble_red.png" alt="Bubble_red"></p>
<p><img src="/img/Java_InputImage/pic/Bubble_red_r.png" alt="Bubble_red_r"></p>
<p><img src="/img/Java_InputImage/pic/E_bullet.png" alt="E_bullet"></p>
<p><img src="/img/Java_InputImage/pic/E_bullet_r.png" alt="E_bullet_r"></p>
<p><img src="/img/Java_InputImage/pic/G_Bullet.png" alt="G_Bullet"></p>
<p><img src="/img/Java_InputImage/pic/G_Bullet_r.png" alt="G_Bullet_r"></p>
<p><img src="/img/Java_InputImage/pic/N_bullet.png" alt="N_bullet"></p>
<p><img src="/img/Java_InputImage/pic/N_bullet_r.png" alt="N_bullet_r"></p>
<p><img src="/img/Java_InputImage/pic/p.png" alt="p"></p>
<p><img src="/img/Java_InputImage/pic/pl.png" alt="pl"></p>
<p><img src="/img/Java_InputImage/pic/plr.png" alt="plr"></p>
<p><img src="/img/Java_InputImage/pic/Pr.png" alt="Pr"></p>
<p><img src="/img/Java_InputImage/pic/Star.png" alt="Star"></p>
<p><img src="/img/Java_InputImage/pic/Star_n.png" alt="Star_n"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E1.png" alt="Tank_E1"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E1r.png" alt="Tank_E1r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E2.png" alt="Tank_E2"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E2r.png" alt="Tank_E2r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E3.png" alt="Tank_E3"></p>
<p><img src="/img/Java_InputImage/pic/Tank_E3r.png" alt="Tank_E3r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv1.png" alt="Tank_Lv1"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv1r.png" alt="Tank_Lv1r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv2.png" alt="Tank_Lv2"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv2r.png" alt="Tank_Lv2r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv3.png" alt="Tank_Lv3"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Lv3r.png" alt="Tank_Lv3r"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Sp.png" alt="Tank_Sp"></p>
<p><img src="/img/Java_InputImage/pic/Tank_Spr.png" alt="Tank_Spr"></p>
<p><img src="/img/Java_InputImage/pic/Landform/Iron.png"></p>
<p><img src="/img/Java_InputImage/pic/Landform/Trees.png" alt="Trees"></p>
<p><img src="/img/Java_InputImage/pic/Landform/Wall.png" alt="Wall"></p>
<p><img src="/img/Java_InputImage/pic/Landform/Water.png" alt="Water"></p>
<p><img src="/img/Java_InputImage/pic/Explosion/Explosion1.png"></p>
<p><img src="/img/Java_InputImage/pic/Explosion/Explosion2.png" alt="Explosion2"></p>
<p><img src="/img/Java_InputImage/pic/Explosion/Explosion3.png" alt="Explosion3"></p>
<p><img src="/img/Java_InputImage/pic/Explosion/Explosion4.png" alt="Explosion4"></p>
<p><img src="/img/Java_InputImage/pic/Explosion/Explosion5.png" alt="Explosion5"></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/11/18%20%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98/" data-id="claq1vt5i000ttwtf85ld033i" data-title="&lt;Java&gt;18 项目（坦克大战）" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A8%8B%E5%BA%8F/" rel="tag">程序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-17 IO流" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/06/17%20IO%E6%B5%81/" class="article-date">
  <time class="dt-published" datetime="2022-01-05T16:00:00.000Z" itemprop="datePublished">2022-01-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/06/17%20IO%E6%B5%81/">&lt;Java&gt;17 IO流</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="17-IO流"><a href="#17-IO流" class="headerlink" title="17 IO流"></a>17 IO流</h1><h2 id="17-1-文件"><a href="#17-1-文件" class="headerlink" title="17.1 文件"></a>17.1 文件</h2><blockquote>
<p>文件就是保存数据的地方。</p>
<p>文件流：文件 在 程序 中是以 流 的形式来操作的。</p>
<p>流：数据在数据源（文件）和程序（内存）之间经历的路径</p>
<p>输入流：数据从数据源到程序的路径</p>
<p>输出流：数据从程序到数据源的路径</p>
</blockquote>
<h3 id="17-1-1-常用的文件操作"><a href="#17-1-1-常用的文件操作" class="headerlink" title="17.1.1 常用的文件操作"></a>17.1.1 常用的文件操作</h3><blockquote>
<p>Java 提供了 File 类，用于处理文件相关的操作</p>
</blockquote>
<ol>
<li><p>创建文件对象相关构造器和方法</p>
<ul>
<li><p><code>new File(String pathname)</code>：根据路径创建一个 File 对象</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">path1</span> <span class="operator">=</span> <span class="string">&quot;d:/test.jpg&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">path2</span> <span class="operator">=</span> <span class="string">&quot;d:\\test.jpg&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path1);</span><br><span class="line"><span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path2);			<span class="comment">//此时只是在内存中产生了一个对象</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>new File(File parent, String child)</code>：根据父目录文件 + 子路径构建</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">parentFile1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileName1</span> <span class="operator">=</span> <span class="string">&quot;test.txt&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parentFile1, fileName1);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>new File(String parent, String child)</code>：根据父路径 + 子路径构建</p>
</li>
<li><p><code>creatNewFile()</code>：创建新文件</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> file.createNewFile();				<span class="comment">//这个场合，内存对象才写入磁盘</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"> e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
</li>
<li><p>获取文件相关信息</p>
<ul>
<li><p><code>getName()</code>：获取名称</p>
</li>
<li><p><code>getAbsolutePath()</code>：获取文件绝对路径</p>
</li>
<li><p><code>getParent()</code>：获取文件父级目录</p>
</li>
<li><p><code>long length()</code>：获取文件大小（字节）</p>
</li>
<li><p><code>exists()</code>：文件是否存在</p>
</li>
<li><p><code>isFile()</code>：是不是一个文件</p>
</li>
<li><p><code>isDirectory()</code>：是不是一个目录</p>
</li>
<li><p><code>isAbsolute()</code>：是不是绝对路径</p>
</li>
<li><p><code>canRead()</code>：是否可读</p>
<p><code>canWirte()</code>：是否可写</p>
</li>
<li><p><code>long lastModified()</code>：最后修改时间</p>
</li>
<li><p><code>String[] list()</code>：列出符合模式的文件名</p>
</li>
</ul>
</li>
<li><p>目录的操作和文件删除</p>
<ul>
<li><code>mkdir</code>：创建一级目录</li>
<li><code>mkdirs</code>：创建多级目录</li>
<li><code>delete</code>：删除空目录或文件</li>
<li><code>boolean renameTo(File newName)</code>：更改文件名</li>
</ul>
<p>其实目录（在内存看来）就是特殊的文件</p>
</li>
</ol>
<p>注意事项：</p>
<ul>
<li>File 类可以获取文件的各种相关属性，可以对其进行改名，甚至删除。但除了文件名外的属性没有修改方法</li>
<li>File 类可以用来描述一个目录，但不能改变目录名，也不能删除目录</li>
</ul>
<h2 id="17-2-IO流"><a href="#17-2-IO流" class="headerlink" title="17.2 IO流"></a>17.2 IO流</h2><ol>
<li>I &#x2F; O 是 Input &#x2F; Output 的缩写。IO 技术是非常实用的技术，用于处理数据传输。如 读 &#x2F; 写 文件，网络通讯等。</li>
<li>Java 程序中，对于数据的 输入 &#x2F; 输出 操作以 “流（stream）”的方式进行</li>
<li><code>java.io</code> 包下提供了各种 “流” 类和接口，用以获取不同种类的数据，并通过方法输入或输出数据</li>
<li>输入（input）：读取外部数据（磁盘、光盘、网络数据等）到程序（内存）中</li>
<li>输出（output）：将程序（内存）数据输出到外部存储</li>
</ol>
<h3 id="17-2-1-IO流的分类"><a href="#17-2-1-IO流的分类" class="headerlink" title="17.2.1 IO流的分类"></a>17.2.1 IO流的分类</h3><ul>
<li><p>按操作数据单位不同分为：</p>
<ul>
<li>字节流（8 bit）：二进制文件用该方法，能确保文件无损</li>
<li>字符流（按照字符，字符的字节数由编码决定）：文本文件，效率更高</li>
</ul>
</li>
<li><p>按数据流的流向不同分为：</p>
<ul>
<li>输入流：读取外部数据（磁盘、光盘、网络数据等）到程序（内存）中</li>
<li>输出流：将程序（内存）数据输出到外部存储</li>
</ul>
</li>
<li><p>按流的角色不同分为：</p>
<ul>
<li>节点流</li>
<li>处理流 &#x2F; 包装流</li>
</ul>
<table>
<thead>
<tr>
<th>Σ(っ °Д °;)っ</th>
<th>字节流</th>
<th>字符流</th>
</tr>
</thead>
<tbody><tr>
<td>输入流</td>
<td>InputStream</td>
<td>Reader</td>
</tr>
<tr>
<td>输出流</td>
<td>OutputStream</td>
<td>Writer</td>
</tr>
</tbody></table>
</li>
</ul>
<p>Java 的 IO流 总共涉及 40多个类，实际上都是上述 4 类的抽象基类派生的</p>
<p>由这 4 个类派生的子类名称都是以其父类名作为子类名后缀</p>
<h3 id="17-2-2-IO流-常用类"><a href="#17-2-2-IO流-常用类" class="headerlink" title="17.2.2 IO流 常用类"></a>17.2.2 IO流 常用类</h3><h4 id="17-2-2-1-FileInputStream：文件字节输入流"><a href="#17-2-2-1-FileInputStream：文件字节输入流" class="headerlink" title="17.2.2.1 FileInputStream：文件字节输入流"></a>17.2.2.1 <code>FileInputStream</code>：文件字节输入流</h4><ul>
<li><p>构造器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">FileInputStream</span>(File file);				<span class="comment">//通过一个 File 的路径指定创建</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileInputStream</span>(String path);			<span class="comment">//通过一个路径指定创建</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FileDescriptor fdObj);	<span class="comment">//通过文件描述符创建</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>方法：</p>
<ul>
<li><p><code>available()</code>：返回目前可以从流中读取的字节数</p>
<p>实际操作时，读取的字节数可能大于这个返回值</p>
</li>
<li><p><code>close()</code>：关闭文件输入流，释放资源</p>
</li>
<li><p><code>finalize()</code>：确保在不引用文件输入流时调用其 <code>close()</code> 方法</p>
</li>
<li><p><code>getChannel()</code>：返回与此流有关的唯一的 <code>FileChannel</code> 对象</p>
</li>
<li><p><code>getFD()</code>：返回描述符</p>
</li>
<li><p><code>read()</code>：从该输入流中读取一个数据字节</p>
<p>如果没有输入可用，该方法会被阻止。返回 -1 的场合，说明到达文件的末尾。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\test&quot;</span>);</span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">int</span> read;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line"> <span class="keyword">while</span> ((read = fileInputStream.read()) != -<span class="number">1</span>)&#123;</span><br><span class="line">     System.out.print((<span class="type">char</span>) read);</span><br><span class="line"> &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"> e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">     fileInputStream.close();</span><br><span class="line"> &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">     e.printStackTrace();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;										<span class="comment">//真 TM 复杂。throw 了算了</span></span><br></pre></td></tr></table></figure>

<p>这个场合，效率较低</p>
</blockquote>
<p><code>read(byte[] b)</code>：从该输入流中把最多 b.length 个字节的数据读入一个 byte 数组</p>
<p>读取正常的场合，返回实际读取的字节数。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];					<span class="comment">//一次读取 8 字节</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line"> <span class="keyword">while</span> ((read = fileInputStream.read(b)) != -<span class="number">1</span>)&#123;</span><br><span class="line">     System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, read));</span><br><span class="line">     								<span class="comment">//这一句看不懂请看[12.2 - 4]</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">catch</span> </span><br><span class="line">...</span><br><span class="line"><span class="keyword">finally</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>read(byte[] b, int off, int len)</code>：从该输入流中读取 len 字节数据，从数组下标 off 处起写入</p>
</li>
<li><p><code>skip(long n)</code>：从该输入流中跳过并去丢弃 n 个字节的数据</p>
</li>
<li><p><code>mark(int markArea)</code>：标记数据量的当前位置，并划出一个缓冲区。缓冲区大小至少为 markArea</p>
<p><code>reset()</code>：将输入流重新定位到对此流最后调用 <code>mark()</code> 方法时的位置</p>
<p><code>markSupported()</code>：测试数据流是否支持 <code>mark()</code> 和 <code>reset()</code> 操作</p>
</li>
</ul>
</li>
</ul>
<h4 id="17-2-2-2-FileOutputStream：文件字节输出流"><a href="#17-2-2-2-FileOutputStream：文件字节输出流" class="headerlink" title="17.2.2.2 FileOutputStream：文件字节输出流"></a>17.2.2.2 <code>FileOutputStream</code>：文件字节输出流</h4><ul>
<li><p>构造器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(File file);			<span class="comment">//通过一个 File 的路径指定创建</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(File file, <span class="type">boolean</span> append);			</span><br><span class="line">							<span class="comment">//append = false，写入采用 覆盖原文件 方式</span></span><br><span class="line">							<span class="comment">//append = true 的场合，写入采用 末尾追加 方式</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(String path);			<span class="comment">//通过一个路径指定创建</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(String path, <span class="type">boolean</span> append);			</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(FileDescriptor fdObj);	<span class="comment">//通过文件描述符创建</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>方法：</p>
<ul>
<li><p><code>close()</code>：关闭文件输入流，释放资源</p>
</li>
<li><p><code>flush()</code>：刷新此输出流并强制写出所有缓冲的输出字节</p>
</li>
<li><p><code>finalize()</code>：确保在不引用文件输入流时调用其 <code>close()</code> 方法</p>
</li>
<li><p><code>getChannel()</code>：返回与此流有关的唯一的 <code>FileChannel</code> 对象</p>
</li>
<li><p><code>getFD()</code>：返回描述符</p>
</li>
<li><p><code>write(byte[] b)</code>：将 b.length 个字节从指定 byte 数组写入此文件输出流</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\test1&quot;</span>);</span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> fileOutputStream = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"> 									<span class="comment">//此时，若文件不存在会被创建</span></span><br><span class="line"> fileOutputStream.write(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Melody&quot;</span>;</span><br><span class="line"> fileOutputStream.write(str.getBytes());</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">finally</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>write(byte[] b， int off, int len)</code>：将指定 byte 数组中下标 off 开始的 len 个字节写入此文件输出流</p>
<p><code>write(int b)</code>：将指定字节写入此文件输出流</p>
</li>
</ul>
</li>
</ul>
<h4 id="17-2-2-3-FileReader：文件字符输入流"><a href="#17-2-2-3-FileReader：文件字符输入流" class="headerlink" title="17.2.2.3 FileReader：文件字符输入流"></a>17.2.2.3 <code>FileReader</code>：文件字符输入流</h4><blockquote>
<p>与其他程序设计语言使用 ASCII 码不同，Java 使用 Unicode 码表示字符串和字符。ASCII 码的字符占用 1 字节，可以认为一个字符就是一个字节。但 Unicode 码用 2 字节表示 1 个字符，此时字符流和字节流就不相同。</p>
</blockquote>
<ul>
<li><p>构造器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">FileRaeder</span>(File file);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileRaeder</span>(String string);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>方法：</p>
<ul>
<li><code>read()</code>：读取单个字符。</li>
<li><code>read(char[])</code>：批量读取多个字符到数组。</li>
</ul>
</li>
</ul>
<h4 id="17-2-2-3-FileWriter：文件字符输出流"><a href="#17-2-2-3-FileWriter：文件字符输出流" class="headerlink" title="17.2.2.3 FileWriter：文件字符输出流"></a>17.2.2.3 <code>FileWriter</code>：文件字符输出流</h4><ul>
<li><p>构造器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">FileWriter</span>(File path);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileWriter</span>(String path2);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileWriter</span>(File path3, <span class="type">boolean</span> append);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">FileWriter</span>(String path4, <span class="type">boolean</span> append);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>方法：</p>
<ul>
<li><code>write(int)</code>：写入单个字符</li>
<li><code>write(char[])</code>：写入指定数组</li>
<li><code>write(char[], off, len)</code>：写入指定数组的指定部分</li>
<li><code>write(string)</code>：写入字符串</li>
<li><code>write(string, off, len)</code>：写入字符串的指定部分</li>
<li><code>flush()</code>：刷新该流的缓冲。如果没有执行，内容就不会写入文件</li>
<li><code>close()</code>：等于 <code>flush()</code> + 关闭</li>
</ul>
<p><strong>注意！<code>FileWriter</code> 使用后，必须关闭（close）或刷新（flush），否则无法真正写入</strong></p>
</li>
</ul>
<h4 id="17-2-2-4-转换流-InputStreamReader-和-OutputStreamWriter"><a href="#17-2-2-4-转换流-InputStreamReader-和-OutputStreamWriter" class="headerlink" title="17.2.2.4 转换流 InputStreamReader 和 OutputStreamWriter"></a>17.2.2.4 转换流 <code>InputStreamReader</code> 和 <code>OutputStreamWriter</code></h4><ol>
<li><code>InputStreamReader</code> 是 <code>Reader</code> 的子类。可以把 <code>InputStream</code>（字节流）转换成 <code>Reader</code>（字符流）</li>
<li><code>OutputStreamWriter</code> 是 <code>Writer</code> 的子类。可以把 <code>OutputStream</code>（字节流）转换成 <code>Writer</code>（字符流）</li>
<li>处理纯文本数据时，如果使用字符流效率更高，并能有效解决中文问题，建议将字节流转换成字符流。</li>
<li>可以在使用时指定编码格式（UTF -8、GBK 等）</li>
</ol>
<ul>
<li><p>构造器</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(fileInputStream, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">										<span class="comment">//传入 字节流 和 编码类型</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bufferedreader</span>(isr);</span><br><span class="line">										<span class="comment">//用另一个处理流包装</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="17-2-3-节点流和处理流"><a href="#17-2-3-节点流和处理流" class="headerlink" title="17.2.3 节点流和处理流"></a>17.2.3 节点流和处理流</h3><ol>
<li>节点流：从一个特定数据源读写数据。</li>
<li>处理流（包装流）：是 “连接” 在已存在的流（节点流或处理流）上，为程序提供更强大的读写功能。</li>
</ol>
<h4 id="节点流和处理流的区别和联系"><a href="#节点流和处理流的区别和联系" class="headerlink" title="节点流和处理流的区别和联系"></a>节点流和处理流的区别和联系</h4><ol>
<li>节点流是 底层流 &#x2F; 低级流。直接和数据源相接。</li>
<li>处理流（包装流）包装节点流，既可以消除不同节点流的实现差异，也可以提供更方便的方法完成输入输出</li>
<li>处理流对节点流进行包装，使用了修饰器设计模式。不会直接与数据源相连</li>
<li>处理流的功能主要体现在<ul>
<li>性能的提高：以增加缓冲的方式提高输入输出的效率</li>
<li>操作的便捷：处理流可能提供了一系列便捷方法来一次性输入大量数据，使用更加灵活方便</li>
</ul>
</li>
<li>关闭时关闭外层流即可</li>
</ol>
<h4 id="17-2-3-1-缓冲区流"><a href="#17-2-3-1-缓冲区流" class="headerlink" title="17.2.3.1 缓冲区流"></a>17.2.3.1 缓冲区流</h4><blockquote>
<p>缓冲区流是一种包装流。缓冲区字节流有 BufferedInputStream 和 BufferedOutputStream；缓冲区字符流有 BufferedWriter 和 BufferedReader。他们是在数据流上加了一个缓冲区。读写数据时，数据以块为单位进入缓冲区，其后的读写操作则作用于缓冲区。</p>
<p>这种方式能降低不同硬件设备间的速度差异，提高 I&#x2F;O 效率。</p>
</blockquote>
<p>构造器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">BufferedReader</span>(reader);					<span class="comment">//传入一个 Reader</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">BufferedReader</span>(reader, <span class="number">1024</span>);			<span class="comment">//传入 Reader 并指定缓冲区大小</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(writer);					<span class="comment">//传入一个 Writer</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(writer, <span class="number">1024</span>);			<span class="comment">//传入 Writer 并指定缓冲区大小</span></span><br><span class="line">											<span class="comment">//追加还是覆盖，取决于 writer</span></span><br></pre></td></tr></table></figure>

<p>方法：</p>
<ul>
<li><p><code>bufferedReader.readLine()</code>：按行读取（不含换行符）。</p>
<p>会返回一个字符串。返回 null 时，表示读取完毕。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String line;</span><br><span class="line"><span class="keyword">while</span> (line = bufferedReader.readLine() != <span class="literal">null</span>)&#123;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br><span class="line">bufferedReader.close();</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>bufferedWriter.write(String str)</code>：插入字符串</p>
</li>
<li><p><code>bufferedWriter.newLine()</code>：插入一个（和系统相关的）换行</p>
</li>
</ul>
<h4 id="17-2-3-2-数据数据流"><a href="#17-2-3-2-数据数据流" class="headerlink" title="17.2.3.2 数据数据流"></a>17.2.3.2 数据数据流</h4><blockquote>
<p>除了字节或字节数组外，处理的数据还有其他类型。为解决此问题，可以使用  DataInputStream 和 DataOutputStream。它们允许通过数据流来读写 Java 基本类型，如布尔型（boolean）、浮点型（float）等</p>
</blockquote>
<p>构造器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">DataInputStream</span>(inputStream);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(outputStream);</span><br></pre></td></tr></table></figure>

<p>方法：</p>
<ul>
<li><p><code>byte readByte()</code>：读取下一个 byte</p>
<p><code>int readInt()</code>、<code>double readDouble()</code>、<code>String readUTF()</code>……</p>
</li>
<li><p><code>void writeByte(byte b)</code>：写入一个 byte</p>
<p><code>void writeInt(int n)</code>、<code>void writeUTF(String str)</code>……</p>
<p>虽然有对字符串的读写方法，但应避免使用这些方法，转而使用字符输入&#x2F;输出流。</p>
</li>
</ul>
<h4 id="17-2-3-3-对象流"><a href="#17-2-3-3-对象流" class="headerlink" title="17.2.3.3 对象流"></a>17.2.3.3 对象流</h4><blockquote>
<p>当我们保存数据时，同时也把 数据类型 或 对象 保存。</p>
<p>以上要求，就是能够将 基本数据类型 或 对象 进行 序列化·反序列化 操作</p>
</blockquote>
<p><strong>序列化和反序列化</strong></p>
<ol>
<li>把对象转成字符序列的过程称为序列化。保存数据时，保存数据的值和数据类型</li>
<li>把字符序列转成对象的过程称为反序列化。恢复数据时，恢复数据的值和数据类型</li>
<li>需要让某个对象支持序列化机制，则必须让其类是 可序列化的。由此，该类必须实现下列接口之一<ul>
<li><code>Serializable</code>：推荐。因为是标记接口，没有方法</li>
<li><code>Externalizable</code>：该接口有方法需要实现</li>
</ul>
</li>
</ol>
<p><strong>transient 关键字</strong></p>
<ol>
<li>有一些对象状态不具有可持久性（如 Thread 对象或流对象），这样的成员变量必须用 transient 关键字标明。任何标有 transient 关键字的成员变量都不会被保存。</li>
<li>一些需要保密的数据，不应保存在永久介质中。为保证安全，这些变量前应加上 transient 关键字。</li>
</ol>
<ul>
<li><p>构造器：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(InputStream inputStream);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(OutputStream outputStream);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>方法：</p>
<p>反序列化顺序需要和序列化顺序一致，否则出现异常。</p>
<ul>
<li><p><code>writeInt(Integer)</code>：写入一个 int </p>
<p><code>readInt()</code>：读取一个 int </p>
</li>
<li><p><code>writeBoolean(Boolaen)</code>：写入一个 boolean</p>
<p><code>readBoolean()</code>：读取一个 boolean</p>
</li>
<li><p><code>writeChar(Character)</code>：写入一个 char</p>
<p><code>readChar()</code>：读取一个 char</p>
</li>
<li><p><code>writeDouble(Double)</code>：写入一个 double</p>
<p><code>readDouble()</code>：读取一个 double </p>
</li>
<li><p><code>writeUTF(String)</code>：写入一个 String</p>
<p><code>readUTF()</code>：读取一个 String</p>
</li>
<li><p><code>writeObject(Serializable)</code>：写入一个 Obj</p>
<p><code>readObject()</code>：读取一个 Obj</p>
<p>读取的场合，如果想要调用方法，需要向下转型。</p>
<p>为此，需要该类其引入，或将类的定义拷贝到可以引用的位置。</p>
</li>
</ul>
</li>
<li><p><strong>注意事项</strong></p>
<ol>
<li><p>读写顺序要一致</p>
</li>
<li><p>实现序列化或反序列化的对象，要实现 <code>Serializable</code> 或 <code>Externalizable</code> 接口</p>
</li>
<li><p>序列化的类中建议添加 <code>SerialVersionUID</code> 以提高版本兼容性</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>有此序列号的场合，后续修改该类，系统会认为只是版本修改，而非新的类</p>
</li>
<li><p>序列化对象时，默认将其中所有属性进行序列化（除了 <code>static</code> 和 <code>tansient</code> 修饰的成员）</p>
</li>
<li><p>序列化对象时，要求其属性也实现序列化接口</p>
</li>
<li><p>序列化具备可继承性。某类若实现可序列化，则其子类也可序列化</p>
</li>
</ol>
</li>
</ul>
<h4 id="17-2-3-4-标准输入-x2F-输出流"><a href="#17-2-3-4-标准输入-x2F-输出流" class="headerlink" title="17.2.3.4 标准输入 &#x2F; 输出流"></a>17.2.3.4 标准输入 &#x2F; 输出流</h4><table>
<thead>
<tr>
<th>Σ( ° △ °lll）</th>
<th>编译类型</th>
<th>运行类型</th>
<th>默认设备</th>
</tr>
</thead>
<tbody><tr>
<td><code>System.in</code>：标准输入</td>
<td><code>InputStream</code></td>
<td><code>BufferedInputStream</code></td>
<td>键盘</td>
</tr>
<tr>
<td><code>System.out</code>：标准输出</td>
<td><code>PaintStream</code></td>
<td><code>PaintStream</code></td>
<td>显示器</td>
</tr>
</tbody></table>
<h4 id="17-2-3-5-打印流-PaintStream-和-PaintWriter"><a href="#17-2-3-5-打印流-PaintStream-和-PaintWriter" class="headerlink" title="17.2.3.5 打印流 PaintStream 和 PaintWriter"></a>17.2.3.5 打印流 <code>PaintStream</code> 和 <code>PaintWriter</code></h4><blockquote>
<p>打印流只有输出流，没有输入流</p>
</blockquote>
<ol>
<li><p><code>PaintStream</code> 是 <code>OutputStream</code> 的子类。<code>PaintWriter</code> 是 <code>Writer</code> 的子类。</p>
</li>
<li><p>默认情况下，<code>System.out</code> 输出位置是 标准输出（即：显示器）</p>
<p>修改默认输出位置：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setOut(<span class="keyword">new</span> <span class="title class_">PrintStream</span>(path));</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h4 id="17-2-3-6-Properties-类"><a href="#17-2-3-6-Properties-类" class="headerlink" title="17.2.3.6 Properties 类"></a>17.2.3.6 <code>Properties</code> 类</h4><ol>
<li><p><code>Properties</code> 是专门用于读写配置文件的集合类</p>
<p>底层维护了一个 <code>Entry</code> 数组</p>
</li>
<li><p>配置文件格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">键=值</span><br><span class="line">键=值</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

<p><strong>注意：键值对不需要空格，值不需要引号（值默认 <code>String</code>）</strong></p>
</li>
<li><p>常见方法：</p>
<ul>
<li><p><code>load(InputStream)</code></p>
<p><code>load(Reader)</code>：加载配置文件的键值对到 <code>Properties</code> 对象</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">properties.load(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;d:\\data.data&quot;</span>));</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>list(PaintStream)</code></p>
<p><code>list(PaintWriter)</code>：将数据显示到指定设备</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.list(System.out);			<span class="comment">//在控制台显示</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>getProperty(key)</code>：根据键获取值</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.get(<span class="string">&quot;IQ&quot;</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>setProperty(key, value)</code>：设置键值对到 <code>Properties</code> 对象</p>
<p>如果没有该 key，就是创建。如有，就是替换。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">properties.set(<span class="string">&quot;IQ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">properties.set(<span class="string">&quot;Balance&quot;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>store(Writer, String)</code></p>
<p><code>store(OutputStream, String)</code>：把 <code>Properties</code> 中的键值对存储到配置文件。</p>
<p>后面的 <code>String</code> 是注释。如有，会被用 <code>#</code> 标记并写在文件最上方。注释可以为 null。</p>
<p>IDEA 中，如果含有中文，会储存为 unicode 码</p>
<p><a target="_blank" rel="noopener" href="http://tool.chinaz.com/tools/unicode.aspx">查询 unicode 码</a></p>
</li>
</ul>
</li>
</ol>
<h4 id="17-2-3-7-随机访问文件"><a href="#17-2-3-7-随机访问文件" class="headerlink" title="17.2.3.7 随机访问文件"></a>17.2.3.7 随机访问文件</h4><blockquote>
<p>程序阅读文件时不仅要从头读到尾，还要实现每次在不同位置进行读取。此时可以使用 RandomAccessFile</p>
</blockquote>
<p>构造器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(String name, String mode);		<span class="comment">//通过文件名</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(File file, String mode);		<span class="comment">//通过文件对象</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数 mode 决定以只读方式 <code>mode = &quot;r&quot;</code> 还是读写方式 <code>mode = &quot;rw&quot;</code> 访问文件。</p>
</blockquote>
<p>方法：</p>
<ul>
<li><p><code>long getFilePointer()</code>：返回文档指针的当前位置</p>
</li>
<li><p><code>void seek(long pos)</code>：将文档指针置于指定的绝对位置 pos</p>
<p>文档指针的位置从文档开始的字符处开始计算，<code>pos = 0L</code> 表示文档的开始</p>
</li>
<li><p><code>long length()</code>：返回文件长度</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/06/17%20IO%E6%B5%81/" data-id="claq1vt5h000mtwtf8pcreb69" data-title="&lt;Java&gt;17 IO流" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-16 多线程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2022/01/01/16%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2021-12-31T16:00:00.000Z" itemprop="datePublished">2022-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2022/01/01/16%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/">&lt;Java&gt;16 多线程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="16-多线程"><a href="#16-多线程" class="headerlink" title="16 多线程"></a>16 多线程</h1><h2 id="16-1-线程的概念"><a href="#16-1-线程的概念" class="headerlink" title="16.1 线程的概念"></a>16.1 线程的概念</h2><blockquote>
<p>对于一般程序而言，其结构大都可以分为一个入口、一个出口、一个顺次执行的语句序列。这样的语句结构称为进程，它是程序的一次动态执行，对应了代码加载、执行至完毕的全过程。</p>
<p>进程即是程序在处理机中的一次运行。在这样一个结构中不仅包含程序代码，也包括了系统资源的概念。</p>
<p>在单 CPU 计算机内部，微观上讲，同一时间只能有一个线程运行。实现多线程即从宏观上使多个作业同时执行。</p>
</blockquote>
<p>程序：为完成特定任务，用某种语言编写的一组指令的集合。</p>
<p>进程：运行中的程序。当你运行一个程序，系统就会为该进程分配空间。进程是程序的一次执行过程。是一个动态过程：有其自身产生、存在、消亡的过程。</p>
<p>线程：由进程创建的，进程的一个实体。一个进程可以有多个线程。</p>
<p>单线程：同一时刻，只允许执行一个线程。</p>
<p>多线程：同一时刻，可以执行多个线程。</p>
<p>并发：同一时刻，多个任务交替执行，造成一种貌似并行的状态。单核 CPU 实现的多任务就是并发。</p>
<p>并行：同一时刻，多个任务同时进行。多核 CPU 可以实现并行。</p>
<h3 id="16-1-1-线程的结构"><a href="#16-1-1-线程的结构" class="headerlink" title="16.1.1 线程的结构"></a>16.1.1 线程的结构</h3><p>在 Java 中，线程由以下 3 部分组成：</p>
<ul>
<li>虚拟 CPU：封装在 java.lang.Thread 类中，控制着整个线程的运行</li>
<li>执行的代码：传递给 Thread 类，由其控制按序执行</li>
<li>处理的数据：传递给 Thread 类，是在代码执行过程中需要处理的数据</li>
</ul>
<h3 id="16-1-2-线程的状态"><a href="#16-1-2-线程的状态" class="headerlink" title="16.1.2 线程的状态"></a>16.1.2 线程的状态</h3><blockquote>
<p>Java 的线程是通过包 java.lang 中定义的类 Thread 来实现的。当生成了一个 Thread 类后就产生了一个线程。通过该对象实例，可以启动线程、终止线程，或暂时挂起线程</p>
</blockquote>
<p>线程共有 4 种状态：新建（New）、可运行（Runnable）、死亡（Dead）、阻塞（Blocked）</p>
<ul>
<li><p><strong>新建（New）：</strong></p>
<p>线程对象刚刚创建，还未启动（New）。此时还处于不可运行状态，但已有了相应内存空间及其他资源</p>
</li>
<li><p><strong>可运行（Runnable）：</strong></p>
<p>此时线程已经启动，处于线程的 <code>run()</code> 方法中。这种情况下线程可能正在运行；也可能没有运行，但只要 CPU 空闲就会立刻运行。</p>
<p>可以运行但没在运行的线程都排在一个队列中，这个队列称为就绪队列。</p>
<p>可运行状态下，运行中的线程处于运行状态（Running），未运行线程处于就绪状态（Ready）。</p>
<p>调用 <code>start()</code> 方法可以让线程进入可运行状态。</p>
</li>
<li><p><strong>死亡（Dead）：</strong></p>
<p>线程死亡（Terminated）的原因有两个：一是 <code>run()</code> 方法最后一个语句执行完毕，二是线程遇到异常退出</p>
</li>
<li><p><strong>阻塞（Blocked）：</strong></p>
<p>一个正常运行的线程因为特殊原因被暂停执行，就进入阻塞状态（Blocked）。</p>
<p>阻塞时线程不能进入就绪对流排队，必须等到引起阻塞的原因消除，才能重新进入队列排队。</p>
<p>引起阻塞的方法很多，<code>sleep()</code> 和 <code>wait()</code> 是两个常用的阻塞方法</p>
</li>
<li><p><strong>中断线程：</strong></p>
<ul>
<li><p><code>void interrupt()</code>：向一个线程发送一个中断请求，并把该线程的 interruptd 状态变为 true。</p>
<p>中断阻塞线程的场合，会抛出 InterruptException 异常</p>
</li>
<li><p><code>static boolean interrupted()</code>：检测当前线程是否被中断，并重置状态 interrupted 的值。</p>
<p>连续调用该方法的场合，第二次调用会返回 false</p>
</li>
<li><p><code>boolean isInterrupted()</code>：检测当前线程是否中断。不改变 interrupted 的值</p>
</li>
</ul>
</li>
</ul>
<h2 id="16-2-线程的使用"><a href="#16-2-线程的使用" class="headerlink" title="16.2 线程的使用"></a>16.2 线程的使用</h2><p>在 Java 中线程使用有两种方法：</p>
<ol>
<li><p>继承 <code>Thread</code> 类，重写 <code>run</code> 方法</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>		<span class="comment">//可见 Thread 也是实现了 Runable 接口</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>实现 <code>Runable</code> 接口，重写 <code>run</code> 方法</p>
</li>
</ol>
<h3 id="16-2-1-继承-Thread-类"><a href="#16-2-1-继承-Thread-类" class="headerlink" title="16.2.1 继承 Thread 类"></a>16.2.1 继承 Thread 类</h3><blockquote>
<p>Thread 类是 Java 用于表示线程的类。那么，一个类被定义为其子类，则该类也能用来表示线程</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Type</span>();</span><br><span class="line"> type.start();								<span class="comment">//开始线程</span></span><br><span class="line"> 											<span class="comment">//如果用 run 方法，则还是停留在主线程</span></span><br><span class="line"> 											<span class="comment">//  那样，相当于 串行。执行完毕才继续</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Type</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;						<span class="comment">//先继承 Thread 类</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">         System.out.println(i);</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Thread.sleep(<span class="number">100</span>);				<span class="comment">//休眠 100 毫秒</span></span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (i++ == <span class="number">10</span>) &#123;					<span class="comment">//i = 10 时停止循环</span></span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关于 <code>start()</code> 方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">	...</span><br><span class="line">    start0();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">start0</span><span class="params">()</span>;					<span class="comment">//start0 是 native。即，底层方法</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>start()</code> 方法调用了一个 <code>start0()</code> 底层方法</li>
<li><code>start0()</code> 是本地方法，由 JVM 调用，底层是 c&#x2F;c++ 实现</li>
<li>真正的多线程效果，是 <code>start0()</code>，而不是 <code>run()</code></li>
<li><code>start()</code> 方法调用 <code>start0()</code> 方法后，该线程不一定会立刻执行，只是将线程变成了可运行状态。具体何时运行，由 CPU 统一调度</li>
</ol>
<h3 id="16-2-2-实现-Runable-接口"><a href="#16-2-2-实现-Runable-接口" class="headerlink" title="16.2.2 实现 Runable 接口"></a>16.2.2 实现 Runable 接口</h3><blockquote>
<p>Runnable 是 Java 用以实现线程的接口。从根本上将，任何实现线程的类都必须实现该接口。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="type">Runnable</span> <span class="variable">type</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Type</span>();					<span class="comment">//Runable 没有 start()方法</span></span><br><span class="line"> <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(type);				<span class="comment">//所以，这里使用了 静态代理</span></span><br><span class="line"> thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Type</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;				<span class="comment">//这部分和 Thread 相似</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">         System.out.println(i &lt;&lt; i);</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Thread.sleep(<span class="number">100</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">             e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (++i &gt; <span class="number">15</span>)&#123;</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关于 静态代理</strong></p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Runable</span> &#123;&#125;</span><br><span class="line">	...	</span><br><span class="line">	<span class="keyword">private</span> Runnable target;</span><br><span class="line">	...</span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">Thread</span><span class="params">(Runnable target)</span> &#123;	<span class="comment">//构造器</span></span><br><span class="line">     init(<span class="literal">null</span>, target, <span class="string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="number">0</span>);</span><br><span class="line">     								<span class="comment">//这句话可以先理解为 this.target = target;</span></span><br><span class="line"> &#125;</span><br><span class="line">	...</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">         target.run();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相当于，先创建了一个新线程，然后在新线程中调用 run 方法</p>
</blockquote>
<h3 id="16-2-3-继承-Thread-和-实现-Runable-的区别"><a href="#16-2-3-继承-Thread-和-实现-Runable-的区别" class="headerlink" title="16.2.3 继承 Thread 和 实现 Runable 的区别"></a>16.2.3 继承 Thread 和 实现 Runable 的区别</h3><ol>
<li>从 Java 设计来看，两者本质上没有区别。<code>Thread</code> 类本身就实现了 <code>Runable</code> 接口</li>
<li>实现 <code>Runable</code> 接口的方式更加适合多个线程共享一个资源的情况，且避免了单继承的限制。建议使用。</li>
</ol>
<h3 id="16-2-4-线程中止"><a href="#16-2-4-线程中止" class="headerlink" title="16.2.4 线程中止"></a>16.2.4 线程中止</h3><ol>
<li><p>当线程结束后，会自动退出</p>
</li>
<li><p>还可以通过使用变量来控制 <code>run</code> 方法退出的方式来停止线程，即 通知方式。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"> <span class="keyword">while</span> (active) &#123;					<span class="comment">//这个场合，只要外部控制 active 即可</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         Thread.sleep(<span class="number">1</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line">     move();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="16-2-5-线程常用方法"><a href="#16-2-5-线程常用方法" class="headerlink" title="16.2.5 线程常用方法"></a>16.2.5 线程常用方法</h3><ul>
<li><p><code>setName(name)</code>：设置线程名称，使之与参数 name 相同</p>
</li>
<li><p><code>getName()</code>：返回线程名称</p>
</li>
<li><p><code>start()</code>：线程开始执行。JVM 调用 <code>start0</code> 方法</p>
<p>该方法会创建新的线程，新线程调用 <code>run</code>。</p>
</li>
<li><p><code>run()</code>：到下面玩跑步</p>
<p>就是简单的方法调用，不会产生新线程。</p>
</li>
<li><p><code>setPriority(int priority)</code>：更改线程优先级</p>
<p><code>getPriority()</code>：获取线程优先级</p>
<p>priority 范围：</p>
<ul>
<li>MAX_PRIORITY：最高优先级（10）</li>
<li>MIN_PRIORITY：最低优先级（1）</li>
<li>NORM_PRIORITY：不高不低，真是好极了的优先级（5）</li>
</ul>
<p>每个线程都有一个<strong>优先级</strong>。Java 线程调度采用如下优先级策略：</p>
<ul>
<li>优先级高的先执行，优先级低的后执行</li>
<li>每个线程创建时会被自动分配一个优先级。默认的场合，继承父类优先级</li>
<li>任务紧急的线程，优先级较高</li>
<li>同优先级线程按 “先进先出” 原则调度</li>
</ul>
</li>
<li><p><code>sleep(int millsecond)</code>：让线程休眠指定的时间</p>
<p>该方法是 Thread 类的静态方法，可以直接调用</p>
</li>
<li><p><code>interrupt()</code>：中断线程（不是 中止）</p>
</li>
<li><p><code>yield()</code>：线程的礼让。让出 CPU 让其他线程执行。因为礼让的时间不确定，所以不一定礼让成功。</p>
<p>本质是 RUNNING 切换为 READY，即让当前线程放弃执行权</p>
</li>
<li><p><code>wait()</code>：导致当前线程等待</p>
<p>直到其他线程调用此对象的 <code>notify()</code> 方法或 <code>notifyAll()</code> 方法才能唤醒此线程</p>
<p><code>notify()</code>、<code>notifyAll()</code>：唤醒因 <code>wait()</code> 阻塞的线程。</p>
<p>这些方法（<code>wait()</code>、<code>notify()</code>、<code>notifyAll()</code>）只能在 synchrnized 方法或代码块中调用</p>
</li>
<li><p><code>join()</code>：线程的插队。插队的线程一旦插入成功，则必定先执行完插队线程的所有任务</p>
<p>将导致其他线程的等待，直到 <code>join()</code> 方法的线程结束</p>
<p><code>join(long timeout)</code>：join，但是时间到后也能结束其他线程的等待</p>
</li>
<li><p><code>isAlive()</code>：测试当前线程是否在活动</p>
</li>
<li><p><code>Thread.currentThread()</code>：引用当前运行中的线程</p>
</li>
</ul>
<h3 id="16-2-6-用户线程和守护线程"><a href="#16-2-6-用户线程和守护线程" class="headerlink" title="16.2.6 用户线程和守护线程"></a>16.2.6 用户线程和守护线程</h3><ul>
<li><p>用户线程：也叫工作线程。当线程任务执行完毕或通知方式结束</p>
</li>
<li><p>守护线程：一般是为工作线程服务的。当所有线程结束，守护线程自动结束</p>
<p>常见的守护线程：垃圾回收机制</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">thraed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(bullet);</span><br><span class="line">thread.setDeamon(<span class="literal">true</span>);							<span class="comment">//这样，子线程被设置为主线程的守护线程</span></span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="16-2-7-线程的生命周期"><a href="#16-2-7-线程的生命周期" class="headerlink" title="16.2.7 线程的生命周期"></a>16.2.7 线程的生命周期</h3><p>线程的状态有</p>
<ul>
<li><p>NEW：尚未启动</p>
</li>
<li><p>RUNNABLE：在 JVM 中执行的线程</p>
<p>可细分为 READY 和 RUNNING</p>
</li>
<li><p>BLOCKED：被阻塞等待监视器锁定的线程</p>
</li>
<li><p>WAITING：正等待另一个线程执行特定动作的线程</p>
</li>
<li><p>TIMED_WAITING：正等待另一个线程执行特定动作达到等待时间的线程</p>
</li>
<li><p>TERMINATED：已退出的线程</p>
</li>
</ul>
<p>有一张重要的图，去 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fh411y7R8?p=593&t=1010.6">这里</a> 查看吧</p>
<h2 id="16-3-线程的互斥"><a href="#16-3-线程的互斥" class="headerlink" title="16.3 线程的互斥"></a>16.3 线程的互斥</h2><blockquote>
<p>在多线程编程，一些敏感数据不允许被多个线程同时访问。此时就用同步访问技术，保证数据在任意时刻，最多有一个线程同时访问，以保证数据的完整性。</p>
<p>也可以这样理解：线程同步，即当有一个线程对内存进行操作时，其他线程都不能对这个内存地址进行操作（被阻塞），直到该线程完成操作，再让下一线程进行操作。</p>
</blockquote>
<h3 id="16-3-1-互斥锁"><a href="#16-3-1-互斥锁" class="headerlink" title="16.3.1 互斥锁"></a>16.3.1 互斥锁</h3><blockquote>
<p>在 Java 语言中，引入了 “对象互斥锁” 的概念，也称为监视器，来保证共享数据操作的完整性</p>
<p>每个对象都对应一个可称为 “互斥锁” 的标记，这个标记用来保证在任一时刻都只能有一个线程访问对象。</p>
<p>Java 语言中，有 2 种方式实现互斥锁：</p>
<ul>
<li>用关键字 volatile 声明一个共享数据（变量）。一般很少使用该关键字</li>
<li>用关键字 synchronized 声明共享数据的一个方法或一个代码</li>
</ul>
<p>同步的局限性：导致程序的执行效率要降低。</p>
<p>非静态的对象，同步方法的锁可以是 this，也可以是其他对象（要求是同一对象）</p>
<p>静态对象，同步方法的锁为当前类本身</p>
</blockquote>
<ol>
<li><p>同步代码块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (对象) &#123;		<span class="comment">//得到对象的锁，才能操作同步代码</span></span><br><span class="line">	需要被同步代码;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在第一个线程持有锁定标记时，如果另一个线程企图执行该代码块语句，将从对象中索取锁定标记。</p>
<p>因为此时该标记不可得，古该线程不能继续执行，而是加入等待队列。</p>
<p>程序运行完 synchronized 代码块后，锁定标记会被自动返还。即使该同步代码块执行过程中抛出异常也是如此。一个线程多次调用该同步代码块的场合，也会在最外层执行完毕后正确返还。</p>
</li>
<li><p>放在方法声明中，表示整个方法为同步方法</p>
<p>因为 synchronized 语句的参数必须是 this，因此允许下面这种简洁的写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">	代码;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="16-3-2-线程死锁"><a href="#16-3-2-线程死锁" class="headerlink" title="16.3.2 线程死锁"></a>16.3.2 线程死锁</h3><blockquote>
<p>多个线程都占用了对方的资源，不肯相让，就导致了死锁。编程时要避免死锁的产生。</p>
</blockquote>
<ul>
<li><p>以下操作会释放锁</p>
<ol>
<li>当前线程的同步方法、同步代码块执行结束。</li>
<li>当前线程在同步方法、同步代码块中遇到 <code>break</code>、<code>return</code></li>
<li>当前线程在同步方法、同步代码块中出现了未处理的 <code>Error</code></li>
<li>当前线程在同步方法、同步代码块中执行了 <code>wait()</code> 方法，当前线程暂停，并释放锁</li>
</ol>
</li>
<li><p>以下操作不会释放锁</p>
<ol>
<li><p>执行同步方法、同步代码块时，程序调用 <code>Thread.sleep()</code> 或 <code>Thread.yield()</code> 方法暂停当前线程的执行，不会释放锁</p>
</li>
<li><p>线程执行同步代码块时，其他线程调用了该线程的 <code>suspend()</code> 方法将该线程挂起，该线程不会释放锁</p>
<p>所以，应尽量避免使用 <code>suspend()</code> 和 <code>resume()</code> 来控制线程</p>
</li>
</ol>
</li>
</ul>
<h2 id="16-4-线程的同步"><a href="#16-4-线程的同步" class="headerlink" title="16.4 线程的同步"></a>16.4 线程的同步</h2><blockquote>
<p>Java 中，可以使用 <code>wait()</code>、<code>notify()</code>、<code>notifyAll()</code> 来协调线程间的运行速度关系。这些方法都被定义在 java.lang.Object 中</p>
<p>Java 中的每个对象实例都有两个线程队列和它相连。一个用以实现等待锁定标志的线程，另一个用来实现 <code>wait()</code> 和 <code>notify()</code> 的交互机制</p>
</blockquote>
<ul>
<li><p><code>wait()</code>：让当前线程释放所有其持有的 “对象互斥锁”，进入等待队列</p>
</li>
<li><p><code>notify()</code>、<code>notifyAll()</code>：唤醒一个或所有在等待队列中等待的线程，并将他们移入同一个等待 “对象互斥锁” 的队列。</p>
<p>执行这些方法时如果没有等待中的线程，则其不会生效，也不会被保留到以后再生效</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key.value == <span class="number">0</span>) key.wait();</span><br><span class="line">    key.value--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (key) &#123;</span><br><span class="line">    key.value++;</span><br><span class="line">    key.nitifyAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为调用这些方法时必须持有对象的 “对象互斥锁”，所以上述方法只能在 synhronized 方法或代码块中执行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2022/01/01/16%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" data-id="claq1vt5f000itwtf53tx42dy" data-title="&lt;Java&gt;16 多线程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-12 常用类" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2021/12/19/12%20%E5%B8%B8%E7%94%A8%E7%B1%BB/" class="article-date">
  <time class="dt-published" datetime="2021-12-18T16:00:00.000Z" itemprop="datePublished">2021-12-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2021/12/19/12%20%E5%B8%B8%E7%94%A8%E7%B1%BB/">&lt;Java&gt;12 常用类</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="12-常用类"><a href="#12-常用类" class="headerlink" title="12 常用类"></a>12 常用类</h1><h2 id="12-1-包装类"><a href="#12-1-包装类" class="headerlink" title="12.1 包装类"></a>12.1 包装类</h2><blockquote>
<p>包装类（Wrapper）：针对 八种基本数据类型 相应的 引用类型</p>
<p>有了类的特点，就可以调用类中的方法</p>
</blockquote>
<table>
<thead>
<tr>
<th>基本数据类型</th>
<th>包装类</th>
<th>父类</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>Boolean</td>
<td>Object</td>
</tr>
<tr>
<td>char</td>
<td>Character</td>
<td>Object</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
<td>Number</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
<td>Number</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
<td>Number</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
<td>Number</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
<td>Number</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
<td>Number</td>
</tr>
<tr>
<td>void</td>
<td>Void</td>
<td>Object</td>
</tr>
</tbody></table>
<h3 id="12-1-1-装箱和拆箱"><a href="#12-1-1-装箱和拆箱" class="headerlink" title="12.1.1 装箱和拆箱"></a>12.1.1 装箱和拆箱</h3><ul>
<li><p><strong>手动装箱和拆箱（JDK 5 以前）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(n1);			<span class="comment">// 手动装箱</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer2</span> <span class="operator">=</span> Integer.valueOf(n1);		<span class="comment">// 手动装箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> integer.intValue();					<span class="comment">// 手动拆箱</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自动装箱和拆箱（JDK 5 以后）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n2 = <span class="number">200</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer3</span> <span class="operator">=</span> n2;						<span class="comment">// 自动装箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> integer3;							<span class="comment">// 自动拆箱</span></span><br></pre></td></tr></table></figure>

<p>虽然可以自动装箱、拆箱，但使用 == 直接比较两个包装类时，仍然是比较其地址。以下比较通常会失败：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">ia</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">ib</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">System.out.print(ia == ib);					<span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>但，Java 实现仍有可能使其成立。Byte、Boolean 以及 Short、Integer 中 [-128, 127] 间的值已被包装到固定的对象中。对他们的比较可以成功。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">ia</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">ib</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line">System.out.print(ia == ib);					<span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>由此可见，使用  == 直接比较两个包装类会带来不确定性。<strong>尽量使用 equals 方法对包装类进行比较。</strong></p>
</li>
</ul>
<p>装箱与拆箱是 <strong>编译器</strong> 的工作。在生成可执行的字节码文件时，编译器已经插入了必要的方法调用。</p>
<h3 id="12-1-2-包装类和-String-的相互转换"><a href="#12-1-2-包装类和-String-的相互转换" class="headerlink" title="12.1.2 包装类和 String 的相互转换"></a>12.1.2 包装类和 <code>String</code> 的相互转换</h3><ul>
<li><p>包装类转 <code>String</code>：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">&gt;<span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> integer + <span class="string">&quot;&quot;</span>;					<span class="comment">//方法1（自动拆箱）</span></span><br><span class="line">&gt;<span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> integer.toString();			<span class="comment">//方法2（toString方法）</span></span><br><span class="line">&gt;<span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> String.valueOf(integer);		<span class="comment">//方法3（自动拆箱）</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>String</code> 转包装类：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="string">&quot;100&quot;</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer2</span> <span class="operator">=</span> Integer.parseInt(str4);	<span class="comment">//方法1（自动装箱）</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(str4);		<span class="comment">//方法2（构造器）</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="12-1-3-包装类的常用方法"><a href="#12-1-3-包装类的常用方法" class="headerlink" title="12.1.3 包装类的常用方法"></a>12.1.3 包装类的常用方法</h3><ul>
<li><p><code>Integer.MIN_VALUE</code>：返回最大值</p>
</li>
<li><p><code>Double.MAX_VALUE</code>：返回最小值</p>
</li>
<li><p><code>byteValue()</code>、<code>doubleValue()</code>、<code>floatValue()</code>、<code>intValue()</code>、<code>longValue()</code></p>
<p>按各种基本数据类型返回该对象的值</p>
</li>
<li><p><code>Character.isDigit(int)</code>：判断是不是数字</p>
<p><code>Character.isLetter(int)</code>：判断是不是字母</p>
<p><code>Character.isUpperCase(int)</code>：判断是不是大写字母</p>
<p><code>Character.isLowerCase(int)</code>：判断是不是小写字母</p>
<p><code>Characher.isWhitespace(int)</code>：判断是不是空格</p>
</li>
<li><p><code>Character.toUpperCase(int)</code>：转成大写字母</p>
<p><code>Character.toLowerCase(int)</code>：转成小写字母</p>
</li>
<li><p><code>Integer.parseInt(string)</code>：将 String 内容转为 int</p>
<p><code>Double.parseDouble(string)</code></p>
</li>
<li><p><code>Integer.toBinaryString(int)</code>：将数字转为 2 进制表示的字符串</p>
<p><code>Integer.toHexString(int)</code>：将数字转为 16 进制表示的字符串</p>
<p><code>Integer.toOctalString(int)</code>：将数字转为 8 进制表示的字符串</p>
<p>特别地，浮点数类型的包装类只有转成 16 进制的方法。而 Short、Byte 及其他包装类无此方法</p>
</li>
<li><p><code>int Integer.bitCount(i int)</code>：统计指定数字的二进制格式中 1 的数量</p>
</li>
</ul>
<h3 id="12-1-4-strictfp-关键字"><a href="#12-1-4-strictfp-关键字" class="headerlink" title="12.1.4 strictfp 关键字"></a>12.1.4 strictfp 关键字</h3><blockquote>
<p>由于不同处理器对于浮点数寄存采取不同策略（有些处理器使用 64 位寄存 double，有些则是 80 位），对于浮点数的运算在不同平台上可能出现不同结果。</p>
</blockquote>
<p>使用 strictfp 关键字标记的方法或类中，所有指令都会使用严格统一的浮点数运算。</p>
<p>比如，把 main 方法标记为 strictfp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">strictfp</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">double</span> ᓚᘏᗢ = <span class="number">1</span> / <span class="number">13.97</span>;</span><br><span class="line">    System.out.println(ᓚᘏᗢ);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="12-2-String-类"><a href="#12-2-String-类" class="headerlink" title="12.2 String 类"></a>12.2 <code>String</code> 类</h2><ol>
<li><p><code>String</code> 对象用于保存字符串，也就是一组字符序列</p>
</li>
<li><p>字符串常量对象是用双引号扩起的字符序列。例如 <code>&quot;你好&quot;</code></p>
</li>
<li><p>字符串的字符使用 Unicode 字符编码。一个字符（不论字母汉字）占 2 字节</p>
</li>
<li><p>常用构造器：</p>
<ul>
<li><p><code>String str1 = new String();</code></p>
</li>
<li><p><code>String str2 = new String(String original);</code></p>
</li>
<li><p><code>String str3 = new String(char[] a);</code></p>
</li>
<li><p><code>String str4 = new String(char[] a, int startIndex, int count);   </code></p>
<p>这句意思是：<code>char[]</code> 从 <code>startIndex</code> 起的 <code>count</code> 个字符</p>
</li>
</ul>
</li>
<li><p><code>String</code> 实现了接口 <code>Serializable</code> 和 <code>Comparable</code> ，可以 串行化和 比较大小</p>
<p><em><strong>串行化：即，可以被网络传输，也能保存到文件</strong></em></p>
</li>
<li><p><code>String</code> 是 <code>final</code>  类，不能被继承</p>
</li>
<li><p><code>String</code> 有属性 <code>private final char[] value;</code> 用于存放字符串内容。</p>
<p><code>value</code> 是 <code>final</code> 属性。其在栈中的地址不能修改，但堆中的内容可以修改。</p>
</li>
</ol>
<h3 id="12-2-1-String-构造方法"><a href="#12-2-1-String-构造方法" class="headerlink" title="12.2.1 String 构造方法"></a>12.2.1 <code>String</code> 构造方法</h3><ul>
<li><p>直接指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;哈哈哈&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>该方法：先从常量池看是否有 <code>&quot;哈哈哈&quot;</code> 数据空间。有的场合，指向那个空间；否则重新创建然后指向。</p>
<p>这个方法，<code>str1</code> 指向 常量池中的地址。</p>
</li>
<li><p>构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;嘿嘿嘿&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>该方法：先在堆中创建空间，里面维护一个 <code>value</code> 属性，指向 或 创建后指向 常量池的 <code>&quot;嘿嘿嘿&quot;</code> 空间。</p>
<p>这个方法，<code>str2</code> 指向 堆中的地址</p>
</li>
</ul>
<h3 id="12-2-2-字符串的特性"><a href="#12-2-2-字符串的特性" class="headerlink" title="12.2.2 字符串的特性"></a>12.2.2 字符串的特性</h3><ul>
<li><p>常量相加，看的是池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;aa&quot;</span> + <span class="string">&quot;bb&quot;</span>;				<span class="comment">//常量相加，看的是池</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上例由于构造器自身优化，相当于 <code>String str1 = &quot;aabb&quot;;</code></p>
</blockquote>
</li>
<li><p>变量相加，是在堆中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;aa&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;bb&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> a + b;					<span class="comment">//变量相加，是在堆中</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上例的底层是如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">sb.append(a);</span><br><span class="line">sb.append(b);</span><br><span class="line">str2 = sb.toString();	<span class="comment">//sb.toString()：return new String(value, 0, count);</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="12-2-3-String-的常用方法"><a href="#12-2-3-String-的常用方法" class="headerlink" title="12.2.3 String 的常用方法"></a>12.2.3 <code>String</code> 的常用方法</h3><p>以下方法不需死记硬背，手熟自然牢记</p>
<ul>
<li><p><code>boolean equals(String s)</code>：区分大小写，判断内容是否相等</p>
<p><code>boolean equalsIgnoreCase(String s)</code>：判断内容是否相等（忽略大小写）</p>
</li>
<li><p><code>boolean empty()</code>：返回是否为空</p>
</li>
<li><p><code>int charAt(int index)</code>：获取某索引处的字符（代码单元）。</p>
<p>必须用 <code>char c = str.charAt(15);</code>，不能用 <code>char c = str[15];</code></p>
<p><code>int codePointAt(int index)</code></p>
<p><code>int length()</code>：获取字符（<strong>代码单元</strong>）的个数</p>
<p><em><strong>—— 代码单元，见 <a href="../../../../../..public/2021/11/22/Java/%E5%85%A5%E9%97%A8%E9%98%B6%E6%AE%B5/2%20%E5%8F%98%E9%87%8F/#2-6-2-%E5%AD%97%E7%AC%A6%E6%9C%AC%E8%B4%A8%E4%B8%8E%E7%BC%96%E7%A0%81%E8%A1%A8">[2.6.2.4 字符本质与编码表]</a></strong></em></p>
<p><code>IntStream codePoints()</code>：返回字符串中全部码点构成的流</p>
<p><code>long codePoints().count()</code>：返回真正长度（码点数量）</p>
<p><em><strong>—— 流，见 <a href="../../../../../..public/2022/03/09/Java/%E5%85%A5%E9%97%A8%E9%98%B6%E6%AE%B5/27%20Java%208%20%E6%96%B0%E7%89%B9%E6%80%A7/#27-4-Stream-API">[27.4 Stream API]</a></strong></em></p>
</li>
<li><p><code>int indexOf(String str)</code>：获取字符（串）在字符串中第一次出现的索引。如果找不到，返回 -1</p>
<p><code>int indexOf(int char)</code> 参数也可以传入一个 int。由于自动类型转换的存在，也能填入 char</p>
<p><code>int indexOf(String str, int index)</code>：从 index 处（包含）开始查找指定字符（串）</p>
<p><code>int lastIndexOf(String str)</code>：获取字符在字符串中最后一次出现的索引。如果找不到，返回 -1</p>
</li>
<li><p><code>String substring(int start, int end)</code>：返回截取指定范围 [start, end) 的 <strong>新</strong> 字符串</p>
<p><code>String substring(int index)</code>：截取 index（包含）之后的部分</p>
</li>
<li><p><code>String trim()</code>：返回去前后空格的新字符串</p>
</li>
<li><p><code>String toUperCase()</code>：返回字母全部转为大写的新字符串</p>
<p><code>String toLowerCase()</code>：返回字母全部转为小写的新字符串</p>
</li>
<li><p><code>String concat(String another)</code>：返回拼接字符串</p>
</li>
<li><p><code>String replace(char oldChar, char newChar)</code>：替换字符串中的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;Foolish cultists&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> str1.replace(<span class="string">&quot;cultists&quot;</span>, <span class="string">&quot;believers&quot;</span>);	<span class="comment">//str1不变，str2为改变的值</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String[] split(String regex)</code>：分割字符串。</p>
<p>对于某些分割字符，我们需要转义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;aaa,bbb,ccc&quot;</span>;</span><br><span class="line">String[] strs1 = str1.split(<span class="string">&quot;,&quot;</span>);		<span class="comment">//这个场合，strs = &#123;&quot;aaa&quot;, &quot;bbb&quot;, &quot;ccc&quot;&#125;;4</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;aaa\bbb\ccc&quot;</span>;</span><br><span class="line">String[] strs2 = str2.split(<span class="string">&quot;\\&quot;</span>);		<span class="comment">//&quot;\&quot; 是特殊字符，需要转义为 &quot;\\&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int compareTo(String another)</code>：按照字典顺序比较两个字符串（的大小）。</p>
<p>返回出现第一处不同的字符的编号差。前面字符相同，长度不同的场合，返回那个长度差。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;ccc&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;ca&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;ccc111abc&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> str1.compareTo(str2);			<span class="comment">//此时 n1 = &#x27;c&#x27; - &#x27;a&#x27; = 2</span></span><br><span class="line"><span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> str1.compareTo(str3);			<span class="comment">//此时 n2 = str1,length - str3.length = -6</span></span><br><span class="line"><span class="type">int</span> <span class="variable">n3</span> <span class="operator">=</span> str1.compareTo(str1);			<span class="comment">//此时 n3 = 0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>char[] toCharArray()</code>：转换成字符数组</p>
<p><code>byte[] getBytes()</code>：字符串转为字节数组</p>
</li>
<li><p><code>String String.format(String format, Object... args)</code>：（静态方法）格式字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Roin&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> <span class="string">&quot;1M&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">state</span> <span class="operator">=</span> <span class="string">&quot;computer&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">formatStr</span> <span class="operator">=</span> <span class="string">&quot;I am %s, I am %s old, I am a %s&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> String.format(formatStr, name, age, state);</span><br><span class="line"><span class="comment">//其中 %s 是占位符。此时，str = &quot;I am Roin, I am 1M old, I am a computer&quot;;</span></span><br><span class="line"><span class="comment">//%s 表示字符串替换；%d 表示整数替换；#.2f 表示小数（四舍五入保留2位）替换；%c 表示字符替换</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String join(deli, ele...)</code>：拼接字符串（<code>ele...</code>），以 <code>deli</code> 间隔。</p>
</li>
<li><p><code>boolean startsWith(str)</code>：测试 str 是否为当前字符串的前缀</p>
</li>
<li><p><code>String repeat(int n)</code>：返回该字符串重复 n 次的结果</p>
</li>
</ul>
<h2 id="12-3-StringBuffer-类"><a href="#12-3-StringBuffer-类" class="headerlink" title="12.3 StringBuffer 类"></a>12.3 <code>StringBuffer</code> 类</h2><blockquote>
<p><code>java.lang.StringBuffer</code> 代表可变的字符序列。可以对字符串内容进行增删。</p>
<p>很多方法和 <code>String</code> 相同，但 <code>StringBuffer</code> 是可变长度。同时，<code>StringBuffer</code> 是一个容器</p>
</blockquote>
<ol>
<li><code>StringBuffer</code> 的直接父类是 <code>AbstractStringBuffer</code></li>
<li><code>StringBuffer</code> 实现了 <code>Serialiazable</code>，可以串行化</li>
<li>在父类中，<code>AbstractStringBuffer</code> 有属性 <code>char[] value</code> 不是 <code>final</code></li>
<li><code>StringBuffer</code> 是一个 <code>final</code> 类，不能被继承</li>
</ol>
<p><strong><code>String</code> 对比 <code>StringBuffer</code></strong></p>
<ul>
<li><code>String</code> 保存字符串常量，其中的值不能更改。每次更新实际上是更改地址，效率较低</li>
<li><code>StringBuffer</code> 保存字符串变量，里面的值可以更改。每次更新是更新内容，不用每次更新地址。</li>
</ul>
<h3 id="12-3-1-StringBuffer-构造方法"><a href="#12-3-1-StringBuffer-构造方法" class="headerlink" title="12.3.1 StringBuffer 构造方法"></a>12.3.1 <code>StringBuffer</code> 构造方法</h3><ol>
<li><p>无参构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuffer</span> <span class="variable">strb1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创造一个 16 位容量的空 <code>StringBuffer</code></p>
</blockquote>
</li>
<li><p>传入字符串构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abcabc&quot;</span>;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">strb2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(str1);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>（上例）创造一个 str1.length + 16 容量的 <code>StringBuffer</code></p>
</blockquote>
</li>
<li><p>指定容量构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuffer</span> <span class="variable">strb3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>（上例）创造一个 3 容量的空 <code>StringBuffer</code></p>
</blockquote>
</li>
</ol>
<h3 id="12-3-2-String-和-StringBuffer的转换"><a href="#12-3-2-String-和-StringBuffer的转换" class="headerlink" title="12.3.2 String 和 StringBuffer的转换"></a>12.3.2 <code>String</code> 和 <code>StringBuffer</code>的转换</h3><ol>
<li><p>转 <code>StringBuffer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abcabc&quot;</span>;</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">strb1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(str1);	<span class="comment">//方法1（构造器）</span></span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">strb1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();		</span><br><span class="line">strb1 = strb1.append(str1);						<span class="comment">//方法2（先空再append）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>转 <code>String</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> strb1.toString();					<span class="comment">//方法1（toString）</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(strb1);				<span class="comment">//方法2（构造器）</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="12-3-3-StringBuffer-的常用方法"><a href="#12-3-3-StringBuffer-的常用方法" class="headerlink" title="12.3.3  StringBuffer 的常用方法"></a>12.3.3  <code>StringBuffer</code> 的常用方法</h3><ul>
<li><p><code>append(char c)</code>：增加</p>
<p><code>append(String s)</code> 参数也能是字符串</p>
<p>特别的，<code>append(null);</code> 的场合，等同于 <code>append(&quot;null&quot;);</code></p>
</li>
<li><p><code>delete(start, end)</code>：删减 [start, end) 的内容</p>
</li>
<li><p><code>replace(start, end, string)</code>：将 start 与 end 间的内容替换为 string</p>
</li>
<li><p><code>indexOf</code>：查找指定字符串第一次出现时的索引。没找到的场合返回 -1</p>
</li>
<li><p><code>insert</code>：在指定索引位置之前插入指定字符串</p>
</li>
<li><p><code>length()</code>：返回字符长度</p>
<p><code>capacity()</code>：返回当前的容量</p>
<p>String 类对象分配内存时，按照对象中所含字符个数等量分配。</p>
<p>StringBuffer 类对象分配内存时，除去字符所占空间外，会另加 16 字符大小的缓冲区。</p>
<p>对于 <code>length()</code> 方法，返回的是字符串长度。对于 <code>capacity()</code> 方法，返回的是 字符串 + 缓冲区 的大小。</p>
</li>
</ul>
<h2 id="12-4-StringBuilder-类"><a href="#12-4-StringBuilder-类" class="headerlink" title="12.4 StringBuilder 类"></a>12.4 <code>StringBuilder</code> 类</h2><blockquote>
<p>一个可变的字符序列。此类提供一个与 <code>StringBuffer</code> 兼容的 API，但不保证同步（有线程安全问题）。该类被设计成  <code>StringBuffer</code> 的一个简易替换，<strong>用在字符串缓冲区被单个线程使用的时候</strong>。如果可能，建议优先使用该类。因为在大多数实现中，它比起 <code>StringBuffer</code> 要快。</p>
<p>在 <code>StringBuilder</code> 是的主要操作是 <code>append</code> 和 <code>insert</code> 方法。可以重载这些方法，以接受任意类型的数据。</p>
</blockquote>
<ol>
<li><p><code>StringBuilder</code> 也继承了 <code>AbstractStringBuffer</code></p>
</li>
<li><p><code>StringBuilder</code> 也实现了 <code>Serialiazable</code>，可以串行化</p>
</li>
<li><p>仍然是在父类中有属性 <code>char[] value</code> ，而且不是 <code>final</code></p>
</li>
<li><p><code>StringBuilder</code> 也是一个 <code>final</code> 类，不能被继承</p>
</li>
<li><p><code>StringBuilder</code> 的方法，没有做互斥的处理（没有 <code>synchronize</code>），故而存在线程安全问题</p>
</li>
</ol>
<h3 id="12-4-1-String、StringBuffer、StringBuilder-的对比"><a href="#12-4-1-String、StringBuffer、StringBuilder-的对比" class="headerlink" title="12.4.1 String、StringBuffer、StringBuilder 的对比"></a>12.4.1 <code>String</code>、<code>StringBuffer</code>、<code>StringBuilder</code> 的对比</h3><ol>
<li><p><code>StringBuilder</code> 和 <code>StringBuffer</code> 类似，均代表可变字符序列，而且方法也一样</p>
</li>
<li><p><code>String</code>：不可变字符序列，效率低，但复用率高</p>
</li>
<li><p><code>StringBuffer</code>：可变字符序列，效率较高，线程安全</p>
</li>
<li><p><code>StringBuilder</code>：可变字符序列，效率最高，存在线程安全问题</p>
</li>
<li><p><code>String</code> 为何效率低：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;aa&quot;</span>;					<span class="comment">//创建了一个字符串</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>; n &lt; <span class="number">100</span>; n++)&#123;		</span><br><span class="line">	str1 += <span class="string">&quot;bb&quot;</span>;					<span class="comment">//这里，原先的字符串被丢弃，创建新字符串</span></span><br><span class="line">&#125;									<span class="comment">//多次执行后，大量副本字符串留在内存中</span></span><br><span class="line">									<span class="comment">//导致效率降低，也会影响程序性能</span></span><br></pre></td></tr></table></figure>

<p>如上，对 <code>String</code> 大量修改的场合，不要使用 <code>String</code></p>
</blockquote>
</li>
</ol>
<h2 id="12-5-Math-类"><a href="#12-5-Math-类" class="headerlink" title="12.5 Math 类"></a>12.5 <code>Math</code> 类</h2><ul>
<li><p><code>Math.multiplyExact(int n1, int n2)</code>：进行乘法运算，返回运算结果</p>
<p>通常的乘法 <code>n1 * n2</code> 在结果大于那个数据类型存储上限时，可能返回错误的值。</p>
<p>使用此方法，结果大于那个数据类型存储上限时，会抛出异常</p>
<p><code>Math.addExact(int n1, int n2)</code>：加法</p>
<p><code>Math.subtractExact(int n1, int n2)</code>：减法</p>
<p><code>Math.incrementExact(int n1)</code>：自增</p>
<p><code>Math.decrementExact(int n1)</code>：自减</p>
<p><code>Math.negateExact(int n1, int n2)</code>：改变符号</p>
</li>
<li><p><code>Math.abs(n)</code>：求绝对值，返回 |n1|</p>
</li>
<li><p><code>Math.pow(n, i)</code>：求幂，返回 n3 ^ i</p>
</li>
<li><p><code>Math.ceil(n)</code>：向上取整，返回 &gt;&#x3D; n3 的最小整数（转成double）</p>
</li>
<li><p><code>Math.floor(n)</code>：向下取整，返回 &lt;&#x3D;n4 的最小整数（转成double）</p>
</li>
<li><p><code>Math.floorMod(int n1, int n2)</code>：返回 n1 除以 n2 的余数</p>
<p><code>n1 % n2</code> 的场合，返回的可能是负数，而不是数学意义上的余数</p>
</li>
<li><p><code>Math.round(n)</code>：四舍五入，相当于 <code>Math.floor(n5 + 0.5)</code></p>
</li>
<li><p><code>Math.sqrt(n)</code>：求开方。负数的场合，返回 <code>NaN</code></p>
</li>
<li><p><code>Math.random()</code>：返回一个 [0, 1) 区间的随机小数</p>
</li>
<li><p><code>Math.sin(n)</code>：正弦函数</p>
<p><code>Math.cos(n)</code>：余弦函数</p>
<p><code>Math.tan(n)</code>、<code>Math.atan(n)</code>、<code>Math.atan2(n)</code></p>
<p>要注意，上述方法传入的参数是 <strong>弧度值</strong>。</p>
<p>要得到一个角度的弧度值，应使用：<code>Math.toRadians(n)</code></p>
</li>
<li><p><code>Math.exp(n)</code>：e 的 n 次幂</p>
<p><code>Math.log10(n)</code>：10 为底的对数</p>
<p><code>Math.log()</code>：自然对数</p>
</li>
<li><p><code>Math.PI</code>：圆周率的近似值</p>
<p><code>Math.E</code>：e 的近似值</p>
</li>
</ul>
<h2 id="12-6-Arrays-类"><a href="#12-6-Arrays-类" class="headerlink" title="12.6 Arrays 类"></a>12.6 <code>Arrays</code> 类</h2><ul>
<li><p><code>Arrays.toString()</code>：返回数组的字符串形式</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] nums = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">33</span>&#125;;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> Array.toString(nums);		<span class="comment">//此时，str = &quot;[0, 1, 33]&quot;</span></span><br></pre></td></tr></table></figure>

<p>特别的，输入为 null 时返回 “null”</p>
</blockquote>
</li>
<li><p><code>Arrays.sort(arr)</code>：排序</p>
<p>因为数组是引用类型，使用 sort 排序后，会直接影响到实参。</p>
<p>默认（自然排序）从小到大排序。</p>
<p><code>Arrays.sort(arr, Comparator c)</code>：按照传入的比较器决定排序方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Integer[] nums;</span><br><span class="line">...</span><br><span class="line">Comparator&lt;Integer, Integer&gt; c = <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer, Integer&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> n2 - n1;						<span class="comment">// 这个场合，变成从大到小排序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Arrays.sort(nums, c);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Arrays.binarySearch(array, num)</code>：通过二分搜索法查找。前提是必须先排序。</p>
<p>找不到的场合，返回 - (low + 1)。即，其应该在的位置的负值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer[] nums2 = &#123;-<span class="number">10</span>, -<span class="number">5</span>, -<span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">9</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> Arrays.binarySearch(nums2, <span class="number">7</span>);	<span class="comment">// 此时 index = -7</span></span><br><span class="line">											<span class="comment">// 如果 7 存在，应该在第 7 个位置</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Arrays.copyOf(arr, n)</code>：从 <code>arr</code> 中，复制 n 个元素（成为新的数组）。</p>
<p>n &gt; arr.length 的场合，在多余的位置添加 <code>null</code>。n &lt; 0 的场合，抛出异常。</p>
<p>该方法的底层使用的是 <code>System.arraycopy</code></p>
</li>
<li><p><code>Arrays.fill(arr, o)</code>：用 o 填充 <code>num</code> 的所有元素。</p>
</li>
<li><p><code>Arrays.equals(arr1, arr2)</code>：比较两个数组元素是否完全一致（<code>true</code>&#x2F;<code>false</code>）</p>
</li>
<li><p><code>Arrays.asList(a, b, c, d)</code>：将输入数据转成一个 <code>List</code> 集合</p>
</li>
</ul>
<h2 id="12-7-System-类"><a href="#12-7-System-类" class="headerlink" title="12.7 System 类"></a>12.7 <code>System</code> 类</h2><ul>
<li><p><code>System.exit(0)</code>：退出当前程序。0 表示一个状态，正常状态是 0</p>
</li>
<li><p><code>System.arraycopy(arr, 0, newArr, 0 ,3)</code>：复制数组元素。</p>
<p>上例是：arr 自下标 0 起开始，向 newArr 自下标 0 开始，依次拷贝 3 个值</p>
<p>这个方法比较适合底层调用。我们一般使用 <code>Arrays.copyOf</code> 来做</p>
</li>
<li><p><code>System.currentTimeMillis</code>：返回当前时间距离 1970 - 1 - 1 的毫秒数</p>
</li>
<li><p><code>System.gc</code>：运行垃圾回收机制</p>
</li>
</ul>
<h2 id="12-8-BigInteger-和-BigDecimal-类"><a href="#12-8-BigInteger-和-BigDecimal-类" class="headerlink" title="12.8 BigInteger 和 BigDecimal 类"></a>12.8 <code>BigInteger</code> 和 <code>BigDecimal</code> 类</h2><blockquote>
<p><code>BigInteger</code>：适合保存更大的整数</p>
<p> <code>BigDecimal</code>：适合保存精度更大的浮点数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用引号把大数变成字符串</span></span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">bigNum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;100000000000000000000000&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>构造方法：</strong></p>
<ul>
<li><code>new BigInteger(String intStr)</code>：通过一个字符串构建大数</li>
<li><code>BigInteger BigInteger.valueOf(1)</code>：通过静态方法，让整数类型转成大数</li>
</ul>
<p>另外，在对 <code>BigInteger</code> 和 <code>BigDecimal</code> 进行加减乘除的时候，需要使用对应方法</p>
<p>不能直接用 <code>+</code> <code>-</code> <code>*</code> <code>/</code></p>
<p><strong>常用方法：</strong></p>
<ul>
<li><p><code>BigInteger add(BigInteger)</code>：加法运算。返回新的大数</p>
</li>
<li><p><code>BigInteger subtract(BigInteger)</code>：减法</p>
</li>
<li><p><code>BigInteger multiply(BigInteger)</code>：乘法</p>
</li>
<li><p><code>BigInteger divide(BigInteger)</code>：除法运算</p>
<p>该方法可能抛出异常。因为可能产生是无限长度小数。</p>
<p>解决方法（保留分子精度）：<code>bigDecimal.divide(bD3, BigDecimal.ROUND_CELLING)</code></p>
</li>
<li><p>一些常量：</p>
<p><code>BigInteger.ONE</code>、<code>BigInteger.ZERO</code>、<code>BigInteger.TEN</code> 分别是 1、0、10</p>
<p>one 就是英文的 1，zero 就是英文的 0……这个大家都懂的吧？</p>
</li>
</ul>
<h2 id="12-9-日期类"><a href="#12-9-日期类" class="headerlink" title="12.9 日期类"></a>12.9 日期类</h2><h3 id="12-9-1-第一代日期类"><a href="#12-9-1-第一代日期类" class="headerlink" title="12.9.1 第一代日期类"></a>12.9.1 第一代日期类</h3><blockquote>
<p>Date：精确到毫秒，代表特定瞬间。这里的是 java.util.Date</p>
<p>SimpleDateFormat：格式和解析日期的类</p>
</blockquote>
<ol>
<li><p><code>Date d1 = new Date();</code>：调用默认无参构造器，获取当前系统时间。</p>
<p>默认输出日期格式是国外的格式，因此通常需要进行格式转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy.MM.dd HH.mm.ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateFormated</span> <span class="operator">=</span> sdf.(d1);							<span class="comment">//日期转成指定格式。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过指定毫秒数得到时间：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">d2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">10000000000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>把一个格式化的字符串转成对应的 Date：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy年MM月dd日 HH点mm分 E&quot;</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">d3</span> <span class="operator">=</span> sdf2.parse(<span class="string">&quot;2021年12月22日 00点03分 星期三&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这个场合，给定的字符串格式应和 <code>sdf2</code> 格式相同，否则会抛出异常</p>
</li>
</ol>
<h3 id="12-9-2-第二代日期类"><a href="#12-9-2-第二代日期类" class="headerlink" title="12.9.2 第二代日期类"></a>12.9.2 第二代日期类</h3><blockquote>
<p>Calendar：构造器是私有的，要通过 getInstance 方法获取实例</p>
</blockquote>
<ol>
<li><p>Calendar 是一个抽象类，其构造器私有</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">c1</span> <span class="operator">=</span> Calendar.genInstance();				<span class="comment">//获取实例的方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提供大量方法和字段提供给程序员使用</p>
<ul>
<li><p><code>c1.get(Calendar.YEAR)</code>：获取年份数</p>
</li>
<li><p><code>c1.get(Calendar.MONTH)</code>：获取月份数</p>
<p>特别的，实际月份是 返回值 +1。因为 Calendar 的月份是从 0 开始编号的</p>
</li>
<li><p><code>c1.get(Calendar.DAY_OF_MONTH)</code>：获取日数</p>
</li>
<li><p><code>c1.get(Calendar.HOUR)</code>：获取小时数（12小时制）</p>
<p><code>c1.get(Calendar.HOUR_OF_DATE)</code>：获取小时数（24小时制）</p>
</li>
<li><p><code>c1.get(Calendar.MINUTE)</code>：获取分钟数</p>
</li>
<li><p><code>c1.get(Calendar.SECOND)</code>：获取秒数</p>
</li>
</ul>
<p>Calendar 没有专门的格式化方法，需要程序员自己组合来显示</p>
</li>
</ol>
<h3 id="12-9-3-第三代日期类"><a href="#12-9-3-第三代日期类" class="headerlink" title="12.9.3 第三代日期类"></a>12.9.3 第三代日期类</h3><blockquote>
<p>JDK 1.0 加入的 Date 在 JDK 1.1 加入 Calendar 后已被弃用</p>
<p>然而，Calendar 也存在不足：</p>
<ol>
<li>可变性：像日期和实际这样的类应该是不可改变的</li>
<li>偏移性：年份都是从 1900 年开始，月份都是从 0 开始</li>
<li>格式化：只对 Date 有用，对 Calendar 没用</li>
<li>其他问题：如不能保证线程安全，不能处理闰秒（每隔 2 天多 1 秒）等</li>
</ol>
<p>于是，在 JDK 8 加入了以下新日期类：</p>
<ul>
<li>LocalDate：只包含 日期（年月日），可以获取 日期字段</li>
<li>LocalTime：只包含 时间（时分秒），可以获取 时间字段</li>
<li>LocalDateTime：包含 日期 + 时间，可以获取 日期 + 时间字段</li>
<li>DateTimeFormatter：格式化日期</li>
<li>Instant：时间戳</li>
</ul>
</blockquote>
<ol>
<li><p>使用 <code>now()</code> 方法返回当前时间的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LocalDateTime</span> <span class="variable">ldt</span> <span class="operator">=</span> LocalDateTime.now();				<span class="comment">//获取当前时间</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取各字段方法：</p>
<ul>
<li><p><code>ldt.getYear();</code>：获取年份数</p>
</li>
<li><p><code>ldt.getMonth();</code>：获取月份数（英文）</p>
<p><code>ldt.getMonthValue();</code>：获取月份数（数字）</p>
</li>
<li><p><code>ldt.getDayOfMonth();</code>：获取日数</p>
</li>
<li><p><code>LocalDateTime ldt2 = ldt.plusDays(100);</code>：获取 ldt 时间 100 天后的时间实例</p>
</li>
<li><p><code>LocalDateTime ldt3 = ldt.minusHours(100);</code>：获取 ldt 时间 100 小时前的时间实例</p>
</li>
<li><p>…</p>
</li>
</ul>
</li>
<li><p>格式化日期：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DateTimeFormatter</span> <span class="variable">dtf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTimeFormatter</span>(<span class="string">&quot;yyyy.MM.dd HH.mm.ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> dtf.format(ldt);							<span class="comment">//获取格式化字符串</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Instant</code> 和 <code>Date</code> 类似</p>
<ul>
<li><p>获取当前时间戳：<code>Instant instant = Instant.now();</code></p>
</li>
<li><p>转换为 <code>Date</code>：<code>Date date = Date.form(instant);</code></p>
</li>
<li><p>由 <code>Date</code> 转换：<code>Instant instant = date.toInstant;</code></p>
</li>
</ul>
</li>
</ol>
<h2 id="12-10-泛型"><a href="#12-10-泛型" class="headerlink" title="12.10 泛型"></a>12.10 泛型</h2><blockquote>
<p>泛型（generic）：又称 参数化类型。是JDK 5 出现的新特性。解决数据类型的安全性问题。</p>
<p>在类声明或实例化时只要制定好需要的具体类型即可。</p>
</blockquote>
<p>举例说明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Properties&lt;Person&gt; prop = <span class="keyword">new</span> <span class="title class_">Properties</span>&lt;Person&gt;();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上例表示存放到 <code>prop</code> 中的必须是 <code>Person</code> 类型。</p>
<p>如果编译器发现添加类型不符合要求，即报错。</p>
<p>遍历时，直接取出 <code>Person</code> 而非 <code>Object</code></p>
</blockquote>
<ol>
<li><p>编译时，检查添加元素的类型。可以保证如果编译时没发出警告，运行就不会产生 ClassCastException 异常。提高了安全性，使代码更加简洁、健壮。</p>
</li>
<li><p>也减少了转换的次数，提高了效率。</p>
</li>
<li><p>泛型的作用是：可以在类声明是通过一个标识表示类中某个属性的类型，或某个方法返回值的类型，或参数类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">P</span>&lt;E&gt; &#123;</span><br><span class="line">	E e;				<span class="comment">//E 表示 e 的数据类型，在定义 P类 时指定。在编译期间即确认类型</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">P</span><span class="params">(E e)</span>&#123;		<span class="comment">//可作为参数类型</span></span><br><span class="line">		<span class="built_in">this</span>.e = e;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> E <span class="title function_">doSth</span><span class="params">()</span>&#123;	<span class="comment">//可作为返回类型</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.e;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例化时指定 E 的类型，编译时上例所有 E 会被编译器替换为那个指定类型</p>
</li>
</ol>
<h4 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h4><ul>
<li><p><strong>声明泛型：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">InterfaceName</span>&lt;T&gt; &#123;...&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassName</span>&lt;A, B, C, D&gt; &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>上例 T、A、B、C、D 不是值，而是类型。可以用任意字母代替</p>
</li>
<li><p><strong>实例化泛型：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">Iterator&lt;Integer&gt; iterator = vector.interator&lt;Integer&gt;();</span><br></pre></td></tr></table></figure>

<p>类名后面指定类型参数的值</p>
</li>
</ul>
<p><strong>注意细节：</strong></p>
<ol>
<li><p>泛型只能是引用类型</p>
</li>
<li><p>指定泛型具体类型后，可以传入该类型或其子类类型</p>
</li>
<li><p>在实际开发中往往简写泛型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>编译器会进行类型推断，右边 <code>&lt; &gt;</code> 内容可以省略</p>
</li>
<li><p>实例化不写泛型的场合，相当于默认泛型为 <code>Object</code></p>
</li>
</ol>
<h4 id="自定义泛型类-·-接口："><a href="#自定义泛型类-·-接口：" class="headerlink" title="自定义泛型类 · 接口："></a>自定义泛型类 · 接口：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Name</span>&lt;A, B...&gt; &#123;...&#125;				<span class="comment">//泛型标识符 可有多个，一般是单个大写字母表示</span></span><br></pre></td></tr></table></figure>

<p>这就是自定义泛型啊</p>
<ol>
<li><p>普通成员可以使用泛型（属性、方法）</p>
</li>
<li><p>泛型类的类型，是在创建对象时确定的。</p>
<p>因此：静态方法中不能使用类的泛型；使用泛型的数组，也不能初始化。</p>
</li>
<li><p>创建对象时不指定的场合，默认 Object。建议还是写上 <code>&lt;Object&gt;</code>，大气，上档次</p>
</li>
<li><p>自定义泛型接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Name</span>&lt;T, R...&gt; &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>泛型接口，其泛型在 继承接口 或 实现接口 时确定。</p>
</li>
</ol>
<h4 id="自定义泛型方法："><a href="#自定义泛型方法：" class="headerlink" title="自定义泛型方法："></a>自定义泛型方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修饰符 &lt;T, R...&gt; 返回类型 方法名(形参) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>可以定义在普通类中，也可以定义在泛型类中</p>
</li>
<li><p>当泛型方法被调用时，类型会确定</p>
</li>
<li><p>以下场合</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class C&lt;T&gt; &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cMethord</span><span class="params">(T t)</span>&#123;		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>没有 <code>&lt; &gt;</code>，不是泛型方法，而是使用了泛型的普通方法</p>
</li>
</ol>
<h4 id="泛型继承："><a href="#泛型继承：" class="headerlink" title="泛型继承："></a>泛型继承：</h4><ol>
<li>泛型不具有继承性</li>
<li><code>&lt;?&gt;</code>：支持任意泛型类型</li>
<li><code>&lt;? extends A&gt;</code>：支持 A 及 A的子类，规定了泛型的上限</li>
<li><code>&lt;? super B&gt;</code>：支持 B 及 B 的父类，规定了泛型的下限</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2021/12/19/12%20%E5%B8%B8%E7%94%A8%E7%B1%BB/" data-id="claq1vt5a0006twtfg4kqcd81" data-title="&lt;Java&gt;12 常用类" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-11 异常" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2021/12/18/11%20%E5%BC%82%E5%B8%B8/" class="article-date">
  <time class="dt-published" datetime="2021-12-17T16:00:00.000Z" itemprop="datePublished">2021-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2021/12/18/11%20%E5%BC%82%E5%B8%B8/">&lt;Java&gt;11 异常</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="11-异常（Exception）"><a href="#11-异常（Exception）" class="headerlink" title="11 异常（Exception）"></a>11 异常（Exception）</h1><blockquote>
<p>在 Java 语言中，将程序执行中发生的不正常情况称为 “异常”（开发过程中的语法错误和逻辑错误不是异常）</p>
<p>这些 异常事件 可分为两类：</p>
<ul>
<li><p>Error（错误）：Java 虚拟机无法解决的严重问题。</p>
<p>如：JVM 系统内部错误，资源耗尽等严重情况。Error 是严重错误，程序会崩溃。</p>
</li>
<li><p>Exception：其他因编程错误或偶然的外部因素导致的一般性问题，可以使用针对性的代码进行处理。</p>
<p>如：空指针访问，试图读取不存在的文件，网络中断等等。</p>
<p>Exception 又分为两大类：</p>
<ul>
<li>运行时异常（程序运行时，发生的异常）</li>
<li>编译时异常（编程时，编译器检查出的异常）</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="11-1-异常体系图"><a href="#11-1-异常体系图" class="headerlink" title="11.1 异常体系图"></a>11.1 异常体系图</h2><blockquote>
<p>编译异常（受检异常） 和 运行异常（非受检异常）</p>
<p>Java 源程序  ——(javac.exe)——&gt; 字节码文件 ——(java.exe)——&gt; 在内存中加载，运行类</p>
<p>​							 编译异常↑										运行异常↑</p>
</blockquote>
<p><img src="/img/Java_InputImage/%E5%BC%82%E5%B8%B8%E4%BD%93%E7%B3%BB%E5%9B%BE_11.1.png"></p>
<p>​	<em>（异常体系图_11.1）</em></p>
<p>异常分为两大类：运行时异常 和 编译时异常</p>
<ul>
<li><p>运行时异常，编译器不要求强制处置的异常。一般是指编程的逻辑错误，是程序员应该避免其出现的异常。</p>
<p>java.lang.RuntimeException 类及它的子类都是运行时异常</p>
<p>对于运行时异常，可以不做处理。因为这类异常很普遍，若全处理会对程序的可读性和运行效率产生影响</p>
</li>
<li><p>编译时异常，是编译器要求必须处置的异常</p>
</li>
</ul>
<h3 id="11-1-1-常见的运行时异常"><a href="#11-1-1-常见的运行时异常" class="headerlink" title="11.1.1 常见的运行时异常"></a>11.1.1 常见的运行时异常</h3><blockquote>
<p>常见的运行时异常（RuntimeException）包括</p>
<ul>
<li>NullPointerException：空指针异常</li>
<li>ArithmeticException：数学运算异常</li>
<li>ArrayIndexOutOfBoundsException：数组下标越界异常</li>
<li>ClassCastException：类型转换异常</li>
<li>NumberFormatException：数学格式异常</li>
</ul>
</blockquote>
<p><strong>空指针异常</strong></p>
<ul>
<li>当应用程序试图在需要对象的地方使用 null 时，抛出该异常。</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> str.length;					<span class="comment">//这里，出现了 空指针异常</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>数学运算异常</strong></p>
<ul>
<li>当出现异常的运算条件时，抛出该异常。</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">100</span> / <span class="number">0</span>;					<span class="comment">//这里，出现了 数学运算异常</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>数组下标越界异常</strong></p>
<ul>
<li>用非法索引（为负或超出范围）访问数组时，抛出该异常。</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] nums = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">nums[-<span class="number">50</span>] = <span class="number">100</span>;					<span class="comment">//这里，出现了 数组下标越界异常</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>类型转换异常</strong></p>
<ul>
<li>当试图把对象强制转换为不是实例的子类时，抛出该异常。</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A1</span>();</span><br><span class="line">        <span class="type">A2</span> <span class="variable">a1</span> <span class="operator">=</span> (A2)a1;				<span class="comment">//这里，出现了 类型转换异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A1</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A2</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>数字格式不正确异常</strong></p>
<ul>
<li>当应用程序试图将字符串转成一种数值类型，但该字符串不能转换为适当格式时，抛出该异常。</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;ABC&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(str);	<span class="comment">//这里，出现了 数字格式不正确异常</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="11-1-2-常见的编译异常"><a href="#11-1-2-常见的编译异常" class="headerlink" title="11.1.2 常见的编译异常"></a>11.1.2 常见的编译异常</h3><blockquote>
<p>常见的编译异常：</p>
<ul>
<li>SQLException：操作数据库时，查询表可能发生异常</li>
<li>IOException：操作文件时，发生的异常</li>
<li>FileNotFoundException：操作一个不存在的文件时，发生的异常</li>
<li>ClassNotFoundException：加载类，而该类不存在时，发生的异常</li>
<li>EOFException：操作文件，到文档末尾，发生的异常</li>
<li>IllegalArguementException：参数异常</li>
</ul>
</blockquote>
<p>因为还没有学习 SQL、文件编程 等，这里不举例子</p>
<h2 id="11-2-异常处理"><a href="#11-2-异常处理" class="headerlink" title="11.2 异常处理"></a>11.2 异常处理</h2><blockquote>
<p>异常发生时，对异常的处理方式。如果没有显式异常处理，默认处理方式是 <code>throws</code></p>
<ul>
<li><code>try - chatch - finally</code>：程序员在代码中捕获发生的异常，自行处理</li>
<li><code>throws</code>：将发生的异常抛出，交给调用者（方法）来处理。最顶级的处理者就是 JVM</li>
</ul>
</blockquote>
<h3 id="11-2-1-try-catch-异常处理"><a href="#11-2-1-try-catch-异常处理" class="headerlink" title="11.2.1 try - catch 异常处理"></a>11.2.1 <code>try - catch</code> 异常处理</h3><blockquote>
<p> Java 提供 try 和 catch 块 来处理异常。try 块用于包含可能出错的代码，catch 块用于处理 try 块中的异常。可以根据需要在程序中有多个 <code>try - catch</code> 块。</p>
</blockquote>
<blockquote>
<p>基本语法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">//可疑代码</span></span><br><span class="line">	<span class="comment">//将异常生成对应的异常对象，传递给 catch 块</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">	<span class="comment">//如果发生异常，执行这些代码</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//无论是否异常，都执行这些代码</span></span><br><span class="line">    <span class="comment">//finally 块可以不写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>快捷键：选中代码后按 ctrl + alt + T</p>
</blockquote>
<h4 id="11-2-1-1-使用细节"><a href="#11-2-1-1-使用细节" class="headerlink" title="11.2.1.1 使用细节"></a>11.2.1.1 使用细节</h4><ol>
<li><p>如果异常发生了，则异常发生后面的代码块都不执行，直接进入 catch 块</p>
</li>
<li><p>如果异常未发生，则顺序执行 try 代码块，catch 块不执行</p>
</li>
<li><p>如果希望不管是否异常，都执行一些代码，则使用 finally</p>
</li>
<li><p>可以有多个 catch 捕获不同的异常。要求 子类异常在前，父类异常在后。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125; <span class="keyword">catch</span> (ArithmeticException e) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125; <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>可以进行 try - finally 配合使用（不写 catch）。这种用法相当于没有捕获异常，此时程序如果出错会直接退出。</p>
<p>应用场景，就是写一段代码，不管是否发生异常，都必须执行某个业务逻辑。</p>
</li>
<li><p>如果没有出现异常，执行 try 中所有语句，不执行 catch 语句，最后执行 finally 语句</p>
</li>
<li><p>如果出现异常，则 try 块异常发生后，剩余语句不执行。之后执行 catch 语句，最后，执行 finally 语句。</p>
</li>
</ol>
<h3 id="11-2-2-throws-异常处理"><a href="#11-2-2-throws-异常处理" class="headerlink" title="11.2.2 throws 异常处理"></a>11.2.2 <code>throws</code> 异常处理</h3><blockquote>
<p>如果一个方法可能生成某种异常，但是并不能确定如何处理这种异常，则此方法应显式地声明抛出异常，表明该方法将不对这些异常进行处理，而由调用者负责处理</p>
<p>在方法中声明 <code>throws</code> 语句可以声明抛出异常的列表。<code>throws</code> 后面的异常类型可以是方法中产生的异常类型，也可以是它的父类。</p>
</blockquote>
<blockquote>
<p>语法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">metord</span><span class="params">()</span> <span class="keyword">throws</span> FileNontFoundException ,NullPointerException &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="11-2-2-1-使用细节"><a href="#11-2-2-1-使用细节" class="headerlink" title="11.2.2.1 使用细节"></a>11.2.2.1 使用细节</h4><ol>
<li>对于 <strong>编译异常</strong>，程序中必须处理。</li>
<li>对于 <strong>运行异常</strong>，程序中诺没有处理，默认处理是 <code>throws</code></li>
<li>子类 重写 父类方法时，子类方法抛出的异常类型必须和父类一致，或者是父类抛出异常类型的子类型。</li>
<li>如果有 <code>try - catch</code> 就不必 <code>throws</code> 了</li>
</ol>
<h2 id="11-3-自定义异常"><a href="#11-3-自定义异常" class="headerlink" title="11.3 自定义异常"></a>11.3 自定义异常</h2><blockquote>
<p>当程序中出现了某些 “错误”，但该信息并未在 <code>Throwable</code> 子类中描述处理，这时候可以自己设计异常类，用于描述该错误信息</p>
</blockquote>
<ol>
<li>定义类：自定义异常类名，继承 RuntimeException 或 Exception</li>
<li>如果继承 Exception，属于 编译异常。</li>
<li>如果继承 RuntimeException，属于 运行异常。（一般来说，选这个。这样利用了默认处理机制，更方便）</li>
</ol>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">Metords</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">       <span class="keyword">if</span>(n &gt; <span class="number">100</span>)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;不能大于100&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">	<span class="built_in">super</span>(message);</span><br><span class="line">&#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="11-3-1-throw-和-throws"><a href="#11-3-1-throw-和-throws" class="headerlink" title="11.3.1 throw 和 throws"></a>11.3.1 <code>throw</code> 和 <code>throws</code></h3><table>
<thead>
<tr>
<th></th>
<th>意义</th>
<th>位置</th>
<th>后面跟的东西</th>
</tr>
</thead>
<tbody><tr>
<td><code>throws</code></td>
<td>异常处理的一种方式</td>
<td>方法声明时</td>
<td>异常类型</td>
</tr>
<tr>
<td><code>throw</code></td>
<td>手动生成异常对象关键字</td>
<td>方法体中</td>
<td>异常对象</td>
</tr>
</tbody></table>
<h3 id="11-3-2-编程小技巧"><a href="#11-3-2-编程小技巧" class="headerlink" title="11.3.2 编程小技巧"></a>11.3.2 编程小技巧</h3><p>老韩曰：编写异常时，先确定正确的情况，然后取反。这样写，你的思路就不乱。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2021/12/18/11%20%E5%BC%82%E5%B8%B8/" data-id="claq1vt5a0005twtfa7a6gq5h" data-title="&lt;Java&gt;11 异常" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-10 枚举和注解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="public/2021/12/17/10%20%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%B3%A8%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2021-12-16T16:00:00.000Z" itemprop="datePublished">2021-12-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="public/2021/12/17/10%20%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%B3%A8%E8%A7%A3/">&lt;Java&gt;10 枚举和注解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="10-枚举和注解"><a href="#10-枚举和注解" class="headerlink" title="10 枚举和注解"></a>10 枚举和注解</h1><h2 id="10-1-枚举"><a href="#10-1-枚举" class="headerlink" title="10.1 枚举"></a>10.1 枚举</h2><p>把具体的对象一一列举出来的类，就称为 枚举类（enumeration）</p>
<p>实现方法：</p>
<ol>
<li>自定义枚举</li>
<li><code>enum</code> 关键字枚举</li>
</ol>
<h3 id="10-1-1-自定义枚举"><a href="#10-1-1-自定义枚举" class="headerlink" title="10.1.1 自定义枚举"></a>10.1.1 自定义枚举</h3><ol>
<li>构造器私有化</li>
<li>去掉 set 方法（可保留 get），防止属性被修改。因为枚举对象值通常为只读</li>
<li>在类内部直接创建固定对象。使用 <code>final</code> + <code>static</code> 共同修饰，对象名通常全部大写。</li>
<li>枚举对象按照需要可以有多个属性</li>
</ol>
<h3 id="10-1-2-enum-关键字"><a href="#10-1-2-enum-关键字" class="headerlink" title="10.1.2 enum 关键字"></a>10.1.2 <code>enum</code> 关键字</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Example</span> &#123;</span><br><span class="line"> RED(<span class="string">&quot;小红&quot;</span>, <span class="number">10</span>), BLUE(<span class="string">&quot;小蓝&quot;</span>, <span class="number">11</span>), YELLOW; <span class="comment">//这句话要放在前面，第三个是无参</span></span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line"> <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="title function_">Example</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.name = name;</span><br><span class="line">     <span class="built_in">this</span>.age = age;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>用关键字 <code>enum</code> 替代 <code>class</code></li>
<li>用 <code>常量名.(形参列表);</code> 代替创建对象（放在前面）。多个对象的场合，用 <code>,</code> 间隔。</li>
<li>如果使用 <code>enum</code> 枚举，要求将常量对象写在前面</li>
</ol>
<h4 id="10-1-2-1-使用细节"><a href="#10-1-2-1-使用细节" class="headerlink" title="10.1.2.1 使用细节"></a>10.1.2.1 使用细节</h4><ol>
<li><p>当我们用 <code>enum</code> 关键字开发一个枚举类时，默认会继承 java.lang.Enum 类，而且是一个 <code>final</code> 类。</p>
<p>这样，我们就能使用 Enum 中的相关方法。</p>
<p><strong>也正因为如此，<code>enum</code> 类不能继承其他类，亦不能被其它类继承</strong></p>
<p>不过，<code>enum</code> 类和其他类一样，可以实现接口。</p>
</li>
<li><p>传统的 <code>public ststic final RED(&quot;小红&quot;, 10);</code> 简化为 <code>RED(&quot;小红&quot;, 10);</code></p>
</li>
<li><p>如果使用无参构造器创建枚举对象，则 实参列表 和 <code>( )</code> 都能省略</p>
</li>
</ol>
<h4 id="10-1-2-2-Enum-类中的常用方法"><a href="#10-1-2-2-Enum-类中的常用方法" class="headerlink" title="10.1.2.2 Enum 类中的常用方法"></a>10.1.2.2 <code>Enum</code> 类中的常用方法</h4><ul>
<li><code>valueOf</code>：将字符串转换成枚举对象。要求字符串必须是已有的常量名，否则报异常。</li>
<li><code>values</code>：返回一个数组 <code>Example[]</code>，其中包含定义的所有枚举对象</li>
<li><code>getDeclaringClass</code>：得到枚举常量所属的 <code>class</code></li>
<li><code>name</code>：得到当前枚举常量的名称。建议优先用 <code>toString</code></li>
<li><code>ordinal</code>：输出该枚举对象的次序&#x2F;编号（从 0 开始编号。如上例 <code>BLUE.ordinal = 1</code>）</li>
<li><code>compareTo</code>：比较两个枚举常量的编号（调用常量编号 减去 传入常量编号）</li>
<li><code>clone</code>：枚举类不能 <code>clone</code>，所以，这是一个只会抛出异常的方法</li>
</ul>
<h2 id="10-2-注解"><a href="#10-2-注解" class="headerlink" title="10.2 注解"></a>10.2 注解</h2><p>注解（Annotation）也被称为元数据（Metadata）。用于修饰 包、类、方法、属性、构造器、局部变量 等数据信息</p>
<p>和注释一样，注解不影响程序逻辑，但注解可以被编译或运行，相当于嵌入在代码中的补充信息</p>
<p>在 JavaSE 中，注解的使用目的比较简单，例如 标记过时的功能，忽略警告 等。在 JavaEE 中注解占据了更重要的角色，例如用于配置应用程序的任何切面，代替 JavaEE 旧版中所遗留的繁冗代码和 XML 配置等。</p>
<ol>
<li>使用 <code>@Annotation</code> 时要在前面增加 <code>@</code> 符号，并把该注解当成一个修饰符使用。用于修饰它支持的程序元素。</li>
<li>三个基本的 <code>@Annotation</code>：<ul>
<li><code>@Override</code>：限定某个方法，是 重写 父类方法。该注解只能用于方法。如果你写了该注解，编译器会替你校验，看看是不是真的 重写 了父类方法。</li>
<li><code>@Deprecated</code>：用于表示某个程序元素（类、方法等）已经过时</li>
<li><code>@SuppressWarnings()</code>：抑制编辑器警告</li>
</ul>
</li>
<li>如果发现 <code>public @interface XXX&#123;&#125;</code> 这种东西，说明是定义了一个注解类 <code>XXX</code>。这里的 <code>@interface</code> 不代表接口（<code>interface</code>）。</li>
</ol>
<h3 id="10-2-1-Override"><a href="#10-2-1-Override" class="headerlink" title="10.2.1 @Override"></a>10.2.1 <code>@Override</code></h3><ol>
<li><code>@Override</code> 表示指定重写父类的方法（从编译器层面验证），如果父类没有该方法，就报错</li>
<li>不写该注解，重写依然构成重写</li>
<li><code>@Override</code> 只能修饰方法，不能修饰其他 类、包、属性等</li>
<li>查看 <code>@Override</code> 注解源码为 <code>@Target(ElementType.METHOD)</code> 说明只能修饰方法</li>
<li><code>@Target</code> 是修饰注解的注解，称为 元注解</li>
</ol>
<h3 id="10-2-2-Deprecated"><a href="#10-2-2-Deprecated" class="headerlink" title="10.2.2 @Deprecated"></a>10.2.2 <code>@Deprecated</code></h3><ol>
<li><p><code>@Deprecated</code> 表示指定的某个程序元素（类、方法等）已过时</p>
</li>
<li><p>不推荐使用，但仍能使用</p>
</li>
<li><p>可以修饰方法、类、字段、包、参数</p>
<p><code>@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)</code></p>
</li>
<li><p><code>@Deprecated</code> 可以做到新旧版本的兼容和过度</p>
</li>
</ol>
<h3 id="10-2-3-SuppressWarnings"><a href="#10-2-3-SuppressWarnings" class="headerlink" title="10.2.3 @SuppressWarnings()"></a>10.2.3 <code>@SuppressWarnings()</code></h3><ol>
<li><p>当我们不想看到警告信息时，用 <code>@SuppressWarnings()</code></p>
<p>语法：<code>@SuppressWarnings(&#123;&quot;...&quot;&#125;)</code></p>
<p>在后面 <code>(&#123;&quot;unused&quot;, &quot;unchecked&quot;&#125;)</code> 这样写入你希望抑制的信息，以下是所有可以输入的关键字</p>
<table>
<thead>
<tr>
<th align="left"><strong>关键字</strong></th>
<th align="left"><strong>用途</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">all</td>
<td align="left">抑制所有警告</td>
</tr>
<tr>
<td align="left">boxing</td>
<td align="left">抑制与装箱&#x2F;解装箱操作相关的警告</td>
</tr>
<tr>
<td align="left">cast</td>
<td align="left">抑制与强制转换操作相关的警告</td>
</tr>
<tr>
<td align="left">dep-ann</td>
<td align="left">抑制与已弃用注释相关的警告</td>
</tr>
<tr>
<td align="left">deprecation</td>
<td align="left">抑制与弃用有关的警告</td>
</tr>
<tr>
<td align="left">fallthrough</td>
<td align="left">抑制与 switch 语句中丢失断点相关的警告</td>
</tr>
<tr>
<td align="left">finally</td>
<td align="left">抑制不返回的 finally 块的相关警告</td>
</tr>
<tr>
<td align="left">hiding</td>
<td align="left">抑制与隐藏变量的局部变量相关的警告</td>
</tr>
<tr>
<td align="left">incomplete-switch</td>
<td align="left">抑制与 switch 语句中缺少条目相关的警告（enum）</td>
</tr>
<tr>
<td align="left">nls</td>
<td align="left">抑制与 非nls 字符串字面值相关的警告</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">抑制相对于null分析的警告</td>
</tr>
<tr>
<td align="left">rawtypes</td>
<td align="left">在类参数上使用泛型时，抑制与非特定类型相关的警告</td>
</tr>
<tr>
<td align="left">restriction</td>
<td align="left">抑制与不推荐或禁止引用有关的警告</td>
</tr>
<tr>
<td align="left">serial</td>
<td align="left">抑制与可序列化类缺少serialVersionUID字段相关的警告</td>
</tr>
<tr>
<td align="left">static-access</td>
<td align="left">抑制与不正确的静态访问有关的警告</td>
</tr>
<tr>
<td align="left">synthetic-access</td>
<td align="left">抑制与未优化的内部类访问相关的警告</td>
</tr>
<tr>
<td align="left">unchecked</td>
<td align="left">抑制与未检查的操作相关的警告</td>
</tr>
<tr>
<td align="left">unqualified-field-access</td>
<td align="left">抑制与字段访问不合格相关的警告</td>
</tr>
<tr>
<td align="left">unused</td>
<td align="left">抑制与未使用代码相关的警告</td>
</tr>
</tbody></table>
</li>
<li><p><code>@SuppressWarnings</code> 的范围与你放置的位置相关。</p>
</li>
</ol>
<h3 id="10-2-4-JDK-的元注解（了解即可）"><a href="#10-2-4-JDK-的元注解（了解即可）" class="headerlink" title="10.2.4 JDK 的元注解（了解即可）"></a>10.2.4 JDK 的元注解（了解即可）</h3><blockquote>
<p>JDK 的 元注解 是用于修饰其他注解的注解</p>
</blockquote>
<ol>
<li><p><code>@Rentention</code>：指定注解的作用范围，有三种范围 <code>SOURCE</code> <code>CLASS</code> <code>RUNTIME</code></p>
<p><code>@Rentention</code> 的三种值：</p>
<ul>
<li><code>RententionPolicy.SOURCE</code>：编译器使用后，直接丢弃这种策略的注释</li>
<li><code>RententionPolicy.CLASS</code>：编译器把注解记录在 class 文件中。当运行 Java 程序时， JVM 不会保留注释。这是默认值</li>
<li><code>RententionPolicy.RUNTIME</code>：编译器把注解记录在 class 文件中。当运行 Java 程序时，JVM 会保留注解。程序可以通过反射获取该注解</li>
</ul>
</li>
<li><p><code>@Target</code>：指定注解的使用范围</p>
<p><code>@Target(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)</code></p>
</li>
<li><p><code>@Documented</code>：指定该注解会不会在 Javadoc 体现</p>
</li>
<li><p><code>@Inherited</code>：子类会继承父类注解</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.compublic/2021/12/17/10%20%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%B3%A8%E8%A7%A3/" data-id="claq1vt590004twtfa3u7a14f" data-title="&lt;Java&gt;10 枚举和注解" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E5%BD%95/" rel="tag">目录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A8%8B%E5%BA%8F/" rel="tag">程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/%E7%9B%AE%E5%BD%95/" style="font-size: 10px;">目录</a> <a href="/tags/%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">程序</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archivespublic/2021/11/">November 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="public/2022/10/16/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="public/2022/06/03/26%20%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8/">&lt;Java&gt;26 算法入门</a>
          </li>
        
          <li>
            <a href="public/2022/06/02/14%20%E6%A0%91/">&lt;Java&gt;14 树</a>
          </li>
        
          <li>
            <a href="public/2022/05/29/13%20Java%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">&lt;Java&gt;13 Java 数据结构</a>
          </li>
        
          <li>
            <a href="public/2022/04/22/15%20%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1/">&lt;Java&gt;15 图形界面设计</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>